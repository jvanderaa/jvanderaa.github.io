
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Josh VanDeraa">
      
      
        <link rel="canonical" href="https://josh-v.com/category/ansible/page/3/">
      
      
        <link rel="prev" href="../../../../links/">
      
      
        <link rel="next" href="../../../arista/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.24">
    
    
      
        <title>ansible - Josh VanDeraa</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M6 13h8l-3.5 3.5 1.42 1.42L17.84 12l-5.92-5.92L10.5 7.5 14 11H6v2Z"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-QCDLSTK9K6"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-QCDLSTK9K6",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-QCDLSTK9K6",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ansible" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Josh VanDeraa" class="md-header__button md-logo" aria-label="Josh VanDeraa" data-md-component="logo">
      
  <img src="../../../../assets/router.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Josh VanDeraa
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ansible
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/jvanderaa/jvanderaa.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jvanderaa/jvanderaa.github.io
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
    
  
  üè† Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../about/" class="md-tabs__link">
        
  
    
  
  üë§ About

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../book/" class="md-tabs__link">
        
  
    
  
  üìñ Book: OSS Net Mgmt

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../links/" class="md-tabs__link">
        
  
    
  
  üîó Links

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../archive/2024/" class="md-tabs__link">
          
  
    
  
  üìö Posts

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  üè∑Ô∏è Categories

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Josh VanDeraa" class="md-nav__button md-logo" aria-label="Josh VanDeraa" data-md-component="logo">
      
  <img src="../../../../assets/router.png" alt="logo">

    </a>
    Josh VanDeraa
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jvanderaa/jvanderaa.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jvanderaa/jvanderaa.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üè† Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üë§ About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../book/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üìñ Book: OSS Net Mgmt
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üîó Links
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    üìö Posts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            üìö Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2018/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2018
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    üè∑Ô∏è Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üè∑Ô∏è Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
      
    
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="../../" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ansible
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../arista/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    arista
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../asa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asa
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../asa_og/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asa_og
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../automation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    blog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../cisco/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cisco
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../cisco_ios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cisco_ios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../cisco_nxos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cisco_nxos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../cisco_wlc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cisco_wlc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../communications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    communications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../debian/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    debian
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../devnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    devnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../earth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    earth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../eveng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eveng
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../expert/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    expert
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../flask/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    flask
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../golang/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    golang
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../golf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    golf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../graphql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    graphql
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../hashicorp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hashicorp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../homeassistant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    homeassistant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../ios_interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ios_interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../juniper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    juniper
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../meraki/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    meraki
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../nautobot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nautobot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../netbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    netbox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../netdevops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    netdevops
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../netmiko/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    netmiko
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../network-simulation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    network simulation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../network_design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    network_design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../nornir/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nornir
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../poetry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    poetry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../productivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    productivity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../prometheus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    prometheus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../redux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    redux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../saving_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    saving_config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../slack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    slack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../vault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vault
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../wan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wan
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="ansible">ansible<a class="headerlink" href="#ansible" title="Permanent link">#</a></h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/22228848" alt="Josh VanDeraa">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-12-13 00:00:00">December 13, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../netbox/" class="md-meta__link">netbox</a>, 
              <a href="../../" class="md-meta__link">ansible</a></li>
        
        
          
          <li class="md-meta__item">
            
              7 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="netbox-ansible-collection-site-module"><a class="toclink" href="../../../../netbox-ansible-sites/">NetBox Ansible Collection: Site Module</a></h2>
<p>This post dives into the <a href="https://netbox-ansible-collection.readthedocs.io/en/latest/">NetBox Ansible Content Collection</a> module to create/update a <a href="https://netbox-ansible-collection.readthedocs.io/en/latest/plugins/modules/netbox_site/netbox.netbox.netbox_site_module.html">Site</a>. As I start into this series on looking at the modules that create/update/delete data from NetBox, the question that I keep asking myself is should I be looking at the modules that are creating/updating/deleting items? The reason that I ask this to myself is because I am a firm believer that automation should be coming from NetBox as its Source of Truth (SoT). You can hear/read plenty more about these thoughts on posts and videos here:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=GyQf5F0gr3w&amp;t">Minneapolis Ansible Meetup April 2020 Talk</a></li>
<li><a href="https://www.ansible.com/blog/using-netbox-for-ansible-source-of-truth">Ansible Guest Blog Post</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This post was created when NetBox was an open source project used often in my automation framework. I have moved on to using <a href="https://www.nautobot.com">Nautobot</a> due to the project vision and providing a methodology that will drive network automation forward further. You may want to take a look at it yourself.</p>
</div>
<p>When it comes to creating and deleting sites in NetBox, this one is an easy one. In my opinion this is a <strong>yes it should be</strong>. Most likely an IT tool is not the tool that will be the Source of Truth as it comes to physical sites. So this module in particualr that should be looked at and put into production use with Ansible.</p>
<h3 id="environment"><a class="toclink" href="../../../../netbox-ansible-sites/#environment">Environment</a></h3>
<p>For this demo, here are the versions shown:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>NetBox</td>
<td>v2.9.9 <a href="https://github.com/netbox-community/netbox-docker">(NetBox Docker)</a></td>
</tr>
<tr>
<td>NetBox Ansible Collection</td>
<td>v1.1.0</td>
</tr>
<tr>
<td>pynetbox</td>
<td>5.1.0</td>
</tr>
</tbody>
</table>
<h3 id="site-module"><a class="toclink" href="../../../../netbox-ansible-sites/#site-module">Site Module</a></h3>
<p>Within NetBox, the site is the most basic unit, and is required for devices to be added. This is the first thing that you should do when creating a NetBox instance is to start to build out sites. There are a many set of parameters that you can add to your sites, but the minimum required are:</p>
<ul>
<li>name: The name of the site</li>
</ul>
<p>Take a look at the <a href="https://netbox-ansible-collection.readthedocs.io/en/latest/plugins/modules/netbox_site/netbox.netbox.netbox_site_module.html">documentation</a> for all of the additional parameters. The ones that stick out to me (and there are many more) include:</p>
<ul>
<li>asn: The BGP AS Number</li>
<li>contact name &amp; email: Site contact information</li>
<li>physical and shipping addresses</li>
<li>tags</li>
<li>time_zone</li>
</ul>
<h3 id="examples"><a class="toclink" href="../../../../netbox-ansible-sites/#examples">Examples</a></h3>
<p>The point of these posts are to show examples and get you started. So let's get started. At the beginning of this there are going to be four sites that we can check out with the query function:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span>
<span class="normal"><a href="#__codelineno-27-5">5</a></span>
<span class="normal"><a href="#__codelineno-27-6">6</a></span>
<span class="normal"><a href="#__codelineno-27-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="l l-Scalar l-Scalar-Plain">TASK [05 - QUERY SITES] **********************************************************************************************************************************************</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts</span><span class="p p-Indicator">:</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">    </span><span class="nt">site_list_before</span><span class="p">:</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span></code></pre></div></td></tr></table></div>
<p>The data here instead of coming from a system of record that has sites will come from a YAML file. So the first step would be to look at getting data from a data source that has sites. This could be a CRM tool if you were a MSP, or any other tooling that has your sites. Here is what the data would look like:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nn">---</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="nt">sites</span><span class="p">:</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Chicago</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Minneapolis</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Denver</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Denver</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">New York</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Los_Angeles</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Portland</span>
</span></code></pre></div>
<p>Running the following playbook multiple times will show that the module itself is idempotent in that it will not keep creating sites.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nn">---</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SETUP</span><span class="nv"> </span><span class="s">SITES&quot;</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;05</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">QUERY</span><span class="nv"> </span><span class="s">SITES&quot;</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">      </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">        </span><span class="nt">site_list_before</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;sites&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">json_query(&#39;[*].value.name&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">SETUP</span><span class="nv"> </span><span class="s">SITES&quot;</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">      </span><span class="nt">netbox.netbox.netbox_site</span><span class="p">:</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">        </span><span class="nt">netbox_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_URL&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">        </span><span class="nt">netbox_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">        </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">        </span><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">      </span><span class="nt">loop_control</span><span class="p">:</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">        </span><span class="nt">loop_var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">site[&#39;name&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>The output below is from a second run. The sites for the current NetBox demo was originally deployed with this.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span>
<span class="normal"><a href="#__codelineno-30-18">18</a></span>
<span class="normal"><a href="#__codelineno-30-19">19</a></span>
<span class="normal"><a href="#__codelineno-30-20">20</a></span>
<span class="normal"><a href="#__codelineno-30-21">21</a></span>
<span class="normal"><a href="#__codelineno-30-22">22</a></span>
<span class="normal"><a href="#__codelineno-30-23">23</a></span>
<span class="normal"><a href="#__codelineno-30-24">24</a></span>
<span class="normal"><a href="#__codelineno-30-25">25</a></span>
<span class="normal"><a href="#__codelineno-30-26">26</a></span>
<span class="normal"><a href="#__codelineno-30-27">27</a></span>
<span class="normal"><a href="#__codelineno-30-28">28</a></span>
<span class="normal"><a href="#__codelineno-30-29">29</a></span>
<span class="normal"><a href="#__codelineno-30-30">30</a></span>
<span class="normal"><a href="#__codelineno-30-31">31</a></span>
<span class="normal"><a href="#__codelineno-30-32">32</a></span>
<span class="normal"><a href="#__codelineno-30-33">33</a></span>
<span class="normal"><a href="#__codelineno-30-34">34</a></span>
<span class="normal"><a href="#__codelineno-30-35">35</a></span>
<span class="normal"><a href="#__codelineno-30-36">36</a></span>
<span class="normal"><a href="#__codelineno-30-37">37</a></span>
<span class="normal"><a href="#__codelineno-30-38">38</a></span>
<span class="normal"><a href="#__codelineno-30-39">39</a></span>
<span class="normal"><a href="#__codelineno-30-40">40</a></span>
<span class="normal"><a href="#__codelineno-30-41">41</a></span>
<span class="normal"><a href="#__codelineno-30-42">42</a></span>
<span class="normal"><a href="#__codelineno-30-43">43</a></span>
<span class="normal"><a href="#__codelineno-30-44">44</a></span>
<span class="normal"><a href="#__codelineno-30-45">45</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="l l-Scalar l-Scalar-Plain">TASK [05 - QUERY SITES] **********************************************************************************************</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="l l-Scalar l-Scalar-Plain">ok</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts</span><span class="p p-Indicator">:</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">    </span><span class="nt">site_list_before</span><span class="p">:</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="l l-Scalar l-Scalar-Plain">TASK [10 - SETUP SITES] **********************************************************************************************</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=MSP) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site MSP already exists</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Minneapolis</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Chicago</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=DEN) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site DEN already exists</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Denver</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Denver</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=NYC) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site NYC already exists</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">New York</span>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=PDX) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site PDX already exists</span>
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Portland</span>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-30-42"><a id="__codelineno-30-42" name="__codelineno-30-42"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Los_Angeles</span>
</span><span id="__span-30-43"><a id="__codelineno-30-43" name="__codelineno-30-43"></a>
</span><span id="__span-30-44"><a id="__codelineno-30-44" name="__codelineno-30-44"></a><span class="l l-Scalar l-Scalar-Plain">PLAY RECAP ***********************************************************************************************************</span>
</span><span id="__span-30-45"><a id="__codelineno-30-45" name="__codelineno-30-45"></a><span class="nt">localhost                  </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><span class="w">   </span>
</span></code></pre></div></td></tr></table></div>
<p>In here we see that there were two tasks that showed <strong>ok</strong> and no tasks in the other sections of the play recap.</p>
<h3 id="adding-an-additional-site"><a class="toclink" href="../../../../netbox-ansible-sites/#adding-an-additional-site">Adding an additional site</a></h3>
<p>The source for the sites just had a new site added. This is adding the Orlando location. As such the data now looks like this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nn">---</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="nt">sites</span><span class="p">:</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Chicago</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Minneapolis</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Denver</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Denver</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">New York</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Los_Angeles</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Portland</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MCO</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Orlando</span>
</span></code></pre></div>
<p>With the new location, the Ansible Playbook is executed and we see a new site is added:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span>
<span class="normal"><a href="#__codelineno-32-17">17</a></span>
<span class="normal"><a href="#__codelineno-32-18">18</a></span>
<span class="normal"><a href="#__codelineno-32-19">19</a></span>
<span class="normal"><a href="#__codelineno-32-20">20</a></span>
<span class="normal"><a href="#__codelineno-32-21">21</a></span>
<span class="normal"><a href="#__codelineno-32-22">22</a></span>
<span class="normal"><a href="#__codelineno-32-23">23</a></span>
<span class="normal"><a href="#__codelineno-32-24">24</a></span>
<span class="normal"><a href="#__codelineno-32-25">25</a></span>
<span class="normal"><a href="#__codelineno-32-26">26</a></span>
<span class="normal"><a href="#__codelineno-32-27">27</a></span>
<span class="normal"><a href="#__codelineno-32-28">28</a></span>
<span class="normal"><a href="#__codelineno-32-29">29</a></span>
<span class="normal"><a href="#__codelineno-32-30">30</a></span>
<span class="normal"><a href="#__codelineno-32-31">31</a></span>
<span class="normal"><a href="#__codelineno-32-32">32</a></span>
<span class="normal"><a href="#__codelineno-32-33">33</a></span>
<span class="normal"><a href="#__codelineno-32-34">34</a></span>
<span class="normal"><a href="#__codelineno-32-35">35</a></span>
<span class="normal"><a href="#__codelineno-32-36">36</a></span>
<span class="normal"><a href="#__codelineno-32-37">37</a></span>
<span class="normal"><a href="#__codelineno-32-38">38</a></span>
<span class="normal"><a href="#__codelineno-32-39">39</a></span>
<span class="normal"><a href="#__codelineno-32-40">40</a></span>
<span class="normal"><a href="#__codelineno-32-41">41</a></span>
<span class="normal"><a href="#__codelineno-32-42">42</a></span>
<span class="normal"><a href="#__codelineno-32-43">43</a></span>
<span class="normal"><a href="#__codelineno-32-44">44</a></span>
<span class="normal"><a href="#__codelineno-32-45">45</a></span>
<span class="normal"><a href="#__codelineno-32-46">46</a></span>
<span class="normal"><a href="#__codelineno-32-47">47</a></span>
<span class="normal"><a href="#__codelineno-32-48">48</a></span>
<span class="normal"><a href="#__codelineno-32-49">49</a></span>
<span class="normal"><a href="#__codelineno-32-50">50</a></span>
<span class="normal"><a href="#__codelineno-32-51">51</a></span>
<span class="normal"><a href="#__codelineno-32-52">52</a></span>
<span class="normal"><a href="#__codelineno-32-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="l l-Scalar l-Scalar-Plain">TASK [05 - QUERY SITES] **********************************************************************************************</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="l l-Scalar l-Scalar-Plain">ok</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts</span><span class="p p-Indicator">:</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">    </span><span class="nt">site_list_before</span><span class="p">:</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="l l-Scalar l-Scalar-Plain">TASK [10 - SETUP SITES] **********************************************************************************************</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=MSP) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site MSP already exists</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Minneapolis</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Chicago</span>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=DEN) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site DEN already exists</span>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Denver</span>
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Denver</span>
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=NYC) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-32-29"><a id="__codelineno-32-29" name="__codelineno-32-29"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site NYC already exists</span>
</span><span id="__span-32-30"><a id="__codelineno-32-30" name="__codelineno-32-30"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-32-31"><a id="__codelineno-32-31" name="__codelineno-32-31"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">New York</span>
</span><span id="__span-32-32"><a id="__codelineno-32-32" name="__codelineno-32-32"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-32-33"><a id="__codelineno-32-33" name="__codelineno-32-33"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-32-34"><a id="__codelineno-32-34" name="__codelineno-32-34"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-32-35"><a id="__codelineno-32-35" name="__codelineno-32-35"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=PDX) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-32-36"><a id="__codelineno-32-36" name="__codelineno-32-36"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-32-37"><a id="__codelineno-32-37" name="__codelineno-32-37"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site PDX already exists</span>
</span><span id="__span-32-38"><a id="__codelineno-32-38" name="__codelineno-32-38"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-32-39"><a id="__codelineno-32-39" name="__codelineno-32-39"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Portland</span>
</span><span id="__span-32-40"><a id="__codelineno-32-40" name="__codelineno-32-40"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-32-41"><a id="__codelineno-32-41" name="__codelineno-32-41"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-32-42"><a id="__codelineno-32-42" name="__codelineno-32-42"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Los_Angeles</span>
</span><span id="__span-32-43"><a id="__codelineno-32-43" name="__codelineno-32-43"></a><span class="nt">changed</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=MCO) =&gt; changed=true</span><span class="w"> </span>
</span><span id="__span-32-44"><a id="__codelineno-32-44" name="__codelineno-32-44"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-32-45"><a id="__codelineno-32-45" name="__codelineno-32-45"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site MCO created</span>
</span><span id="__span-32-46"><a id="__codelineno-32-46" name="__codelineno-32-46"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-32-47"><a id="__codelineno-32-47" name="__codelineno-32-47"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Orlando</span>
</span><span id="__span-32-48"><a id="__codelineno-32-48" name="__codelineno-32-48"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MCO</span>
</span><span id="__span-32-49"><a id="__codelineno-32-49" name="__codelineno-32-49"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-32-50"><a id="__codelineno-32-50" name="__codelineno-32-50"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-32-51"><a id="__codelineno-32-51" name="__codelineno-32-51"></a>
</span><span id="__span-32-52"><a id="__codelineno-32-52" name="__codelineno-32-52"></a><span class="l l-Scalar l-Scalar-Plain">PLAY RECAP ***********************************************************************************************************</span>
</span><span id="__span-32-53"><a id="__codelineno-32-53" name="__codelineno-32-53"></a><span class="nt">localhost                  </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><span class="w">   </span>
</span></code></pre></div></td></tr></table></div>
<p>Taking a look at line 45 in this last execution you see the message <strong>site MCO created</strong>. This shows that it as created and there was a task that showed chagned in the play recap.</p>
<h3 id="removing-sites"><a class="toclink" href="../../../../netbox-ansible-sites/#removing-sites">Removing Sites</a></h3>
<p>In this example for the removing of sites I am going to keep it a little bit more manual. I'm going to create a new variable in the <code>group_vars/all/sites.yml</code> file called <code>closed_sites</code>. So in this scenario the Orlando site was opened, but very quickly it was decided to close it down. So now we need to remove the site from NetBox. The <code>group_vars/all/sites.yml</code> now looks like below:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nn">---</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nt">sites</span><span class="p">:</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Chicago</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Minneapolis</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Denver</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Denver</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">New York</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Los_Angeles</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Portland</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="nt">closed_sites</span><span class="p">:</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MCO</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Orlando</span>
</span></code></pre></div>
<p>The updated Ansible Playbook now needs to remove any sites that are showing up in the closed sites:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nn">---</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SETUP</span><span class="nv"> </span><span class="s">SITES&quot;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;05</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">QUERY</span><span class="nv"> </span><span class="s">SITES&quot;</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">      </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">        </span><span class="nt">site_list_before</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;sites&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">json_query(&#39;[*].value.name&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">SETUP</span><span class="nv"> </span><span class="s">SITES&quot;</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">      </span><span class="nt">netbox.netbox.netbox_site</span><span class="p">:</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">        </span><span class="nt">netbox_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_URL&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">        </span><span class="nt">netbox_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">        </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">        </span><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="w">      </span><span class="nt">loop_control</span><span class="p">:</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w">        </span><span class="nt">loop_var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">site[&#39;name&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">REMOVE</span><span class="nv"> </span><span class="s">CLOSED</span><span class="nv"> </span><span class="s">SITES&quot;</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">      </span><span class="nt">netbox.netbox.netbox_site</span><span class="p">:</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w">        </span><span class="nt">netbox_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_URL&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="w">        </span><span class="nt">netbox_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="w">        </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">        </span><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="w">      </span><span class="nt">loop_control</span><span class="p">:</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="w">        </span><span class="nt">loop_var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">site[&#39;name&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;25</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">QUERY</span><span class="nv"> </span><span class="s">SITES</span><span class="nv"> </span><span class="s">AT</span><span class="nv"> </span><span class="s">END&quot;</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="w">      </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="w">        </span><span class="nt">site_list_end</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;sites&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">json_query(&#39;[*].value.name&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a>
</span><span id="__span-34-39"><a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">SHOW</span><span class="nv"> </span><span class="s">RESULTS&quot;</span>
</span><span id="__span-34-40"><a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-34-41"><a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span>
</span><span id="__span-34-42"><a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">site_list_before</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-34-43"><a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">site_list_end</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>The result of the playbook shows that we had the site at the beginning, then we were able to successfully remove it in Task 20 to remove the closed sites.</p>
<blockquote>
<p>When removing a site, you do need to make sure that all of the corresponding devices and other relationships are gone from the site. NetBox will not allow you to remove a site without it being empty first.</p>
</blockquote>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span>
<span class="normal"><a href="#__codelineno-35-17">17</a></span>
<span class="normal"><a href="#__codelineno-35-18">18</a></span>
<span class="normal"><a href="#__codelineno-35-19">19</a></span>
<span class="normal"><a href="#__codelineno-35-20">20</a></span>
<span class="normal"><a href="#__codelineno-35-21">21</a></span>
<span class="normal"><a href="#__codelineno-35-22">22</a></span>
<span class="normal"><a href="#__codelineno-35-23">23</a></span>
<span class="normal"><a href="#__codelineno-35-24">24</a></span>
<span class="normal"><a href="#__codelineno-35-25">25</a></span>
<span class="normal"><a href="#__codelineno-35-26">26</a></span>
<span class="normal"><a href="#__codelineno-35-27">27</a></span>
<span class="normal"><a href="#__codelineno-35-28">28</a></span>
<span class="normal"><a href="#__codelineno-35-29">29</a></span>
<span class="normal"><a href="#__codelineno-35-30">30</a></span>
<span class="normal"><a href="#__codelineno-35-31">31</a></span>
<span class="normal"><a href="#__codelineno-35-32">32</a></span>
<span class="normal"><a href="#__codelineno-35-33">33</a></span>
<span class="normal"><a href="#__codelineno-35-34">34</a></span>
<span class="normal"><a href="#__codelineno-35-35">35</a></span>
<span class="normal"><a href="#__codelineno-35-36">36</a></span>
<span class="normal"><a href="#__codelineno-35-37">37</a></span>
<span class="normal"><a href="#__codelineno-35-38">38</a></span>
<span class="normal"><a href="#__codelineno-35-39">39</a></span>
<span class="normal"><a href="#__codelineno-35-40">40</a></span>
<span class="normal"><a href="#__codelineno-35-41">41</a></span>
<span class="normal"><a href="#__codelineno-35-42">42</a></span>
<span class="normal"><a href="#__codelineno-35-43">43</a></span>
<span class="normal"><a href="#__codelineno-35-44">44</a></span>
<span class="normal"><a href="#__codelineno-35-45">45</a></span>
<span class="normal"><a href="#__codelineno-35-46">46</a></span>
<span class="normal"><a href="#__codelineno-35-47">47</a></span>
<span class="normal"><a href="#__codelineno-35-48">48</a></span>
<span class="normal"><a href="#__codelineno-35-49">49</a></span>
<span class="normal"><a href="#__codelineno-35-50">50</a></span>
<span class="normal"><a href="#__codelineno-35-51">51</a></span>
<span class="normal"><a href="#__codelineno-35-52">52</a></span>
<span class="normal"><a href="#__codelineno-35-53">53</a></span>
<span class="normal"><a href="#__codelineno-35-54">54</a></span>
<span class="normal"><a href="#__codelineno-35-55">55</a></span>
<span class="normal"><a href="#__codelineno-35-56">56</a></span>
<span class="normal"><a href="#__codelineno-35-57">57</a></span>
<span class="normal"><a href="#__codelineno-35-58">58</a></span>
<span class="normal"><a href="#__codelineno-35-59">59</a></span>
<span class="normal"><a href="#__codelineno-35-60">60</a></span>
<span class="normal"><a href="#__codelineno-35-61">61</a></span>
<span class="normal"><a href="#__codelineno-35-62">62</a></span>
<span class="normal"><a href="#__codelineno-35-63">63</a></span>
<span class="normal"><a href="#__codelineno-35-64">64</a></span>
<span class="normal"><a href="#__codelineno-35-65">65</a></span>
<span class="normal"><a href="#__codelineno-35-66">66</a></span>
<span class="normal"><a href="#__codelineno-35-67">67</a></span>
<span class="normal"><a href="#__codelineno-35-68">68</a></span>
<span class="normal"><a href="#__codelineno-35-69">69</a></span>
<span class="normal"><a href="#__codelineno-35-70">70</a></span>
<span class="normal"><a href="#__codelineno-35-71">71</a></span>
<span class="normal"><a href="#__codelineno-35-72">72</a></span>
<span class="normal"><a href="#__codelineno-35-73">73</a></span>
<span class="normal"><a href="#__codelineno-35-74">74</a></span>
<span class="normal"><a href="#__codelineno-35-75">75</a></span>
<span class="normal"><a href="#__codelineno-35-76">76</a></span>
<span class="normal"><a href="#__codelineno-35-77">77</a></span>
<span class="normal"><a href="#__codelineno-35-78">78</a></span>
<span class="normal"><a href="#__codelineno-35-79">79</a></span>
<span class="normal"><a href="#__codelineno-35-80">80</a></span>
<span class="normal"><a href="#__codelineno-35-81">81</a></span>
<span class="normal"><a href="#__codelineno-35-82">82</a></span>
<span class="normal"><a href="#__codelineno-35-83">83</a></span>
<span class="normal"><a href="#__codelineno-35-84">84</a></span>
<span class="normal"><a href="#__codelineno-35-85">85</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="l l-Scalar l-Scalar-Plain">TASK [05 - QUERY SITES] **********************************************************************************************</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="l l-Scalar l-Scalar-Plain">task path</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/local/add_sites.yml:7</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts</span><span class="p p-Indicator">:</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">    </span><span class="nt">site_list_before</span><span class="p">:</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MCO</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11"></a>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="l l-Scalar l-Scalar-Plain">TASK [10 - SETUP SITES] **********************************************************************************************</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="nt">task path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/local/add_sites.yml:11</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=MSP) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site MSP already exists</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Minneapolis</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Chicago</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=DEN) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site DEN already exists</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Denver</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Denver</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=NYC) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site NYC already exists</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">New York</span>
</span><span id="__span-35-35"><a id="__codelineno-35-35" name="__codelineno-35-35"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-35-36"><a id="__codelineno-35-36" name="__codelineno-35-36"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-35-37"><a id="__codelineno-35-37" name="__codelineno-35-37"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-35-38"><a id="__codelineno-35-38" name="__codelineno-35-38"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=PDX) =&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-35-39"><a id="__codelineno-35-39" name="__codelineno-35-39"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-35-40"><a id="__codelineno-35-40" name="__codelineno-35-40"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site PDX already exists</span>
</span><span id="__span-35-41"><a id="__codelineno-35-41" name="__codelineno-35-41"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-35-42"><a id="__codelineno-35-42" name="__codelineno-35-42"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Portland</span>
</span><span id="__span-35-43"><a id="__codelineno-35-43" name="__codelineno-35-43"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-35-44"><a id="__codelineno-35-44" name="__codelineno-35-44"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-35-45"><a id="__codelineno-35-45" name="__codelineno-35-45"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Los_Angeles</span>
</span><span id="__span-35-46"><a id="__codelineno-35-46" name="__codelineno-35-46"></a>
</span><span id="__span-35-47"><a id="__codelineno-35-47" name="__codelineno-35-47"></a><span class="l l-Scalar l-Scalar-Plain">TASK [20 - REMOVE CLOSED SITES] **************************************************************************************</span>
</span><span id="__span-35-48"><a id="__codelineno-35-48" name="__codelineno-35-48"></a><span class="nt">task path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/local/add_sites.yml:23</span>
</span><span id="__span-35-49"><a id="__codelineno-35-49" name="__codelineno-35-49"></a><span class="nt">changed</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; (item=MCO) =&gt; changed=true</span><span class="w"> </span>
</span><span id="__span-35-50"><a id="__codelineno-35-50" name="__codelineno-35-50"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_loop_var</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site</span>
</span><span id="__span-35-51"><a id="__codelineno-35-51" name="__codelineno-35-51"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site MCO deleted</span>
</span><span id="__span-35-52"><a id="__codelineno-35-52" name="__codelineno-35-52"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">site</span><span class="p p-Indicator">:</span>
</span><span id="__span-35-53"><a id="__codelineno-35-53" name="__codelineno-35-53"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Orlando</span>
</span><span id="__span-35-54"><a id="__codelineno-35-54" name="__codelineno-35-54"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MCO</span>
</span><span id="__span-35-55"><a id="__codelineno-35-55" name="__codelineno-35-55"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-35-56"><a id="__codelineno-35-56" name="__codelineno-35-56"></a><span class="w">    </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/New_York</span>
</span><span id="__span-35-57"><a id="__codelineno-35-57" name="__codelineno-35-57"></a>
</span><span id="__span-35-58"><a id="__codelineno-35-58" name="__codelineno-35-58"></a><span class="l l-Scalar l-Scalar-Plain">TASK [25 - QUERY SITES AT END] ***************************************************************************************</span>
</span><span id="__span-35-59"><a id="__codelineno-35-59" name="__codelineno-35-59"></a><span class="nt">task path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/local/add_sites.yml:35</span>
</span><span id="__span-35-60"><a id="__codelineno-35-60" name="__codelineno-35-60"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; changed=false</span><span class="w"> </span>
</span><span id="__span-35-61"><a id="__codelineno-35-61" name="__codelineno-35-61"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts</span><span class="p p-Indicator">:</span>
</span><span id="__span-35-62"><a id="__codelineno-35-62" name="__codelineno-35-62"></a><span class="w">    </span><span class="nt">site_list_end</span><span class="p">:</span>
</span><span id="__span-35-63"><a id="__codelineno-35-63" name="__codelineno-35-63"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-35-64"><a id="__codelineno-35-64" name="__codelineno-35-64"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-35-65"><a id="__codelineno-35-65" name="__codelineno-35-65"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-35-66"><a id="__codelineno-35-66" name="__codelineno-35-66"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-35-67"><a id="__codelineno-35-67" name="__codelineno-35-67"></a>
</span><span id="__span-35-68"><a id="__codelineno-35-68" name="__codelineno-35-68"></a><span class="l l-Scalar l-Scalar-Plain">TASK [30 - SHOW RESULTS] *********************************************************************************************</span>
</span><span id="__span-35-69"><a id="__codelineno-35-69" name="__codelineno-35-69"></a><span class="nt">task path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/local/add_sites.yml:39</span>
</span><span id="__span-35-70"><a id="__codelineno-35-70" name="__codelineno-35-70"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt;</span><span class="w"> </span>
</span><span id="__span-35-71"><a id="__codelineno-35-71" name="__codelineno-35-71"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span>
</span><span id="__span-35-72"><a id="__codelineno-35-72" name="__codelineno-35-72"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-35-73"><a id="__codelineno-35-73" name="__codelineno-35-73"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MCO</span>
</span><span id="__span-35-74"><a id="__codelineno-35-74" name="__codelineno-35-74"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-35-75"><a id="__codelineno-35-75" name="__codelineno-35-75"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-35-76"><a id="__codelineno-35-76" name="__codelineno-35-76"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-35-77"><a id="__codelineno-35-77" name="__codelineno-35-77"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-35-78"><a id="__codelineno-35-78" name="__codelineno-35-78"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-35-79"><a id="__codelineno-35-79" name="__codelineno-35-79"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-35-80"><a id="__codelineno-35-80" name="__codelineno-35-80"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-35-81"><a id="__codelineno-35-81" name="__codelineno-35-81"></a><span class="nt">META</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ran handlers</span>
</span><span id="__span-35-82"><a id="__codelineno-35-82" name="__codelineno-35-82"></a><span class="nt">META</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ran handlers</span>
</span><span id="__span-35-83"><a id="__codelineno-35-83" name="__codelineno-35-83"></a>
</span><span id="__span-35-84"><a id="__codelineno-35-84" name="__codelineno-35-84"></a><span class="l l-Scalar l-Scalar-Plain">PLAY RECAP ***********************************************************************************************************</span>
</span><span id="__span-35-85"><a id="__codelineno-35-85" name="__codelineno-35-85"></a><span class="nt">localhost                  </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ok=5    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><span class="w">  </span>
</span></code></pre></div></td></tr></table></div>
<h3 id="summary"><a class="toclink" href="../../../../netbox-ansible-sites/#summary">Summary</a></h3>
<p>This module is a very good module with a lot of options to get you started. This is absolutely a module that I would become familiar with as your organization is changing over time. This will allow you to keep your NetBox environment up to date with the site changes as you get new and closed sites alike. Hopefully this has been helpful to demonstrate it's capabities. Let me know your comments below, or give it a thumbs up if you have found this helpful.  </p>
<p>Thanks,</p>
<p>Josh</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/22228848" alt="Josh VanDeraa">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-12-12 00:00:00">December 12, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../netbox/" class="md-meta__link">netbox</a>, 
              <a href="../../" class="md-meta__link">ansible</a></li>
        
        
          
          <li class="md-meta__item">
            
              10 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="netbox-ansible-collection-lookup-plugin"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/">NetBox Ansible Collection: Lookup Plugin</a></h2>
<p>The NetBox lookup plugin is to <strong>get information</strong> out of NetBox for use within Ansible. This uses <a href="https://github.com/digitalocean/pynetbox">pynetbox</a> to query the NetBox API for the information requested. On top of being helpful in gathering data from NetBox (when it is not your inventory source), but it is extremely helpful in larger NetBox deployments when compared to using the URI module as well. If you wish to use NetBox as your inventory source, you should definitely read my previous post on getting started with the <a href="https://josh-v.com/netbox_ansible_collection/netbox-ansible-inventory_plugin/">NetBox Inventory Plugin</a>.</p>
<ul>
<li><a href="https://netbox-ansible-collection.readthedocs.io/en/latest/plugins/lookup/nb_lookup/netbox.netbox.nb_lookup_lookup.html">Read the Docs</a></li>
<li><a href="https://github.com/netbox-community/ansible_modules/blob/devel/plugins/lookup/nb_lookup.py">GitHub Source File</a></li>
<li><a href="https://josh-v.com/netbox_ansible_collection/collection_install/">Installing the Colleciton</a></li>
</ul>
<blockquote>
<p>The recommended Jinja function to use with this lookup plugin is the <code>query</code> function. This tells Ansible that the result of the lookup should be a type list. The same behavior is also available by using the <code>lookup</code> function, in conjunction with the parameter <code>wantlist=true</code>. For this post we will use the <code>query</code> method.</p>
</blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This post was created when NetBox was an open source project used often in my automation framework. I have moved on to using <a href="https://www.nautobot.com">Nautobot</a> due to the project vision and providing a methodology that will drive network automation forward further. You may want to take a look at it yourself.</p>
</div>
<h3 id="methodology"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#methodology">Methodology</a></h3>
<p>My methodology for gathering this information is that the plugin is looking to get the Django application (Sites, Devices, IPAM)</p>
<h3 id="environment"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#environment">Environment</a></h3>
<p>For this demo, here are the versions shown:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>NetBox</td>
<td>v2.9.9 <a href="https://github.com/netbox-community/netbox-docker">(NetBox Docker)</a></td>
</tr>
<tr>
<td>NetBox Ansible Collection</td>
<td>v1.1.0</td>
</tr>
<tr>
<td>pynetbox</td>
<td>5.1.0</td>
</tr>
</tbody>
</table>
<h3 id="query-plugin-note"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#query-plugin-note">Query Plugin Note</a></h3>
<p>So I was originally trying to use the Jinja variable template when I was working with the plugin. The query function does not need the templating language (wrapped in <code>{{ }}</code>). The variable name <em>should</em> be used without the wrapping and just work.</p>
<h3 id="parameter-terms"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#parameter-terms">Parameter: Terms</a></h3>
<p>The parameter <code>_terms</code> as I can understand relates to which end point within the pynetbox endpoint is being referenced. Digging into the code itself, I have found that the following is the available endpoints:</p>
<table>
<thead>
<tr>
<th>Lookup Endpoint</th>
<th>Corresponding pynetbox endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td>aggregates</td>
<td>netbox.ipam.aggregates</td>
</tr>
<tr>
<td>circuit-terminations</td>
<td>netbox.circuits.circuit_terminations</td>
</tr>
<tr>
<td>circuit-types</td>
<td>netbox.circuits.circuit_types</td>
</tr>
<tr>
<td>circuits</td>
<td>netbox.circuits.circuits</td>
</tr>
<tr>
<td>circuit-providers</td>
<td>netbox.circuits.providers</td>
</tr>
<tr>
<td>cables</td>
<td>netbox.dcim.cables</td>
</tr>
<tr>
<td>cluster-groups</td>
<td>netbox.virtualization.cluster_groups</td>
</tr>
<tr>
<td>cluster-types</td>
<td>netbox.virtualization.cluster_types</td>
</tr>
<tr>
<td>clusters</td>
<td>netbox.virtualization.clusters</td>
</tr>
<tr>
<td>config-contexts</td>
<td>netbox.extras.config_contexts</td>
</tr>
<tr>
<td>console-connections</td>
<td>netbox.dcim.console_connections</td>
</tr>
<tr>
<td>console-ports</td>
<td>netbox.dcim.console_ports</td>
</tr>
<tr>
<td>console-server-port-templates"</td>
<td>netbox.dcim.console_server_port_templates</td>
</tr>
<tr>
<td>console-server-ports</td>
<td>netbox.dcim.console_server_ports</td>
</tr>
<tr>
<td>device-bay-templates</td>
<td>netbox.dcim.device_bay_templates</td>
</tr>
<tr>
<td>device-bays</td>
<td>netbox.dcim.device_bays</td>
</tr>
<tr>
<td>device-roles</td>
<td>netbox.dcim.device_roles</td>
</tr>
<tr>
<td>device-types</td>
<td>netbox.dcim.device_types</td>
</tr>
<tr>
<td>devices</td>
<td>netbox.dcim.devices</td>
</tr>
<tr>
<td>export-templates</td>
<td>netbox.dcim.export_templates</td>
</tr>
<tr>
<td>front-port-templates</td>
<td>netbox.dcim.front_port_templates</td>
</tr>
<tr>
<td>front-ports</td>
<td>netbox.dcim.front_ports</td>
</tr>
<tr>
<td>graphs</td>
<td>netbox.extras.graphs</td>
</tr>
<tr>
<td>image-attachments</td>
<td>netbox.extras.image_attachments</td>
</tr>
<tr>
<td>interface-connections</td>
<td>netbox.dcim.interface_connections</td>
</tr>
<tr>
<td>interface-templates</td>
<td>netbox.dcim.interface_templates</td>
</tr>
<tr>
<td>interfaces</td>
<td>netbox.dcim.interfaces</td>
</tr>
<tr>
<td>inventory-items</td>
<td>netbox.dcim.inventory_items</td>
</tr>
<tr>
<td>ip-addresses</td>
<td>netbox.ipam.ip_addresses</td>
</tr>
<tr>
<td>manufacturers</td>
<td>netbox.dcim.manufacturers</td>
</tr>
<tr>
<td>object-changes</td>
<td>netbox.extras.object_changes</td>
</tr>
<tr>
<td>platforms</td>
<td>netbox.dcim.platforms</td>
</tr>
<tr>
<td>power-connections</td>
<td>netbox.dcim.power_connections</td>
</tr>
<tr>
<td>power-outlet-templates</td>
<td>netbox.dcim.power_outlet_templates</td>
</tr>
<tr>
<td>power-outlets</td>
<td>netbox.dcim.power_outlets</td>
</tr>
<tr>
<td>power-port-templates</td>
<td>netbox.dcim.power_port_templates</td>
</tr>
<tr>
<td>power-ports</td>
<td>netbox.dcim.power_ports</td>
</tr>
<tr>
<td>prefixes</td>
<td>netbox.ipam.prefixes</td>
</tr>
<tr>
<td>rack-groups</td>
<td>netbox.dcim.rack_groups</td>
</tr>
<tr>
<td>rack-reservations</td>
<td>netbox.dcim.rack_reservations</td>
</tr>
<tr>
<td>rack-roles</td>
<td>netbox.dcim.rack_roles</td>
</tr>
<tr>
<td>racks</td>
<td>netbox.dcim.racks</td>
</tr>
<tr>
<td>rear-port-templates</td>
<td>netbox.dcim.rear_port_templates</td>
</tr>
<tr>
<td>rear-ports</td>
<td>netbox.dcim.rear_ports</td>
</tr>
<tr>
<td>regions</td>
<td>netbox.dcim.regions</td>
</tr>
<tr>
<td>reports</td>
<td>netbox.extras.reports</td>
</tr>
<tr>
<td>rirs</td>
<td>netbox.ipam.rirs</td>
</tr>
<tr>
<td>roles</td>
<td>netbox.ipam.roles</td>
</tr>
<tr>
<td>secret-roles</td>
<td>netbox.secrets.secret_roles</td>
</tr>
<tr>
<td>secrets</td>
<td>netbox.secrets.secrets</td>
</tr>
<tr>
<td>services</td>
<td>netbox.ipam.services</td>
</tr>
<tr>
<td>sites</td>
<td>netbox.dcim.sites</td>
</tr>
<tr>
<td>tags</td>
<td>netbox.extras.tags</td>
</tr>
<tr>
<td>tenant-groups</td>
<td>netbox.tenancy.tenant_groups</td>
</tr>
<tr>
<td>tenants</td>
<td>netbox.tenancy.tenants</td>
</tr>
<tr>
<td>topology-maps</td>
<td>netbox.extras.topology_maps</td>
</tr>
<tr>
<td>virtual-chassis</td>
<td>netbox.dcim.virtual_chassis</td>
</tr>
<tr>
<td>virtual-machines</td>
<td>netbox.virtualization.virtual_machines</td>
</tr>
<tr>
<td>virtualization-interfaces</td>
<td>netbox.virtualization.interfaces</td>
</tr>
<tr>
<td>vlan-groups</td>
<td>netbox.ipam.vlan_groups</td>
</tr>
<tr>
<td>vlans</td>
<td>netbox.ipam.vlans</td>
</tr>
<tr>
<td>vrfs</td>
<td>netbox.ipam.vrfs</td>
</tr>
</tbody>
</table>
<h3 id="examples"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#examples">Examples</a></h3>
<p>The goal is to really dig into the examples to see how it is used. Let's get right to it. For these demos I am using the following definitions for the Play:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nn">---</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GATHER</span><span class="nv"> </span><span class="s">DATA</span><span class="nv"> </span><span class="s">FROM</span><span class="nv"> </span><span class="s">NETBOX&quot;</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">    </span><span class="nt">netbox_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_API&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">    </span><span class="nt">netbox_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>Of note, the URL and token are embedded into the environment. To maintain consistency with the NetBox Inventory plugin I am mapping <code>NETBOX_API</code> to be the netbox_url. At this moment of writing the lookup plugin does not natively lookup the environment like the other modules do. I do intended to submit a <a href="https://github.com/netbox-community/ansible_modules/pull/391">PR</a> to update this.</p>
<h4 id="gathering-sites"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#gathering-sites">Gathering Sites</a></h4>
<p>When taking a look at gathering sites the following task is used:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">GET</span><span class="nv"> </span><span class="s">SITES</span><span class="nv"> </span><span class="s">WITH</span><span class="nv"> </span><span class="s">NB_QUERY&quot;</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">    </span><span class="nt">sites</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;sites&#39;,</span><span class="nv"> </span><span class="s">api_endpoint=netbox_url,</span><span class="nv"> </span><span class="s">token=netbox_token)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">PRINT</span><span class="nv"> </span><span class="s">JUST</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">SITE</span><span class="nv"> </span><span class="s">NAMES&quot;</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">sites</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">json_query(&#39;[*].value.name&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<h5 id="gathering-sites-task-1-output"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#gathering-sites-task-1-output">Gathering Sites: TASK 1 Output</a></h5>
<p>Lines 1-3 are the collecting of data from NetBox itself. In my NetBox demo environment I currently have 4 sites. Instead of giving you the entire output that is quite long, below is that output. Note that there is a bunch of information available to you about each site here.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span>
<span class="normal"><a href="#__codelineno-41-19">19</a></span>
<span class="normal"><a href="#__codelineno-41-20">20</a></span>
<span class="normal"><a href="#__codelineno-41-21">21</a></span>
<span class="normal"><a href="#__codelineno-41-22">22</a></span>
<span class="normal"><a href="#__codelineno-41-23">23</a></span>
<span class="normal"><a href="#__codelineno-41-24">24</a></span>
<span class="normal"><a href="#__codelineno-41-25">25</a></span>
<span class="normal"><a href="#__codelineno-41-26">26</a></span>
<span class="normal"><a href="#__codelineno-41-27">27</a></span>
<span class="normal"><a href="#__codelineno-41-28">28</a></span>
<span class="normal"><a href="#__codelineno-41-29">29</a></span>
<span class="normal"><a href="#__codelineno-41-30">30</a></span>
<span class="normal"><a href="#__codelineno-41-31">31</a></span>
<span class="normal"><a href="#__codelineno-41-32">32</a></span>
<span class="normal"><a href="#__codelineno-41-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="w">        </span><span class="nt">asn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">        </span><span class="nt">circuit_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="w">        </span><span class="nt">comments</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="w">        </span><span class="nt">contact_email</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">        </span><span class="nt">contact_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="w">        </span><span class="nt">contact_phone</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="w">        </span><span class="nt">created</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-12-06&#39;</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="w">        </span><span class="nt">custom_fields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Portland</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="w">        </span><span class="nt">device_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="w">        </span><span class="nt">facility</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="w">        </span><span class="nt">last_updated</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-12-06T15:29:45.112426Z&#39;</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="w">        </span><span class="nt">latitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="w">        </span><span class="nt">longitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19"></a><span class="w">        </span><span class="nt">physical_address</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="w">        </span><span class="nt">prefix_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21"></a><span class="w">        </span><span class="nt">rack_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22"></a><span class="w">        </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23"></a><span class="w">        </span><span class="nt">shipping_address</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24"></a><span class="w">        </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pdx</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25"></a><span class="w">        </span><span class="nt">status</span><span class="p">:</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26"></a><span class="w">          </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Active</span>
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28"></a><span class="w">        </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29"></a><span class="w">        </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30"></a><span class="w">        </span><span class="nt">time_zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">America/Los_Angeles</span>
</span><span id="__span-41-31"><a id="__codelineno-41-31" name="__codelineno-41-31"></a><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/sites/6/</span>
</span><span id="__span-41-32"><a id="__codelineno-41-32" name="__codelineno-41-32"></a><span class="w">        </span><span class="nt">virtualmachine_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-41-33"><a id="__codelineno-41-33" name="__codelineno-41-33"></a><span class="w">        </span><span class="nt">vlan_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span></code></pre></div></td></tr></table></div>
<h5 id="gathering-sites-task-2-output-getting-just-the-site-names"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#gathering-sites-task-2-output-getting-just-the-site-names">Gathering Sites: TASK 2 Output - Getting Just the Site Names</a></h5>
<p>I used json_query (which uses JMESPATH) to get just the site names. I see a future post on this coming in the future. The result of this gives me the output of just the four sites and not the rest of the data:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span>
<span class="normal"><a href="#__codelineno-42-4">4</a></span>
<span class="normal"><a href="#__codelineno-42-5">5</a></span>
<span class="normal"><a href="#__codelineno-42-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt;</span><span class="w"> </span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MSP</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NYC</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PDX</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="get-devices-filtered-to-a-single-site"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#get-devices-filtered-to-a-single-site">Get Devices - Filtered to a single site</a></h4>
<p>You can then filter with the lookup plugin as well. In these two tasks I'm going to filter and get the devices that are located at the DEN site. Task 3 you add the <code>api_filter</code> to the plugin definition on the set_fact. The API filters are key/value and are separated with a space inside of the string to have multiple searches. If you wish to search multiple sites or multiple roles (or multiple anything) then you add a second instance of it. The value of the key/value pair is the corresponding <strong>slug</strong> associated with the search.  </p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">3:</span><span class="nv"> </span><span class="s">GET</span><span class="nv"> </span><span class="s">DEVICES</span><span class="nv"> </span><span class="s">WITH</span><span class="nv"> </span><span class="s">ROLE</span><span class="nv"> </span><span class="s">ROUTER</span><span class="nv"> </span><span class="s">AT</span><span class="nv"> </span><span class="s">DEN</span><span class="nv"> </span><span class="s">SITE&quot;</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">  </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span><span class="nt">den_devices</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;devices&#39;,</span><span class="nv"> </span><span class="s">api_filter=&#39;site=den</span><span class="nv"> </span><span class="s">role=router&#39;,</span><span class="nv"> </span><span class="s">api_endpoint=netbox_url,</span><span class="nv"> </span><span class="s">token=netbox_token)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">4:</span><span class="nv"> </span><span class="s">PRINT</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">DEVICES&quot;</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">den_devices</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">json_query(&#39;[*].value.name&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<h5 id="getting-denver-routers-output"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#getting-denver-routers-output">Getting Denver Routers Output</a></h5>
<p>The output from these two tasks where there is a single router device at the site Denver is then the following output with the single device on line 77.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span>
<span class="normal"><a href="#__codelineno-44-15">15</a></span>
<span class="normal"><a href="#__codelineno-44-16">16</a></span>
<span class="normal"><a href="#__codelineno-44-17">17</a></span>
<span class="normal"><a href="#__codelineno-44-18">18</a></span>
<span class="normal"><a href="#__codelineno-44-19">19</a></span>
<span class="normal"><a href="#__codelineno-44-20">20</a></span>
<span class="normal"><a href="#__codelineno-44-21">21</a></span>
<span class="normal"><a href="#__codelineno-44-22">22</a></span>
<span class="normal"><a href="#__codelineno-44-23">23</a></span>
<span class="normal"><a href="#__codelineno-44-24">24</a></span>
<span class="normal"><a href="#__codelineno-44-25">25</a></span>
<span class="normal"><a href="#__codelineno-44-26">26</a></span>
<span class="normal"><a href="#__codelineno-44-27">27</a></span>
<span class="normal"><a href="#__codelineno-44-28">28</a></span>
<span class="normal"><a href="#__codelineno-44-29">29</a></span>
<span class="normal"><a href="#__codelineno-44-30">30</a></span>
<span class="normal"><a href="#__codelineno-44-31">31</a></span>
<span class="normal"><a href="#__codelineno-44-32">32</a></span>
<span class="normal"><a href="#__codelineno-44-33">33</a></span>
<span class="normal"><a href="#__codelineno-44-34">34</a></span>
<span class="normal"><a href="#__codelineno-44-35">35</a></span>
<span class="normal"><a href="#__codelineno-44-36">36</a></span>
<span class="normal"><a href="#__codelineno-44-37">37</a></span>
<span class="normal"><a href="#__codelineno-44-38">38</a></span>
<span class="normal"><a href="#__codelineno-44-39">39</a></span>
<span class="normal"><a href="#__codelineno-44-40">40</a></span>
<span class="normal"><a href="#__codelineno-44-41">41</a></span>
<span class="normal"><a href="#__codelineno-44-42">42</a></span>
<span class="normal"><a href="#__codelineno-44-43">43</a></span>
<span class="normal"><a href="#__codelineno-44-44">44</a></span>
<span class="normal"><a href="#__codelineno-44-45">45</a></span>
<span class="normal"><a href="#__codelineno-44-46">46</a></span>
<span class="normal"><a href="#__codelineno-44-47">47</a></span>
<span class="normal"><a href="#__codelineno-44-48">48</a></span>
<span class="normal"><a href="#__codelineno-44-49">49</a></span>
<span class="normal"><a href="#__codelineno-44-50">50</a></span>
<span class="normal"><a href="#__codelineno-44-51">51</a></span>
<span class="normal"><a href="#__codelineno-44-52">52</a></span>
<span class="normal"><a href="#__codelineno-44-53">53</a></span>
<span class="normal"><a href="#__codelineno-44-54">54</a></span>
<span class="normal"><a href="#__codelineno-44-55">55</a></span>
<span class="normal"><a href="#__codelineno-44-56">56</a></span>
<span class="normal"><a href="#__codelineno-44-57">57</a></span>
<span class="normal"><a href="#__codelineno-44-58">58</a></span>
<span class="normal"><a href="#__codelineno-44-59">59</a></span>
<span class="normal"><a href="#__codelineno-44-60">60</a></span>
<span class="normal"><a href="#__codelineno-44-61">61</a></span>
<span class="normal"><a href="#__codelineno-44-62">62</a></span>
<span class="normal"><a href="#__codelineno-44-63">63</a></span>
<span class="normal"><a href="#__codelineno-44-64">64</a></span>
<span class="normal"><a href="#__codelineno-44-65">65</a></span>
<span class="normal"><a href="#__codelineno-44-66">66</a></span>
<span class="normal"><a href="#__codelineno-44-67">67</a></span>
<span class="normal"><a href="#__codelineno-44-68">68</a></span>
<span class="normal"><a href="#__codelineno-44-69">69</a></span>
<span class="normal"><a href="#__codelineno-44-70">70</a></span>
<span class="normal"><a href="#__codelineno-44-71">71</a></span>
<span class="normal"><a href="#__codelineno-44-72">72</a></span>
<span class="normal"><a href="#__codelineno-44-73">73</a></span>
<span class="normal"><a href="#__codelineno-44-74">74</a></span>
<span class="normal"><a href="#__codelineno-44-75">75</a></span>
<span class="normal"><a href="#__codelineno-44-76">76</a></span>
<span class="normal"><a href="#__codelineno-44-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 3</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GET ROLE ROUTERS AT DEN SITE] **************************************************************************************************************************</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts</span><span class="p p-Indicator">:</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">    </span><span class="nt">den_devices</span><span class="p">:</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="w">      </span><span class="nt">value</span><span class="p">:</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="w">        </span><span class="nt">asset_tag</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="w">        </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="w">        </span><span class="nt">comments</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="w">        </span><span class="nt">config_context</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="w">        </span><span class="nt">created</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-12-06&#39;</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="w">        </span><span class="nt">custom_fields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="w">        </span><span class="nt">device_role</span><span class="p">:</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Router</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">router</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/device-roles/3/</span>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17"></a><span class="w">        </span><span class="nt">device_type</span><span class="p">:</span>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18"></a><span class="w">          </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cisco IOSV</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20"></a><span class="w">          </span><span class="nt">manufacturer</span><span class="p">:</span>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21"></a><span class="w">            </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cisco</span>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23"></a><span class="w">            </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24"></a><span class="w">            </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/manufacturers/1/</span>
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25"></a><span class="w">          </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IOSV</span>
</span><span id="__span-44-26"><a id="__codelineno-44-26" name="__codelineno-44-26"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iosv</span>
</span><span id="__span-44-27"><a id="__codelineno-44-27" name="__codelineno-44-27"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/device-types/3/</span>
</span><span id="__span-44-28"><a id="__codelineno-44-28" name="__codelineno-44-28"></a><span class="w">        </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-wan01</span>
</span><span id="__span-44-29"><a id="__codelineno-44-29" name="__codelineno-44-29"></a><span class="w">        </span><span class="nt">face</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-30"><a id="__codelineno-44-30" name="__codelineno-44-30"></a><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-44-31"><a id="__codelineno-44-31" name="__codelineno-44-31"></a><span class="w">        </span><span class="nt">last_updated</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-12-12T19:55:16.432666Z&#39;</span>
</span><span id="__span-44-32"><a id="__codelineno-44-32" name="__codelineno-44-32"></a><span class="w">        </span><span class="nt">local_context_data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-33"><a id="__codelineno-44-33" name="__codelineno-44-33"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-wan01</span>
</span><span id="__span-44-34"><a id="__codelineno-44-34" name="__codelineno-44-34"></a><span class="w">        </span><span class="nt">parent_device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-35"><a id="__codelineno-44-35" name="__codelineno-44-35"></a><span class="w">        </span><span class="nt">platform</span><span class="p">:</span>
</span><span id="__span-44-36"><a id="__codelineno-44-36" name="__codelineno-44-36"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-44-37"><a id="__codelineno-44-37" name="__codelineno-44-37"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco_ios</span>
</span><span id="__span-44-38"><a id="__codelineno-44-38" name="__codelineno-44-38"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ios</span>
</span><span id="__span-44-39"><a id="__codelineno-44-39" name="__codelineno-44-39"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/platforms/2/</span>
</span><span id="__span-44-40"><a id="__codelineno-44-40" name="__codelineno-44-40"></a><span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-41"><a id="__codelineno-44-41" name="__codelineno-44-41"></a><span class="w">        </span><span class="nt">primary_ip</span><span class="p">:</span>
</span><span id="__span-44-42"><a id="__codelineno-44-42" name="__codelineno-44-42"></a><span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.16.0.2/24</span>
</span><span id="__span-44-43"><a id="__codelineno-44-43" name="__codelineno-44-43"></a><span class="w">          </span><span class="nt">family</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-44-44"><a id="__codelineno-44-44" name="__codelineno-44-44"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-44-45"><a id="__codelineno-44-45" name="__codelineno-44-45"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/ipam/ip-addresses/4/</span>
</span><span id="__span-44-46"><a id="__codelineno-44-46" name="__codelineno-44-46"></a><span class="w">        </span><span class="nt">primary_ip4</span><span class="p">:</span>
</span><span id="__span-44-47"><a id="__codelineno-44-47" name="__codelineno-44-47"></a><span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.16.0.2/24</span>
</span><span id="__span-44-48"><a id="__codelineno-44-48" name="__codelineno-44-48"></a><span class="w">          </span><span class="nt">family</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-44-49"><a id="__codelineno-44-49" name="__codelineno-44-49"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-44-50"><a id="__codelineno-44-50" name="__codelineno-44-50"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/ipam/ip-addresses/4/</span>
</span><span id="__span-44-51"><a id="__codelineno-44-51" name="__codelineno-44-51"></a><span class="w">        </span><span class="nt">primary_ip6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-52"><a id="__codelineno-44-52" name="__codelineno-44-52"></a><span class="w">        </span><span class="nt">rack</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-53"><a id="__codelineno-44-53" name="__codelineno-44-53"></a><span class="w">        </span><span class="nt">serial</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90Q1VEN47MPBMU2718KJ1</span>
</span><span id="__span-44-54"><a id="__codelineno-44-54" name="__codelineno-44-54"></a><span class="w">        </span><span class="nt">site</span><span class="p">:</span>
</span><span id="__span-44-55"><a id="__codelineno-44-55" name="__codelineno-44-55"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-44-56"><a id="__codelineno-44-56" name="__codelineno-44-56"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-44-57"><a id="__codelineno-44-57" name="__codelineno-44-57"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den</span>
</span><span id="__span-44-58"><a id="__codelineno-44-58" name="__codelineno-44-58"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/sites/4/</span>
</span><span id="__span-44-59"><a id="__codelineno-44-59" name="__codelineno-44-59"></a><span class="w">        </span><span class="nt">status</span><span class="p">:</span>
</span><span id="__span-44-60"><a id="__codelineno-44-60" name="__codelineno-44-60"></a><span class="w">          </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Active</span>
</span><span id="__span-44-61"><a id="__codelineno-44-61" name="__codelineno-44-61"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-44-62"><a id="__codelineno-44-62" name="__codelineno-44-62"></a><span class="w">        </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-44-63"><a id="__codelineno-44-63" name="__codelineno-44-63"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">color</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3f51b5</span>
</span><span id="__span-44-64"><a id="__codelineno-44-64" name="__codelineno-44-64"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-44-65"><a id="__codelineno-44-65" name="__codelineno-44-65"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snmp_monitoring</span>
</span><span id="__span-44-66"><a id="__codelineno-44-66" name="__codelineno-44-66"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snmp_monitoring</span>
</span><span id="__span-44-67"><a id="__codelineno-44-67" name="__codelineno-44-67"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/extras/tags/2/</span>
</span><span id="__span-44-68"><a id="__codelineno-44-68" name="__codelineno-44-68"></a><span class="w">        </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-69"><a id="__codelineno-44-69" name="__codelineno-44-69"></a><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/devices/4/</span>
</span><span id="__span-44-70"><a id="__codelineno-44-70" name="__codelineno-44-70"></a><span class="w">        </span><span class="nt">vc_position</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-71"><a id="__codelineno-44-71" name="__codelineno-44-71"></a><span class="w">        </span><span class="nt">vc_priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-72"><a id="__codelineno-44-72" name="__codelineno-44-72"></a><span class="w">        </span><span class="nt">virtual_chassis</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-44-73"><a id="__codelineno-44-73" name="__codelineno-44-73"></a>
</span><span id="__span-44-74"><a id="__codelineno-44-74" name="__codelineno-44-74"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 4</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PRINT THE DEVICES OF TYPE ROUTER AT DENVER LOCATION] ***************************************************************************************************</span>
</span><span id="__span-44-75"><a id="__codelineno-44-75" name="__codelineno-44-75"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt;</span><span class="w"> </span>
</span><span id="__span-44-76"><a id="__codelineno-44-76" name="__codelineno-44-76"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span>
</span><span id="__span-44-77"><a id="__codelineno-44-77" name="__codelineno-44-77"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-wan01</span>
</span></code></pre></div></td></tr></table></div>
<h5 id="searching-multiple-locations"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#searching-multiple-locations">Searching Multiple Locations</a></h5>
<p>With this you are able to filter many things. To filter multiple sites, say you wanted to get the devices at both of the sites DEN and MSP. To do this you change the filter to be <code>site=den site=-msp</code>. Seeing this you get the following:</p>
<blockquote>
<p>I am only showing a single device corresponding to MSP &amp; DEN site.</p>
</blockquote>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span>
<span class="normal"><a href="#__codelineno-45-17">17</a></span>
<span class="normal"><a href="#__codelineno-45-18">18</a></span>
<span class="normal"><a href="#__codelineno-45-19">19</a></span>
<span class="normal"><a href="#__codelineno-45-20">20</a></span>
<span class="normal"><a href="#__codelineno-45-21">21</a></span>
<span class="normal"><a href="#__codelineno-45-22">22</a></span>
<span class="normal"><a href="#__codelineno-45-23">23</a></span>
<span class="normal"><a href="#__codelineno-45-24">24</a></span>
<span class="normal"><a href="#__codelineno-45-25">25</a></span>
<span class="normal"><a href="#__codelineno-45-26">26</a></span>
<span class="normal"><a href="#__codelineno-45-27">27</a></span>
<span class="normal"><a href="#__codelineno-45-28">28</a></span>
<span class="normal"><a href="#__codelineno-45-29">29</a></span>
<span class="normal"><a href="#__codelineno-45-30">30</a></span>
<span class="normal"><a href="#__codelineno-45-31">31</a></span>
<span class="normal"><a href="#__codelineno-45-32">32</a></span>
<span class="normal"><a href="#__codelineno-45-33">33</a></span>
<span class="normal"><a href="#__codelineno-45-34">34</a></span>
<span class="normal"><a href="#__codelineno-45-35">35</a></span>
<span class="normal"><a href="#__codelineno-45-36">36</a></span>
<span class="normal"><a href="#__codelineno-45-37">37</a></span>
<span class="normal"><a href="#__codelineno-45-38">38</a></span>
<span class="normal"><a href="#__codelineno-45-39">39</a></span>
<span class="normal"><a href="#__codelineno-45-40">40</a></span>
<span class="normal"><a href="#__codelineno-45-41">41</a></span>
<span class="normal"><a href="#__codelineno-45-42">42</a></span>
<span class="normal"><a href="#__codelineno-45-43">43</a></span>
<span class="normal"><a href="#__codelineno-45-44">44</a></span>
<span class="normal"><a href="#__codelineno-45-45">45</a></span>
<span class="normal"><a href="#__codelineno-45-46">46</a></span>
<span class="normal"><a href="#__codelineno-45-47">47</a></span>
<span class="normal"><a href="#__codelineno-45-48">48</a></span>
<span class="normal"><a href="#__codelineno-45-49">49</a></span>
<span class="normal"><a href="#__codelineno-45-50">50</a></span>
<span class="normal"><a href="#__codelineno-45-51">51</a></span>
<span class="normal"><a href="#__codelineno-45-52">52</a></span>
<span class="normal"><a href="#__codelineno-45-53">53</a></span>
<span class="normal"><a href="#__codelineno-45-54">54</a></span>
<span class="normal"><a href="#__codelineno-45-55">55</a></span>
<span class="normal"><a href="#__codelineno-45-56">56</a></span>
<span class="normal"><a href="#__codelineno-45-57">57</a></span>
<span class="normal"><a href="#__codelineno-45-58">58</a></span>
<span class="normal"><a href="#__codelineno-45-59">59</a></span>
<span class="normal"><a href="#__codelineno-45-60">60</a></span>
<span class="normal"><a href="#__codelineno-45-61">61</a></span>
<span class="normal"><a href="#__codelineno-45-62">62</a></span>
<span class="normal"><a href="#__codelineno-45-63">63</a></span>
<span class="normal"><a href="#__codelineno-45-64">64</a></span>
<span class="normal"><a href="#__codelineno-45-65">65</a></span>
<span class="normal"><a href="#__codelineno-45-66">66</a></span>
<span class="normal"><a href="#__codelineno-45-67">67</a></span>
<span class="normal"><a href="#__codelineno-45-68">68</a></span>
<span class="normal"><a href="#__codelineno-45-69">69</a></span>
<span class="normal"><a href="#__codelineno-45-70">70</a></span>
<span class="normal"><a href="#__codelineno-45-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="w">  </span><span class="nt">ansible_facts</span><span class="p">:</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="w">    </span><span class="nt">msp_den_devices</span><span class="p">:</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">      </span><span class="nt">value</span><span class="p">:</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="w">        </span><span class="nt">asset_tag</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="w">        </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="w">        </span><span class="nt">comments</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="w">        </span><span class="nt">config_context</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="w">        </span><span class="nt">created</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-12-06&#39;</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="w">        </span><span class="nt">custom_fields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="w">        </span><span class="nt">device_role</span><span class="p">:</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Network</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/device-roles/2/</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="w">        </span><span class="nt">device_type</span><span class="p">:</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17"></a><span class="w">          </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cisco IOSV</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19"></a><span class="w">          </span><span class="nt">manufacturer</span><span class="p">:</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20"></a><span class="w">            </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cisco</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22"></a><span class="w">            </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23"></a><span class="w">            </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/manufacturers/1/</span>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24"></a><span class="w">          </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IOSV</span>
</span><span id="__span-45-25"><a id="__codelineno-45-25" name="__codelineno-45-25"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iosv</span>
</span><span id="__span-45-26"><a id="__codelineno-45-26" name="__codelineno-45-26"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/device-types/3/</span>
</span><span id="__span-45-27"><a id="__codelineno-45-27" name="__codelineno-45-27"></a><span class="w">        </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-dist01</span>
</span><span id="__span-45-28"><a id="__codelineno-45-28" name="__codelineno-45-28"></a><span class="w">        </span><span class="nt">face</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-29"><a id="__codelineno-45-29" name="__codelineno-45-29"></a><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-45-30"><a id="__codelineno-45-30" name="__codelineno-45-30"></a><span class="w">        </span><span class="nt">last_updated</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-12-06T17:16:02.266041Z&#39;</span>
</span><span id="__span-45-31"><a id="__codelineno-45-31" name="__codelineno-45-31"></a><span class="w">        </span><span class="nt">local_context_data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-32"><a id="__codelineno-45-32" name="__codelineno-45-32"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-dist01</span>
</span><span id="__span-45-33"><a id="__codelineno-45-33" name="__codelineno-45-33"></a><span class="w">        </span><span class="nt">parent_device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-34"><a id="__codelineno-45-34" name="__codelineno-45-34"></a><span class="w">        </span><span class="nt">platform</span><span class="p">:</span>
</span><span id="__span-45-35"><a id="__codelineno-45-35" name="__codelineno-45-35"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-45-36"><a id="__codelineno-45-36" name="__codelineno-45-36"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco_ios</span>
</span><span id="__span-45-37"><a id="__codelineno-45-37" name="__codelineno-45-37"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ios</span>
</span><span id="__span-45-38"><a id="__codelineno-45-38" name="__codelineno-45-38"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/platforms/2/</span>
</span><span id="__span-45-39"><a id="__codelineno-45-39" name="__codelineno-45-39"></a><span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-40"><a id="__codelineno-45-40" name="__codelineno-45-40"></a><span class="w">        </span><span class="nt">primary_ip</span><span class="p">:</span>
</span><span id="__span-45-41"><a id="__codelineno-45-41" name="__codelineno-45-41"></a><span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.17.1.2/30</span>
</span><span id="__span-45-42"><a id="__codelineno-45-42" name="__codelineno-45-42"></a><span class="w">          </span><span class="nt">family</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-45-43"><a id="__codelineno-45-43" name="__codelineno-45-43"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-45-44"><a id="__codelineno-45-44" name="__codelineno-45-44"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/ipam/ip-addresses/5/</span>
</span><span id="__span-45-45"><a id="__codelineno-45-45" name="__codelineno-45-45"></a><span class="w">        </span><span class="nt">primary_ip4</span><span class="p">:</span>
</span><span id="__span-45-46"><a id="__codelineno-45-46" name="__codelineno-45-46"></a><span class="w">          </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.17.1.2/30</span>
</span><span id="__span-45-47"><a id="__codelineno-45-47" name="__codelineno-45-47"></a><span class="w">          </span><span class="nt">family</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-45-48"><a id="__codelineno-45-48" name="__codelineno-45-48"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-45-49"><a id="__codelineno-45-49" name="__codelineno-45-49"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/ipam/ip-addresses/5/</span>
</span><span id="__span-45-50"><a id="__codelineno-45-50" name="__codelineno-45-50"></a><span class="w">        </span><span class="nt">primary_ip6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-51"><a id="__codelineno-45-51" name="__codelineno-45-51"></a><span class="w">        </span><span class="nt">rack</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-52"><a id="__codelineno-45-52" name="__codelineno-45-52"></a><span class="w">        </span><span class="nt">serial</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9ZYX8XZUMP0AF69YGO5Z5</span>
</span><span id="__span-45-53"><a id="__codelineno-45-53" name="__codelineno-45-53"></a><span class="w">        </span><span class="nt">site</span><span class="p">:</span>
</span><span id="__span-45-54"><a id="__codelineno-45-54" name="__codelineno-45-54"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-45-55"><a id="__codelineno-45-55" name="__codelineno-45-55"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEN</span>
</span><span id="__span-45-56"><a id="__codelineno-45-56" name="__codelineno-45-56"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den</span>
</span><span id="__span-45-57"><a id="__codelineno-45-57" name="__codelineno-45-57"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/sites/4/</span>
</span><span id="__span-45-58"><a id="__codelineno-45-58" name="__codelineno-45-58"></a><span class="w">        </span><span class="nt">status</span><span class="p">:</span>
</span><span id="__span-45-59"><a id="__codelineno-45-59" name="__codelineno-45-59"></a><span class="w">          </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Active</span>
</span><span id="__span-45-60"><a id="__codelineno-45-60" name="__codelineno-45-60"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-45-61"><a id="__codelineno-45-61" name="__codelineno-45-61"></a><span class="w">        </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-45-62"><a id="__codelineno-45-62" name="__codelineno-45-62"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">color</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3f51b5</span>
</span><span id="__span-45-63"><a id="__codelineno-45-63" name="__codelineno-45-63"></a><span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-45-64"><a id="__codelineno-45-64" name="__codelineno-45-64"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snmp_monitoring</span>
</span><span id="__span-45-65"><a id="__codelineno-45-65" name="__codelineno-45-65"></a><span class="w">          </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snmp_monitoring</span>
</span><span id="__span-45-66"><a id="__codelineno-45-66" name="__codelineno-45-66"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/extras/tags/2/</span>
</span><span id="__span-45-67"><a id="__codelineno-45-67" name="__codelineno-45-67"></a><span class="w">        </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-68"><a id="__codelineno-45-68" name="__codelineno-45-68"></a><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/devices/5/</span>
</span><span id="__span-45-69"><a id="__codelineno-45-69" name="__codelineno-45-69"></a><span class="w">        </span><span class="nt">vc_position</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-70"><a id="__codelineno-45-70" name="__codelineno-45-70"></a><span class="w">        </span><span class="nt">vc_priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-45-71"><a id="__codelineno-45-71" name="__codelineno-45-71"></a><span class="w">        </span><span class="nt">virtual_chassis</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span></code></pre></div></td></tr></table></div>
<p>Here is the result of Task 6, which is the list of the devices:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span>
<span class="normal"><a href="#__codelineno-46-4">4</a></span>
<span class="normal"><a href="#__codelineno-46-5">5</a></span>
<span class="normal"><a href="#__codelineno-46-6">6</a></span>
<span class="normal"><a href="#__codelineno-46-7">7</a></span>
<span class="normal"><a href="#__codelineno-46-8">8</a></span>
<span class="normal"><a href="#__codelineno-46-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 6</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PRINT THE DEVICES AT DEN &amp; MSP LOCATIONS] **************************************************************************************************************</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt;</span><span class="w"> </span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-dist01</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-dist02</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-wan01</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">msp-dist01</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">msp-dist02</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">msp-wan01</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="working-with-large-data-sets"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#working-with-large-data-sets">Working With Large Data Sets</a></h3>
<p>One may say that I can just get the data from using the URI module from Ansible. I've been there as well on this. One of the larger draws of using the lookup plugin is the ability to handle pagination of the results natively. Consider the following task, where I have changed the <code>MAX_PAGE_SIZE</code> environment variable to 2 in order to demonstrate the paging setup.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">7:</span><span class="nv"> </span><span class="s">GET</span><span class="nv"> </span><span class="s">DATA</span><span class="nv"> </span><span class="s">FROM</span><span class="nv"> </span><span class="s">NETBOX</span><span class="nv"> </span><span class="s">VIA</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">REST</span><span class="nv"> </span><span class="s">API&quot;</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">  </span><span class="nt">uri</span><span class="p">:</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_URL&#39;)</span><span class="nv"> </span><span class="s">}}/api/dcim/devices/?site=den&amp;limit=2&quot;</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">    </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GET&quot;</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="nt">headers</span><span class="p">:</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">      </span><span class="nt">Content-Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">      </span><span class="nt">Authorization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;token</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">    </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">search_result</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">8:</span><span class="nv"> </span><span class="s">PRINT</span><span class="nv"> </span><span class="s">LENGTH</span><span class="nv"> </span><span class="s">OF</span><span class="nv"> </span><span class="s">PAGED</span><span class="nv"> </span><span class="s">SETUP&quot;</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">    </span><span class="nt">msg</span><span class="p">:</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Length</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">result</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">paginated</span><span class="nv"> </span><span class="s">response:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">search_result[&#39;json&#39;][&#39;results&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">length</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Total</span><span class="nv"> </span><span class="s">results</span><span class="nv"> </span><span class="s">(if</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">paging):</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">search_result[&#39;json&#39;][&#39;count&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>Task 7 gets the data, and looking at the response data coming back we can see that there is a second page by the <strong>next</strong> field:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span>
<span class="normal"><a href="#__codelineno-48-3">3</a></span>
<span class="normal"><a href="#__codelineno-48-4">4</a></span>
<span class="normal"><a href="#__codelineno-48-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="w">  </span><span class="nt">json</span><span class="p">:</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="w">    </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="w">    </span><span class="nt">next</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox-demo/api/dcim/devices/?limit=2&amp;offset=2&amp;site=den</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">    </span><span class="nt">previous</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="w">    </span><span class="nt">results</span><span class="p">:</span>
</span></code></pre></div></td></tr></table></div>
<p>Task 8 then confirms this for us:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span>
<span class="normal"><a href="#__codelineno-49-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="w">  </span><span class="nt">msg</span><span class="p">:</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;Length</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">result</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">paginated</span><span class="nv"> </span><span class="s">response:</span><span class="nv"> </span><span class="s">2&#39;</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;Total</span><span class="nv"> </span><span class="s">results</span><span class="nv"> </span><span class="s">(if</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">paging):</span><span class="nv"> </span><span class="s">3&#39;</span>
</span></code></pre></div></td></tr></table></div>
<p>This is where leveraging pynetbox under the hood and it handling the pagination will be helpful. Some day there may be an Ansible module that handles API calls and combines the results on multiple responses. But today one would need to add a fair amount of logic handling into a Playbook execution to handle pagination.  </p>
<p>The result is handling the paging in the task and makes the life very easy to get data from NetBox with it!</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span>
<span class="normal"><a href="#__codelineno-50-2">2</a></span>
<span class="normal"><a href="#__codelineno-50-3">3</a></span>
<span class="normal"><a href="#__codelineno-50-4">4</a></span>
<span class="normal"><a href="#__codelineno-50-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 10</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PRINT THE DEVICES AT DEN LOCATION] ********************************************************************************************************************</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">localhost</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt;</span><span class="w"> </span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-dist01</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">den-dist02</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="summary"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#summary">Summary</a></h3>
<p>The lookup plugin from the NetBox Ansible Content Collection is a great tool to help get your NetBox search data into your Ansible Playbooks. You can filter as needed, and you get the data into a format that you can then use!</p>
<h3 id="final-playbook"><a class="toclink" href="../../../../netbox-ansible-lookup-plugin/#final-playbook">Final Playbook</a></h3>
<p>Since there were a lot of demos in here, below is the final playbook. In the environment are the NETBOX variables that you set the environment variables and you can use this same playbook to get started. Just make the updates as needed!</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nn">---</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GATHER</span><span class="nv"> </span><span class="s">DATA</span><span class="nv"> </span><span class="s">FROM</span><span class="nv"> </span><span class="s">NETBOX&quot;</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">    </span><span class="nt">netbox_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_API&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">    </span><span class="nt">netbox_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GET</span><span class="nv"> </span><span class="s">SITES</span><span class="nv"> </span><span class="s">WITH</span><span class="nv"> </span><span class="s">NB_QUERY&quot;</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">      </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">        </span><span class="nt">sites</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;sites&#39;,</span><span class="nv"> </span><span class="s">api_endpoint=netbox_url,</span><span class="nv"> </span><span class="s">token=netbox_token)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">sites</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">json_query(&#39;[*].value.name&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">3:</span><span class="nv"> </span><span class="s">GET</span><span class="nv"> </span><span class="s">ROLE</span><span class="nv"> </span><span class="s">ROUTERS</span><span class="nv"> </span><span class="s">AT</span><span class="nv"> </span><span class="s">DEN</span><span class="nv"> </span><span class="s">SITE&quot;</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">      </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="w">        </span><span class="nt">den_devices</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;devices&#39;,</span><span class="nv"> </span><span class="s">api_filter=&#39;site=den</span><span class="nv"> </span><span class="s">role=router&#39;,</span><span class="nv"> </span><span class="s">api_endpoint=netbox_url,</span><span class="nv"> </span><span class="s">token=netbox_token)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">4:</span><span class="nv"> </span><span class="s">PRINT</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">DEVICES</span><span class="nv"> </span><span class="s">OF</span><span class="nv"> </span><span class="s">TYPE</span><span class="nv"> </span><span class="s">ROUTER</span><span class="nv"> </span><span class="s">AT</span><span class="nv"> </span><span class="s">DENVER</span><span class="nv"> </span><span class="s">LOCATION&quot;</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">den_devices</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">json_query(&#39;[*].value.name&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">5:</span><span class="nv"> </span><span class="s">GET</span><span class="nv"> </span><span class="s">DEVICES</span><span class="nv"> </span><span class="s">AT</span><span class="nv"> </span><span class="s">DEN</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">MSP</span><span class="nv"> </span><span class="s">SITES&quot;</span>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="w">      </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="w">        </span><span class="nt">msp_den_devices</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;devices&#39;,</span><span class="nv"> </span><span class="s">api_filter=&#39;site=den</span><span class="nv"> </span><span class="s">site=msp&#39;,</span><span class="nv"> </span><span class="s">api_endpoint=netbox_url,</span><span class="nv"> </span><span class="s">token=netbox_token)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">6:</span><span class="nv"> </span><span class="s">PRINT</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">DEVICES</span><span class="nv"> </span><span class="s">AT</span><span class="nv"> </span><span class="s">DEN</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">MSP</span><span class="nv"> </span><span class="s">LOCATIONS&quot;</span>
</span><span id="__span-51-30"><a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-51-31"><a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msp_den_devices</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">json_query(&#39;[*].value.name&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-32"><a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a>
</span><span id="__span-51-33"><a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">7:</span><span class="nv"> </span><span class="s">GET</span><span class="nv"> </span><span class="s">DATA</span><span class="nv"> </span><span class="s">FROM</span><span class="nv"> </span><span class="s">NETBOX</span><span class="nv"> </span><span class="s">VIA</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">REST</span><span class="nv"> </span><span class="s">API&quot;</span>
</span><span id="__span-51-34"><a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a><span class="w">      </span><span class="nt">uri</span><span class="p">:</span>
</span><span id="__span-51-35"><a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_URL&#39;)</span><span class="nv"> </span><span class="s">}}/api/dcim/devices/?site=den&quot;</span>
</span><span id="__span-51-36"><a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a><span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GET&quot;</span>
</span><span id="__span-51-37"><a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a><span class="w">        </span><span class="nt">headers</span><span class="p">:</span>
</span><span id="__span-51-38"><a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a><span class="w">          </span><span class="nt">Content-Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span>
</span><span id="__span-51-39"><a id="__codelineno-51-39" name="__codelineno-51-39" href="#__codelineno-51-39"></a><span class="w">          </span><span class="nt">Authorization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;token</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-40"><a id="__codelineno-51-40" name="__codelineno-51-40" href="#__codelineno-51-40"></a><span class="w">        </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
</span><span id="__span-51-41"><a id="__codelineno-51-41" name="__codelineno-51-41" href="#__codelineno-51-41"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">search_result</span>
</span><span id="__span-51-42"><a id="__codelineno-51-42" name="__codelineno-51-42" href="#__codelineno-51-42"></a>
</span><span id="__span-51-43"><a id="__codelineno-51-43" name="__codelineno-51-43" href="#__codelineno-51-43"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">8:</span><span class="nv"> </span><span class="s">PRINT</span><span class="nv"> </span><span class="s">LENGTH</span><span class="nv"> </span><span class="s">OF</span><span class="nv"> </span><span class="s">PAGED</span><span class="nv"> </span><span class="s">SETUP&quot;</span>
</span><span id="__span-51-44"><a id="__codelineno-51-44" name="__codelineno-51-44" href="#__codelineno-51-44"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-51-45"><a id="__codelineno-51-45" name="__codelineno-51-45" href="#__codelineno-51-45"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span>
</span><span id="__span-51-46"><a id="__codelineno-51-46" name="__codelineno-51-46" href="#__codelineno-51-46"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Length</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">result</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">paginated</span><span class="nv"> </span><span class="s">response:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">search_result[&#39;json&#39;][&#39;results&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">length</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-47"><a id="__codelineno-51-47" name="__codelineno-51-47" href="#__codelineno-51-47"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;Total</span><span class="nv"> </span><span class="s">results</span><span class="nv"> </span><span class="s">(if</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">paging):</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">search_result[&#39;json&#39;][&#39;count&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-48"><a id="__codelineno-51-48" name="__codelineno-51-48" href="#__codelineno-51-48"></a>
</span><span id="__span-51-49"><a id="__codelineno-51-49" name="__codelineno-51-49" href="#__codelineno-51-49"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">9:</span><span class="nv"> </span><span class="s">GET</span><span class="nv"> </span><span class="s">DEVICES</span><span class="nv"> </span><span class="s">AT</span><span class="nv"> </span><span class="s">DEN</span><span class="nv"> </span><span class="s">SITE&quot;</span>
</span><span id="__span-51-50"><a id="__codelineno-51-50" name="__codelineno-51-50" href="#__codelineno-51-50"></a><span class="w">      </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-51-51"><a id="__codelineno-51-51" name="__codelineno-51-51" href="#__codelineno-51-51"></a><span class="w">        </span><span class="nt">den_devices</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">query(&#39;netbox.netbox.nb_lookup&#39;,</span><span class="nv"> </span><span class="s">&#39;devices&#39;,</span><span class="nv"> </span><span class="s">api_filter=&#39;site=den&#39;,</span><span class="nv"> </span><span class="s">api_endpoint=netbox_url,</span><span class="nv"> </span><span class="s">token=netbox_token)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-51-52"><a id="__codelineno-51-52" name="__codelineno-51-52" href="#__codelineno-51-52"></a>
</span><span id="__span-51-53"><a id="__codelineno-51-53" name="__codelineno-51-53" href="#__codelineno-51-53"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">10:</span><span class="nv"> </span><span class="s">PRINT</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">DEVICES</span><span class="nv"> </span><span class="s">AT</span><span class="nv"> </span><span class="s">DEN</span><span class="nv"> </span><span class="s">LOCATION&quot;</span>
</span><span id="__span-51-54"><a id="__codelineno-51-54" name="__codelineno-51-54" href="#__codelineno-51-54"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-51-55"><a id="__codelineno-51-55" name="__codelineno-51-55" href="#__codelineno-51-55"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">den_devices</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">json_query(&#39;[*].value.name&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>Let me know your thoughts below! Like it if you have found it valuable.</p>
<p>Josh</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/22228848" alt="Josh VanDeraa">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-11-29 00:00:00">November 29, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../netbox/" class="md-meta__link">netbox</a>, 
              <a href="../../" class="md-meta__link">ansible</a></li>
        
        
          
          <li class="md-meta__item">
            
              6 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="netbox-ansible-collection-inventory-starting-out"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/">NetBox Ansible Collection: Inventory - Starting Out</a></h2>
<p>The documentation can be found on <a href="https://netbox-ansible-collection.readthedocs.io/en/latest/plugins/inventory/nb_inventory/netbox.netbox.nb_inventory_inventory.html">ReadTheDocs</a>. This is going to be starting out with the basics of the plugin and getting some sample output and to show how to form groups to be used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This post was created when NetBox was an open source project used often in my automation framework. I have moved on to using <a href="https://www.nautobot.com">Nautobot</a> due to the project vision and providing a methodology that will drive network automation forward further. You may want to take a look at it yourself.</p>
</div>
<blockquote>
<p>This particular plugin <strong>DOES NOT</strong> require pynetbox to be used. </p>
</blockquote>
<p>Late addition: You can see a corresponding video on YouTube:</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0;">
  <iframe src="https://www.youtube.com/embed/3NRbIpH5G5Q" 
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" 
          frameborder="0" 
          allowfullscreen>
  </iframe>
</div>

<h3 id="purpose"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/#purpose">Purpose</a></h3>
<p>The purpose of the NetBox Inventory plugin is to provide an inventory to use within your Ansible automations. The plugin will gather information from NetBox and from the data create groups and an inventory for use by Ansible.</p>
<h3 id="install"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/#install">Install</a></h3>
<p>Please checkout the first post in the series for the <a href="https://www.josh-v.com/netbox_ansible_collection/collection_install/">getting started / installation</a> process. </p>
<h3 id="environment"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/#environment">Environment</a></h3>
<p>For this demo, as there are many pieces of information brought back by the inventory I have reduced the inventory to two hosts. </p>
<p>Here are the rest of the installation versions:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>NetBox</td>
<td>v2.9.9 <a href="https://github.com/netbox-community/netbox-docker">(NetBox Docker)</a></td>
</tr>
<tr>
<td>NetBox Ansible Collection</td>
<td>v1.1.0</td>
</tr>
<tr>
<td>pynetbox</td>
<td>Not required - Not installed</td>
</tr>
</tbody>
</table>
<h3 id="basic-setup-no-groups"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/#basic-setup-no-groups">Basic Setup - No Groups</a></h3>
<p>First a good practice for working on systems is to use environment variables to define the server and secret information within the environment. The environment has been configured with for this demo are:</p>
<table>
<thead>
<tr>
<th>Environment Variable Name</th>
<th>What is in the variable</th>
</tr>
</thead>
<tbody>
<tr>
<td>NETBOX_API</td>
<td>API URL for NetBox such as <code>http://netbox.example.com</code></td>
</tr>
<tr>
<td>NETBOX_TOKEN</td>
<td>API Token set inside of NetBox Admin -&gt; Admin -&gt; Tokens</td>
</tr>
</tbody>
</table>
<p>From the documentation these variables if not defined in the inventory YAML file that the plugin will search for the values to be in the environment with <em>NETBOX_API</em> and <em>NETBOX_TOKEN</em>. This allows you to share the inventory file to be shared across multiple NetBox environments, all based on the environment.</p>
<p>You configure the inventory with a YAML file that references the plugin. Here is the starting point to verify that we can get data from NetBox into an inventory before we add some of the filtering and groupings. </p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># netbox_inventory.yml</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nn">---</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">netbox.netbox.nb_inventory</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="nt">config_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span></code></pre></div>
<p>What is being done here:</p>
<table>
<thead>
<tr>
<th>Line Number</th>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>plugin</td>
<td>Which inventory plugin to be used, the FQCN of <code>netbox.netbox.nb_inventory</code></td>
</tr>
<tr>
<td>3</td>
<td>validate_certs</td>
<td>If TLS is configured, then the certificates will not be validated.</td>
</tr>
<tr>
<td>4</td>
<td>config_context</td>
<td>This is important on large NetBox environments. Setting <code>config_context</code> to false tells the API to not return the config_context field, reducing the amount of data being returned.</td>
</tr>
</tbody>
</table>
<p>Alternatively if you do not define the items in the environment, then you would add the keys into the file, such that it looks like below. The rest of the post will assume that the items are configured in the environment.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># netbox_inventory.yml</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nn">---</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">netbox.netbox.nb_inventory</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="nt">api_endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox.example.com</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;API_TOKEN here&gt;</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="nt">config_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span></code></pre></div>
<h4 id="basic-setup-result"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/#basic-setup-result">Basic Setup Result</a></h4>
<p>When executing the inventory <code>ansible-inventory -i netbox_inventory.yml</code>. This example the file name is netbox_inventory.yml. This is completely arbitrary. You can name the inventory any file you wish. Most likely you should name it something that relates to the inventory you are creating. The result of the inventory gives the following:</p>
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span>
<span class="normal"><a href="#__codelineno-35-17">17</a></span>
<span class="normal"><a href="#__codelineno-35-18">18</a></span>
<span class="normal"><a href="#__codelineno-35-19">19</a></span>
<span class="normal"><a href="#__codelineno-35-20">20</a></span>
<span class="normal"><a href="#__codelineno-35-21">21</a></span>
<span class="normal"><a href="#__codelineno-35-22">22</a></span>
<span class="normal"><a href="#__codelineno-35-23">23</a></span>
<span class="normal"><a href="#__codelineno-35-24">24</a></span>
<span class="normal"><a href="#__codelineno-35-25">25</a></span>
<span class="normal"><a href="#__codelineno-35-26">26</a></span>
<span class="normal"><a href="#__codelineno-35-27">27</a></span>
<span class="normal"><a href="#__codelineno-35-28">28</a></span>
<span class="normal"><a href="#__codelineno-35-29">29</a></span>
<span class="normal"><a href="#__codelineno-35-30">30</a></span>
<span class="normal"><a href="#__codelineno-35-31">31</a></span>
<span class="normal"><a href="#__codelineno-35-32">32</a></span>
<span class="normal"><a href="#__codelineno-35-33">33</a></span>
<span class="normal"><a href="#__codelineno-35-34">34</a></span>
<span class="normal"><a href="#__codelineno-35-35">35</a></span>
<span class="normal"><a href="#__codelineno-35-36">36</a></span>
<span class="normal"><a href="#__codelineno-35-37">37</a></span>
<span class="normal"><a href="#__codelineno-35-38">38</a></span>
<span class="normal"><a href="#__codelineno-35-39">39</a></span>
<span class="normal"><a href="#__codelineno-35-40">40</a></span>
<span class="normal"><a href="#__codelineno-35-41">41</a></span>
<span class="normal"><a href="#__codelineno-35-42">42</a></span>
<span class="normal"><a href="#__codelineno-35-43">43</a></span>
<span class="normal"><a href="#__codelineno-35-44">44</a></span>
<span class="normal"><a href="#__codelineno-35-45">45</a></span>
<span class="normal"><a href="#__codelineno-35-46">46</a></span>
<span class="normal"><a href="#__codelineno-35-47">47</a></span>
<span class="normal"><a href="#__codelineno-35-48">48</a></span>
<span class="normal"><a href="#__codelineno-35-49">49</a></span>
<span class="normal"><a href="#__codelineno-35-50">50</a></span>
<span class="normal"><a href="#__codelineno-35-51">51</a></span>
<span class="normal"><a href="#__codelineno-35-52">52</a></span>
<span class="normal"><a href="#__codelineno-35-53">53</a></span>
<span class="normal"><a href="#__codelineno-35-54">54</a></span>
<span class="normal"><a href="#__codelineno-35-55">55</a></span>
<span class="normal"><a href="#__codelineno-35-56">56</a></span>
<span class="normal"><a href="#__codelineno-35-57">57</a></span>
<span class="normal"><a href="#__codelineno-35-58">58</a></span>
<span class="normal"><a href="#__codelineno-35-59">59</a></span>
<span class="normal"><a href="#__codelineno-35-60">60</a></span>
<span class="normal"><a href="#__codelineno-35-61">61</a></span>
<span class="normal"><a href="#__codelineno-35-62">62</a></span>
<span class="normal"><a href="#__codelineno-35-63">63</a></span>
<span class="normal"><a href="#__codelineno-35-64">64</a></span>
<span class="normal"><a href="#__codelineno-35-65">65</a></span>
<span class="normal"><a href="#__codelineno-35-66">66</a></span>
<span class="normal"><a href="#__codelineno-35-67">67</a></span>
<span class="normal"><a href="#__codelineno-35-68">68</a></span>
<span class="normal"><a href="#__codelineno-35-69">69</a></span>
<span class="normal"><a href="#__codelineno-35-70">70</a></span>
<span class="normal"><a href="#__codelineno-35-71">71</a></span>
<span class="normal"><a href="#__codelineno-35-72">72</a></span>
<span class="normal"><a href="#__codelineno-35-73">73</a></span>
<span class="normal"><a href="#__codelineno-35-74">74</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="p">{</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="w">    </span><span class="nt">&quot;_meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">        </span><span class="nt">&quot;hostvars&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">            </span><span class="nt">&quot;dcrtr001&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">                </span><span class="nt">&quot;ansible_host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.0.2.10&quot;</span><span class="p">,</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="w">                </span><span class="nt">&quot;custom_fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="w">                    </span><span class="nt">&quot;os_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">                </span><span class="nt">&quot;device_roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="w">                    </span><span class="s2">&quot;network&quot;</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="w">                </span><span class="nt">&quot;device_types&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="w">                    </span><span class="s2">&quot;iosv&quot;</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="w">                </span><span class="nt">&quot;is_virtual&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="w">                </span><span class="nt">&quot;local_context_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="w">                    </span><span class="kc">null</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18"></a><span class="w">                </span><span class="nt">&quot;manufacturers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19"></a><span class="w">                    </span><span class="s2">&quot;cisco&quot;</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21"></a><span class="w">                </span><span class="nt">&quot;platforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22"></a><span class="w">                    </span><span class="s2">&quot;cisco_ios&quot;</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24"></a><span class="w">                </span><span class="nt">&quot;primary_ip4&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.0.2.10&quot;</span><span class="p">,</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25"></a><span class="w">                </span><span class="nt">&quot;regions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26"></a><span class="w">                </span><span class="nt">&quot;services&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27"></a><span class="w">                </span><span class="nt">&quot;sites&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28"></a><span class="w">                    </span><span class="s2">&quot;site01&quot;</span>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30"></a><span class="w">                </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32"></a><span class="w">            </span><span class="nt">&quot;wanrtr002&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33"></a><span class="w">                </span><span class="nt">&quot;ansible_host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10.10.0.2&quot;</span><span class="p">,</span>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34"></a><span class="w">                </span><span class="nt">&quot;custom_fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-35"><a id="__codelineno-35-35" name="__codelineno-35-35"></a><span class="w">                    </span><span class="nt">&quot;os_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-35-36"><a id="__codelineno-35-36" name="__codelineno-35-36"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-35-37"><a id="__codelineno-35-37" name="__codelineno-35-37"></a><span class="w">                </span><span class="nt">&quot;device_roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-38"><a id="__codelineno-35-38" name="__codelineno-35-38"></a><span class="w">                    </span><span class="s2">&quot;network&quot;</span>
</span><span id="__span-35-39"><a id="__codelineno-35-39" name="__codelineno-35-39"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-40"><a id="__codelineno-35-40" name="__codelineno-35-40"></a><span class="w">                </span><span class="nt">&quot;device_types&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-41"><a id="__codelineno-35-41" name="__codelineno-35-41"></a><span class="w">                    </span><span class="s2">&quot;csr1000v&quot;</span>
</span><span id="__span-35-42"><a id="__codelineno-35-42" name="__codelineno-35-42"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-43"><a id="__codelineno-35-43" name="__codelineno-35-43"></a><span class="w">                </span><span class="nt">&quot;is_virtual&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-35-44"><a id="__codelineno-35-44" name="__codelineno-35-44"></a><span class="w">                </span><span class="nt">&quot;local_context_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-45"><a id="__codelineno-35-45" name="__codelineno-35-45"></a><span class="w">                    </span><span class="kc">null</span>
</span><span id="__span-35-46"><a id="__codelineno-35-46" name="__codelineno-35-46"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-47"><a id="__codelineno-35-47" name="__codelineno-35-47"></a><span class="w">                </span><span class="nt">&quot;manufacturers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-48"><a id="__codelineno-35-48" name="__codelineno-35-48"></a><span class="w">                    </span><span class="s2">&quot;cisco&quot;</span>
</span><span id="__span-35-49"><a id="__codelineno-35-49" name="__codelineno-35-49"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-50"><a id="__codelineno-35-50" name="__codelineno-35-50"></a><span class="w">                </span><span class="nt">&quot;platforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-51"><a id="__codelineno-35-51" name="__codelineno-35-51"></a><span class="w">                    </span><span class="s2">&quot;cisco_ios&quot;</span>
</span><span id="__span-35-52"><a id="__codelineno-35-52" name="__codelineno-35-52"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-53"><a id="__codelineno-35-53" name="__codelineno-35-53"></a><span class="w">                </span><span class="nt">&quot;primary_ip4&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10.10.0.2&quot;</span><span class="p">,</span>
</span><span id="__span-35-54"><a id="__codelineno-35-54" name="__codelineno-35-54"></a><span class="w">                </span><span class="nt">&quot;regions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-35-55"><a id="__codelineno-35-55" name="__codelineno-35-55"></a><span class="w">                </span><span class="nt">&quot;services&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-35-56"><a id="__codelineno-35-56" name="__codelineno-35-56"></a><span class="w">                </span><span class="nt">&quot;sites&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-57"><a id="__codelineno-35-57" name="__codelineno-35-57"></a><span class="w">                    </span><span class="s2">&quot;site01&quot;</span>
</span><span id="__span-35-58"><a id="__codelineno-35-58" name="__codelineno-35-58"></a><span class="w">                </span><span class="p">],</span>
</span><span id="__span-35-59"><a id="__codelineno-35-59" name="__codelineno-35-59"></a><span class="w">                </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-35-60"><a id="__codelineno-35-60" name="__codelineno-35-60"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-35-61"><a id="__codelineno-35-61" name="__codelineno-35-61"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-35-62"><a id="__codelineno-35-62" name="__codelineno-35-62"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-35-63"><a id="__codelineno-35-63" name="__codelineno-35-63"></a><span class="w">    </span><span class="nt">&quot;all&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-64"><a id="__codelineno-35-64" name="__codelineno-35-64"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-65"><a id="__codelineno-35-65" name="__codelineno-35-65"></a><span class="w">            </span><span class="s2">&quot;ungrouped&quot;</span>
</span><span id="__span-35-66"><a id="__codelineno-35-66" name="__codelineno-35-66"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-35-67"><a id="__codelineno-35-67" name="__codelineno-35-67"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-35-68"><a id="__codelineno-35-68" name="__codelineno-35-68"></a><span class="w">    </span><span class="nt">&quot;ungrouped&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-69"><a id="__codelineno-35-69" name="__codelineno-35-69"></a><span class="w">        </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-70"><a id="__codelineno-35-70" name="__codelineno-35-70"></a><span class="w">            </span><span class="s2">&quot;dcrtr001&quot;</span><span class="p">,</span>
</span><span id="__span-35-71"><a id="__codelineno-35-71" name="__codelineno-35-71"></a><span class="w">            </span><span class="s2">&quot;wanrtr002&quot;</span>
</span><span id="__span-35-72"><a id="__codelineno-35-72" name="__codelineno-35-72"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-35-73"><a id="__codelineno-35-73" name="__codelineno-35-73"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-35-74"><a id="__codelineno-35-74" name="__codelineno-35-74"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>In this output, you get several components made available. First take notice on lines 62-74 at the bottom. This gives the groupings that will be made available. Since this is the basic query with no groupings defined, there is a single group of <em>ungrouped</em>. This is a child of the <em>all</em> group. Which allows only hosts defined as all or the specific hostname.  </p>
<p>Taking a look at the hostvars that get assigned (lines 1-62), you get several host variables defined from the API call. Including the primary_ip4 address, device_role, an Ansible Host from the primary_ip4 address, and also the custom fields that are part of the NetBox environment.</p>
<h3 id="groupings"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/#groupings">Groupings</a></h3>
<p>Next up is adding some more context and adding groupings. This is done within your inventory YAML file with the key of <em>group_by</em>. There are several choices of what you can group objects by, including sites, tenants, tags, platforms, and many more. Take a look at the <a href="https://netbox-ansible-collection.readthedocs.io/en/latest/plugins/inventory/nb_inventory/netbox.netbox.nb_inventory_inventory.html">documentation reference</a> for all of the options. Taking a look at having a grouping of by device_role, tags, sites, and platform gives the following additional groups: </p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># netbox_inventory_group_by.yml</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="nn">---</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">netbox.netbox.nb_inventory</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="nt">config_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="nt">group_by</span><span class="p">:</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">device_roles</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">platforms</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sites</span>
</span></code></pre></div>
<p>This now yields the following:</p>
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span>
<span class="normal"><a href="#__codelineno-37-23">23</a></span>
<span class="normal"><a href="#__codelineno-37-24">24</a></span>
<span class="normal"><a href="#__codelineno-37-25">25</a></span>
<span class="normal"><a href="#__codelineno-37-26">26</a></span>
<span class="normal"><a href="#__codelineno-37-27">27</a></span>
<span class="normal"><a href="#__codelineno-37-28">28</a></span>
<span class="normal"><a href="#__codelineno-37-29">29</a></span>
<span class="normal"><a href="#__codelineno-37-30">30</a></span>
<span class="normal"><a href="#__codelineno-37-31">31</a></span>
<span class="normal"><a href="#__codelineno-37-32">32</a></span>
<span class="normal"><a href="#__codelineno-37-33">33</a></span>
<span class="normal"><a href="#__codelineno-37-34">34</a></span>
<span class="normal"><a href="#__codelineno-37-35">35</a></span>
<span class="normal"><a href="#__codelineno-37-36">36</a></span>
<span class="normal"><a href="#__codelineno-37-37">37</a></span>
<span class="normal"><a href="#__codelineno-37-38">38</a></span>
<span class="normal"><a href="#__codelineno-37-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="p">{</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="w">    </span><span class="nt">&quot;all&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="w">            </span><span class="s2">&quot;device_roles_network&quot;</span><span class="p">,</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w">            </span><span class="s2">&quot;platforms_cisco_ios&quot;</span><span class="p">,</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w">            </span><span class="s2">&quot;sites_datacenter01&quot;</span><span class="p">,</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">            </span><span class="s2">&quot;sites_site01&quot;</span><span class="p">,</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">            </span><span class="s2">&quot;tags_virtual&quot;</span><span class="p">,</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="w">            </span><span class="s2">&quot;ungrouped&quot;</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="w">    </span><span class="nt">&quot;device_roles_network&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="w">        </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">            </span><span class="s2">&quot;dcrtr001&quot;</span><span class="p">,</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w">            </span><span class="s2">&quot;wanrtr002&quot;</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="w">    </span><span class="nt">&quot;platforms_cisco_ios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="w">        </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="w">            </span><span class="s2">&quot;dcrtr001&quot;</span><span class="p">,</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="w">            </span><span class="s2">&quot;wanrtr002&quot;</span>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24"></a><span class="w">    </span><span class="nt">&quot;sites_datacenter01&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-25"><a id="__codelineno-37-25" name="__codelineno-37-25"></a><span class="w">        </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-26"><a id="__codelineno-37-26" name="__codelineno-37-26"></a><span class="w">            </span><span class="s2">&quot;dcrtr001&quot;</span>
</span><span id="__span-37-27"><a id="__codelineno-37-27" name="__codelineno-37-27"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-37-28"><a id="__codelineno-37-28" name="__codelineno-37-28"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-37-29"><a id="__codelineno-37-29" name="__codelineno-37-29"></a><span class="w">    </span><span class="nt">&quot;sites_site01&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-30"><a id="__codelineno-37-30" name="__codelineno-37-30"></a><span class="w">        </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-31"><a id="__codelineno-37-31" name="__codelineno-37-31"></a><span class="w">            </span><span class="s2">&quot;wanrtr002&quot;</span>
</span><span id="__span-37-32"><a id="__codelineno-37-32" name="__codelineno-37-32"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-37-33"><a id="__codelineno-37-33" name="__codelineno-37-33"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-37-34"><a id="__codelineno-37-34" name="__codelineno-37-34"></a><span class="w">    </span><span class="nt">&quot;tags_virtual&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-35"><a id="__codelineno-37-35" name="__codelineno-37-35"></a><span class="w">        </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-36"><a id="__codelineno-37-36" name="__codelineno-37-36"></a><span class="w">            </span><span class="s2">&quot;dcrtr001&quot;</span>
</span><span id="__span-37-37"><a id="__codelineno-37-37" name="__codelineno-37-37"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-37-38"><a id="__codelineno-37-38" name="__codelineno-37-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-39"><a id="__codelineno-37-39" name="__codelineno-37-39"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>This filtered out the hostvars as these are not changing.</p>
</blockquote>
<p>There are now 5 additional groups showing up in the <em>all</em> group. And each of these have different hosts available for you to use in your playbooks. Now these are making sense and you can now have groupings for each of the items.</p>
<h3 id="filtering-devices-from-netbox"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/#filtering-devices-from-netbox">Filtering Devices from NetBox</a></h3>
<p>Next up is how do you filter hosts from the NetBox environment? That is done with <em>query_filters</em> key. From the documentation page: </p>
<blockquote>
<p>List of parameters passed to the query string for both devices and VMs (Multiple values may be separated by commas)</p>
</blockquote>
<p>In the testing I was not able to get multiple values on a status. This may need some clarification from the project.  </p>
<p>First search that was changed is that I moved <code>wanrtr002</code> to an offline state. Now when running the following inventory with a query filter status of active, the host is no longer in the grouping:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># netbox_inventory_filtered.yml</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="nn">---</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">netbox.netbox.nb_inventory</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="nt">config_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="nt">group_by</span><span class="p">:</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">device_roles</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">platforms</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sites</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="nt">query_filters</span><span class="p">:</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;active&quot;</span>
</span></code></pre></div>
<p>Looking at just the platforms_cisco_ios grouping, there is now a single device.</p>
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span>
<span class="normal"><a href="#__codelineno-39-3">3</a></span>
<span class="normal"><a href="#__codelineno-39-4">4</a></span>
<span class="normal"><a href="#__codelineno-39-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="w">    </span><span class="nt">&quot;platforms_cisco_ios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="w">        </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">            </span><span class="s2">&quot;dcrtr001&quot;</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="w">    </span><span class="p">},</span>
</span></code></pre></div></td></tr></table></div>
<p>You can add additional queries to the query_filters key, such that status is listed twice. Once we add the second status then both devices show up again:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nt">query_filters</span><span class="p">:</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;active&quot;</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;offline&quot;</span>
</span></code></pre></div>
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span>
<span class="normal"><a href="#__codelineno-41-3">3</a></span>
<span class="normal"><a href="#__codelineno-41-4">4</a></span>
<span class="normal"><a href="#__codelineno-41-5">5</a></span>
<span class="normal"><a href="#__codelineno-41-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="w">    </span><span class="nt">&quot;platforms_cisco_ios&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="w">        </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="w">            </span><span class="s2">&quot;dcrtr001&quot;</span><span class="p">,</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">            </span><span class="s2">&quot;wanrtr002&quot;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="w">    </span><span class="p">},</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="adding-variables"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/#adding-variables">Adding Variables</a></h3>
<p>The method to add custom hostvars to your inventory from NetBox, is done with the <em>compose</em> parameter. From the documentation site:</p>
<blockquote>
<p>List of custom ansible host vars to create from the device object fetched from NetBox</p>
</blockquote>
<p>THe first item that I use often with the compose parameter of the plugin is to set the <code>ansible_network_os</code> for a device. This is very helpful with a multi-vendor environment that allows you to run tasks against different network OS's. The final demonstration inventory YAML file is this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># netbox_inventory_all.yml</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="nn">---</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">netbox.netbox.nb_inventory</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="nt">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="nt">config_context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="nt">group_by</span><span class="p">:</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">device_roles</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">platforms</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sites</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="nt">query_filters</span><span class="p">:</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;active&quot;</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;offline&quot;</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="nt">compose</span><span class="p">:</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="w">  </span><span class="nt">ansible_network_os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">platform.slug</span>
</span></code></pre></div>
<p>With this modification the output shows the following hostvars with the groups unchanged. Notice specifically line 3 that there is now the <em>ansible_network_os</em> is set to <em>ios</em>, which will match the Ansible Network OS that Ansible will use. I just make sure that the slug for the Platform name matches that of the primary automation system.</p>
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span>
<span class="normal"><a href="#__codelineno-43-17">17</a></span>
<span class="normal"><a href="#__codelineno-43-18">18</a></span>
<span class="normal"><a href="#__codelineno-43-19">19</a></span>
<span class="normal"><a href="#__codelineno-43-20">20</a></span>
<span class="normal"><a href="#__codelineno-43-21">21</a></span>
<span class="normal"><a href="#__codelineno-43-22">22</a></span>
<span class="normal"><a href="#__codelineno-43-23">23</a></span>
<span class="normal"><a href="#__codelineno-43-24">24</a></span>
<span class="normal"><a href="#__codelineno-43-25">25</a></span>
<span class="normal"><a href="#__codelineno-43-26">26</a></span>
<span class="normal"><a href="#__codelineno-43-27">27</a></span>
<span class="normal"><a href="#__codelineno-43-28">28</a></span>
<span class="normal"><a href="#__codelineno-43-29">29</a></span>
<span class="normal"><a href="#__codelineno-43-30">30</a></span>
<span class="normal"><a href="#__codelineno-43-31">31</a></span>
<span class="normal"><a href="#__codelineno-43-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="nt">&quot;dcrtr001&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="w">    </span><span class="nt">&quot;ansible_host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.0.2.10&quot;</span><span class="p">,</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="w">    </span><span class="nt">&quot;ansible_network_os&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ios&quot;</span><span class="p">,</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="w">    </span><span class="nt">&quot;custom_fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="w">        </span><span class="nt">&quot;os_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="w">    </span><span class="nt">&quot;device_roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="w">        </span><span class="s2">&quot;network&quot;</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="w">    </span><span class="nt">&quot;device_types&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="w">        </span><span class="s2">&quot;iosv&quot;</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13"></a><span class="w">    </span><span class="nt">&quot;is_virtual&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="w">    </span><span class="nt">&quot;local_context_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15"></a><span class="w">        </span><span class="kc">null</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17"></a><span class="w">    </span><span class="nt">&quot;manufacturers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18"></a><span class="w">        </span><span class="s2">&quot;cisco&quot;</span>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20"></a><span class="w">    </span><span class="nt">&quot;platforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21"></a><span class="w">        </span><span class="s2">&quot;cisco_ios&quot;</span>
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23"></a><span class="w">    </span><span class="nt">&quot;primary_ip4&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.0.2.10&quot;</span><span class="p">,</span>
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24"></a><span class="w">    </span><span class="nt">&quot;regions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25"></a><span class="w">    </span><span class="nt">&quot;services&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26"></a><span class="w">    </span><span class="nt">&quot;sites&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-27"><a id="__codelineno-43-27" name="__codelineno-43-27"></a><span class="w">        </span><span class="s2">&quot;datacenter01&quot;</span>
</span><span id="__span-43-28"><a id="__codelineno-43-28" name="__codelineno-43-28"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-43-29"><a id="__codelineno-43-29" name="__codelineno-43-29"></a><span class="w">    </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-30"><a id="__codelineno-43-30" name="__codelineno-43-30"></a><span class="w">        </span><span class="s2">&quot;virtual&quot;</span>
</span><span id="__span-43-31"><a id="__codelineno-43-31" name="__codelineno-43-31"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-43-32"><a id="__codelineno-43-32" name="__codelineno-43-32"></a><span class="p">},</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="summary"><a class="toclink" href="../../../../netbox-ansible-inventory_plugin/#summary">Summary</a></h3>
<p>The NetBox Inventory Plugin for Ansible is quite powerful. It provides for methods to group your devices, filter on data points maintained within NetBox, and to create additional hostvars. The parameters for the plugin are quite extensive and you should take a look at what makes sense for your environment or needs within the Ansible playbooks. There are a few defaults that are set to no, such as <em>interfaces</em>, that helps keep the data provided at a proper level. You can add more information to the hostvars that you may use in the playbooks.  </p>
<p>I think the plugin is awesome and has a lot of work that has gone into it. There is likely even more to come as you go.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/22228848" alt="Josh VanDeraa">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-11-28 00:00:00">November 28, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../netbox/" class="md-meta__link">netbox</a>, 
              <a href="../../" class="md-meta__link">ansible</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="netbox-ansible-collection-installation"><a class="toclink" href="../../../../collection_install/">NetBox Ansible Collection: Installation</a></h2>
<p>This is the first post as I start to look at the NetBox Ansible Collection. This is an impressive collection with modules for several of the NetBox applications, a query plugin, and an inventory plugin. This will take a deeper dive into several of the components of the <strong>inventory plugin</strong>, but not all of the options. The documentation for all of the collection can be found at:</p>
<ul>
<li>ReadTheDocs: <a href="https://netbox-ansible-collection.readthedocs.io/en/latest/">https://netbox-ansible-collection.readthedocs.io/en/latest/</a></li>
<li>Galaxy Page: <a href="https://galaxy.ansible.com/netbox/netbox">https://galaxy.ansible.com/netbox/netbox</a>  </li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This post was created when NetBox was an open source project used often in my automation framework. I have moved on to using <a href="https://www.nautobot.com">Nautobot</a> due to the project vision and providing a methodology that will drive network automation forward further. You may want to take a look at it yourself.</p>
</div>
<p>This post is going to give information on how to install the collection as it may be applicable to every post in the series (as they get posted).</p>
<p>(Update 2020-12-05)
The corresponding YouTube video is here:</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0;">
  <iframe src="https://www.youtube.com/embed/KjGwNRoBYU0" 
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" 
          frameborder="0" 
          allowfullscreen>
  </iframe>
</div>

<h3 id="installation"><a class="toclink" href="../../../../collection_install/#installation">Installation</a></h3>
<p>Installation is done via Ansible Galaxy. It is recommended to have the latest version of the collection when working on it as there are updates happening routinely. There is a <strong>Python requirement</strong> with the modules of the <a href="https://github.com/digitalocean/pynetbox">pynetbox</a> package.  </p>
<p>It does not matter which order you install these in, you just need to install both before you start using the module.</p>
<h4 id="installation-pynetbox"><a class="toclink" href="../../../../collection_install/#installation-pynetbox">Installation - pynetbox</a></h4>
<p>To install you execute the following to get the latest version of pynetbox:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pynetbox<span class="w"> </span>--upgrade
</span></code></pre></div>
<h4 id="installation-netbox-collection"><a class="toclink" href="../../../../collection_install/#installation-netbox-collection">Installation - NetBox Collection</a></h4>
<p>The collection is installed via Ansible Galaxy as a primary method to install. You can also install the collection manually from GitHub, but the galaxy method is the preferred method.</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>netbox.netbox<span class="w"> </span>--force
</span></code></pre></div>
<p>The addition of <code>--force</code> will have Ansible Galaxy install the latest version on top of what you may already have. If you already have a version of the collection installed, Galaxy will not overwrite what you already have.</p>
<h3 id="verification-of-installation"><a class="toclink" href="../../../../collection_install/#verification-of-installation">Verification of Installation</a></h3>
<p>Once you have run the steps there are many ways to verify that the installation is completed successfully for the Python package. The one that I like to use is to execute a <code>pip freeze | grep &lt;package_name&gt;</code>. The execution looks like this on the current date:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>pip3<span class="w"> </span>freeze<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pynetbox<span class="w">    </span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nv">pynetbox</span><span class="o">==</span><span class="m">5</span>.1.0
</span></code></pre></div>
<p>To verify that you have installed the NetBox Ansible Collection, you can execute the Ansible Doc command to get the current documentation. This is done as followed with the netbox_device module to verify that the docs load:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>ansible-doc<span class="w"> </span>netbox.netbox.netbox_device
</span></code></pre></div>
<p>If the module is not installed properly you will see, with a key in on the first line</p>
<p><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="o">[</span>WARNING<span class="o">]</span>:<span class="w"> </span>module<span class="w"> </span>netbox.netbox.netbox_inventory<span class="w"> </span>not<span class="w"> </span>found<span class="w"> </span><span class="k">in</span>:
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a>~/.local/lib/python3.7/site-packages/ansible/modules
</span></code></pre></div></td></tr></table></div>
The output when I sent the stdout to a file is:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>&gt; NETBOX.NETBOX.NETBOX_DEVICE    (/Users/joshvanderaa/.ansible/collections/ansible_collections/netbox/netbox/plugins/modules/netbox_device.py)
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>        Creates, updates or removes devices from Netbox
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>OPTIONS (= is mandatory):
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>= data
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>        Defines the device configuration
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>        type: dict
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>        SUBOPTIONS:
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        - asset_tag
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>            Asset tag that is associated to the device
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>            [Default: (null)]
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>            type: str
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>        - cluster
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>            Cluster that the device will be assigned to
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>            [Default: (null)]
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>            type: raw
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>        - comments
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>            Comments that may include additional information in
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>            regards to the device
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>            [Default: (null)]
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>            type: str
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>        - custom_fields
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>            must exist in Netbox
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>            [Default: (null)]
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>            type: dict
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a>        - device_role
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>            Required if `state=present&#39; and the device does not exist
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>            yet
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>            [Default: (null)]
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a>            type: raw
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>
</span><span id="__span-17-41"><a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a>        - device_type
</span><span id="__span-17-42"><a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a>            Required if `state=present&#39; and the device does not exist
</span><span id="__span-17-43"><a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a>            yet
</span><span id="__span-17-44"><a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>            [Default: (null)]
</span><span id="__span-17-45"><a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a>            type: raw
</span><span id="__span-17-46"><a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a>
</span><span id="__span-17-47"><a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a>        - face
</span><span id="__span-17-48"><a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a>            Required if `rack&#39; is defined
</span><span id="__span-17-49"><a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a>            (Choices: Front, front, Rear, rear)[Default: (null)]
</span><span id="__span-17-50"><a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a>            type: str
</span><span id="__span-17-51"><a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a>
</span><span id="__span-17-52"><a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a>        - local_context_data
</span><span id="__span-17-53"><a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a>            Arbitrary JSON data to define the devices configuration
</span><span id="__span-17-54"><a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a>            variables.
</span><span id="__span-17-55"><a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a>            [Default: (null)]
</span><span id="__span-17-56"><a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a>            type: dict
</span><span id="__span-17-57"><a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a>
</span><span id="__span-17-58"><a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a>        = name
</span><span id="__span-17-59"><a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a>            The name of the device
</span><span id="__span-17-60"><a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a>
</span><span id="__span-17-61"><a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a>            type: str
</span><span id="__span-17-62"><a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a>
</span><span id="__span-17-63"><a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a>        - platform
</span><span id="__span-17-64"><a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a>            The platform of the device
</span><span id="__span-17-65"><a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a>            [Default: (null)]
</span><span id="__span-17-66"><a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a>            type: raw
</span><span id="__span-17-67"><a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a>
</span><span id="__span-17-68"><a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a>        - position
</span><span id="__span-17-69"><a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a>            The position of the device in the rack defined above
</span><span id="__span-17-70"><a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a>            [Default: (null)]
</span><span id="__span-17-71"><a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a>            type: int
</span><span id="__span-17-72"><a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a>
</span><span id="__span-17-73"><a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a>        - primary_ip4
</span><span id="__span-17-74"><a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a>            Primary IPv4 address assigned to the device
</span><span id="__span-17-75"><a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a>            [Default: (null)]
</span><span id="__span-17-76"><a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a>            type: raw
</span><span id="__span-17-77"><a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a>
</span><span id="__span-17-78"><a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a>        - primary_ip6
</span><span id="__span-17-79"><a id="__codelineno-17-79" name="__codelineno-17-79" href="#__codelineno-17-79"></a>            Primary IPv6 address assigned to the device
</span><span id="__span-17-80"><a id="__codelineno-17-80" name="__codelineno-17-80" href="#__codelineno-17-80"></a>            [Default: (null)]
</span><span id="__span-17-81"><a id="__codelineno-17-81" name="__codelineno-17-81" href="#__codelineno-17-81"></a>            type: raw
</span><span id="__span-17-82"><a id="__codelineno-17-82" name="__codelineno-17-82" href="#__codelineno-17-82"></a>
</span><span id="__span-17-83"><a id="__codelineno-17-83" name="__codelineno-17-83" href="#__codelineno-17-83"></a>        - rack
</span><span id="__span-17-84"><a id="__codelineno-17-84" name="__codelineno-17-84" href="#__codelineno-17-84"></a>            The name of the rack to assign the device to
</span><span id="__span-17-85"><a id="__codelineno-17-85" name="__codelineno-17-85" href="#__codelineno-17-85"></a>            [Default: (null)]
</span><span id="__span-17-86"><a id="__codelineno-17-86" name="__codelineno-17-86" href="#__codelineno-17-86"></a>            type: raw
</span><span id="__span-17-87"><a id="__codelineno-17-87" name="__codelineno-17-87" href="#__codelineno-17-87"></a>
</span><span id="__span-17-88"><a id="__codelineno-17-88" name="__codelineno-17-88" href="#__codelineno-17-88"></a>        - serial
</span><span id="__span-17-89"><a id="__codelineno-17-89" name="__codelineno-17-89" href="#__codelineno-17-89"></a>            Serial number of the device
</span><span id="__span-17-90"><a id="__codelineno-17-90" name="__codelineno-17-90" href="#__codelineno-17-90"></a>            [Default: (null)]
</span><span id="__span-17-91"><a id="__codelineno-17-91" name="__codelineno-17-91" href="#__codelineno-17-91"></a>            type: str
</span><span id="__span-17-92"><a id="__codelineno-17-92" name="__codelineno-17-92" href="#__codelineno-17-92"></a>
</span><span id="__span-17-93"><a id="__codelineno-17-93" name="__codelineno-17-93" href="#__codelineno-17-93"></a>        - site
</span><span id="__span-17-94"><a id="__codelineno-17-94" name="__codelineno-17-94" href="#__codelineno-17-94"></a>            Required if `state=present&#39; and the device does not exist
</span><span id="__span-17-95"><a id="__codelineno-17-95" name="__codelineno-17-95" href="#__codelineno-17-95"></a>            yet
</span><span id="__span-17-96"><a id="__codelineno-17-96" name="__codelineno-17-96" href="#__codelineno-17-96"></a>            [Default: (null)]
</span><span id="__span-17-97"><a id="__codelineno-17-97" name="__codelineno-17-97" href="#__codelineno-17-97"></a>            type: raw
</span><span id="__span-17-98"><a id="__codelineno-17-98" name="__codelineno-17-98" href="#__codelineno-17-98"></a>
</span><span id="__span-17-99"><a id="__codelineno-17-99" name="__codelineno-17-99" href="#__codelineno-17-99"></a>        - status
</span><span id="__span-17-100"><a id="__codelineno-17-100" name="__codelineno-17-100" href="#__codelineno-17-100"></a>            The status of the device
</span><span id="__span-17-101"><a id="__codelineno-17-101" name="__codelineno-17-101" href="#__codelineno-17-101"></a>            [Default: (null)]
</span><span id="__span-17-102"><a id="__codelineno-17-102" name="__codelineno-17-102" href="#__codelineno-17-102"></a>            type: raw
</span><span id="__span-17-103"><a id="__codelineno-17-103" name="__codelineno-17-103" href="#__codelineno-17-103"></a>
</span><span id="__span-17-104"><a id="__codelineno-17-104" name="__codelineno-17-104" href="#__codelineno-17-104"></a>        - tags
</span><span id="__span-17-105"><a id="__codelineno-17-105" name="__codelineno-17-105" href="#__codelineno-17-105"></a>            Any tags that the device may need to be associated with
</span><span id="__span-17-106"><a id="__codelineno-17-106" name="__codelineno-17-106" href="#__codelineno-17-106"></a>            [Default: (null)]
</span><span id="__span-17-107"><a id="__codelineno-17-107" name="__codelineno-17-107" href="#__codelineno-17-107"></a>            type: list
</span><span id="__span-17-108"><a id="__codelineno-17-108" name="__codelineno-17-108" href="#__codelineno-17-108"></a>
</span><span id="__span-17-109"><a id="__codelineno-17-109" name="__codelineno-17-109" href="#__codelineno-17-109"></a>        - tenant
</span><span id="__span-17-110"><a id="__codelineno-17-110" name="__codelineno-17-110" href="#__codelineno-17-110"></a>            The tenant that the device will be assigned to
</span><span id="__span-17-111"><a id="__codelineno-17-111" name="__codelineno-17-111" href="#__codelineno-17-111"></a>            [Default: (null)]
</span><span id="__span-17-112"><a id="__codelineno-17-112" name="__codelineno-17-112" href="#__codelineno-17-112"></a>            type: raw
</span><span id="__span-17-113"><a id="__codelineno-17-113" name="__codelineno-17-113" href="#__codelineno-17-113"></a>
</span><span id="__span-17-114"><a id="__codelineno-17-114" name="__codelineno-17-114" href="#__codelineno-17-114"></a>        - vc_position
</span><span id="__span-17-115"><a id="__codelineno-17-115" name="__codelineno-17-115" href="#__codelineno-17-115"></a>            Position in the assigned virtual chassis
</span><span id="__span-17-116"><a id="__codelineno-17-116" name="__codelineno-17-116" href="#__codelineno-17-116"></a>            [Default: (null)]
</span><span id="__span-17-117"><a id="__codelineno-17-117" name="__codelineno-17-117" href="#__codelineno-17-117"></a>            type: int
</span><span id="__span-17-118"><a id="__codelineno-17-118" name="__codelineno-17-118" href="#__codelineno-17-118"></a>
</span><span id="__span-17-119"><a id="__codelineno-17-119" name="__codelineno-17-119" href="#__codelineno-17-119"></a>        - vc_priority
</span><span id="__span-17-120"><a id="__codelineno-17-120" name="__codelineno-17-120" href="#__codelineno-17-120"></a>            Priority in the assigned virtual chassis
</span><span id="__span-17-121"><a id="__codelineno-17-121" name="__codelineno-17-121" href="#__codelineno-17-121"></a>            [Default: (null)]
</span><span id="__span-17-122"><a id="__codelineno-17-122" name="__codelineno-17-122" href="#__codelineno-17-122"></a>            type: int
</span><span id="__span-17-123"><a id="__codelineno-17-123" name="__codelineno-17-123" href="#__codelineno-17-123"></a>
</span><span id="__span-17-124"><a id="__codelineno-17-124" name="__codelineno-17-124" href="#__codelineno-17-124"></a>        - virtual_chassis
</span><span id="__span-17-125"><a id="__codelineno-17-125" name="__codelineno-17-125" href="#__codelineno-17-125"></a>            Virtual chassis the device will be assigned to
</span><span id="__span-17-126"><a id="__codelineno-17-126" name="__codelineno-17-126" href="#__codelineno-17-126"></a>            [Default: (null)]
</span><span id="__span-17-127"><a id="__codelineno-17-127" name="__codelineno-17-127" href="#__codelineno-17-127"></a>            type: raw
</span><span id="__span-17-128"><a id="__codelineno-17-128" name="__codelineno-17-128" href="#__codelineno-17-128"></a>
</span><span id="__span-17-129"><a id="__codelineno-17-129" name="__codelineno-17-129" href="#__codelineno-17-129"></a>= netbox_token
</span><span id="__span-17-130"><a id="__codelineno-17-130" name="__codelineno-17-130" href="#__codelineno-17-130"></a>        The token created within Netbox to authorize API access
</span><span id="__span-17-131"><a id="__codelineno-17-131" name="__codelineno-17-131" href="#__codelineno-17-131"></a>
</span><span id="__span-17-132"><a id="__codelineno-17-132" name="__codelineno-17-132" href="#__codelineno-17-132"></a>        type: str
</span><span id="__span-17-133"><a id="__codelineno-17-133" name="__codelineno-17-133" href="#__codelineno-17-133"></a>
</span><span id="__span-17-134"><a id="__codelineno-17-134" name="__codelineno-17-134" href="#__codelineno-17-134"></a>= netbox_url
</span><span id="__span-17-135"><a id="__codelineno-17-135" name="__codelineno-17-135" href="#__codelineno-17-135"></a>        URL of the Netbox instance resolvable by Ansible control host
</span><span id="__span-17-136"><a id="__codelineno-17-136" name="__codelineno-17-136" href="#__codelineno-17-136"></a>
</span><span id="__span-17-137"><a id="__codelineno-17-137" name="__codelineno-17-137" href="#__codelineno-17-137"></a>        type: str
</span><span id="__span-17-138"><a id="__codelineno-17-138" name="__codelineno-17-138" href="#__codelineno-17-138"></a>
</span><span id="__span-17-139"><a id="__codelineno-17-139" name="__codelineno-17-139" href="#__codelineno-17-139"></a>- query_params
</span><span id="__span-17-140"><a id="__codelineno-17-140" name="__codelineno-17-140" href="#__codelineno-17-140"></a>        This can be used to override the specified values in
</span><span id="__span-17-141"><a id="__codelineno-17-141" name="__codelineno-17-141" href="#__codelineno-17-141"></a>        ALLOWED_QUERY_PARAMS that is defined
</span><span id="__span-17-142"><a id="__codelineno-17-142" name="__codelineno-17-142" href="#__codelineno-17-142"></a>        in plugins/module_utils/netbox_utils.py and provides control
</span><span id="__span-17-143"><a id="__codelineno-17-143" name="__codelineno-17-143" href="#__codelineno-17-143"></a>        to users on what may make
</span><span id="__span-17-144"><a id="__codelineno-17-144" name="__codelineno-17-144" href="#__codelineno-17-144"></a>        an object unique in their environment.
</span><span id="__span-17-145"><a id="__codelineno-17-145" name="__codelineno-17-145" href="#__codelineno-17-145"></a>        [Default: (null)]
</span><span id="__span-17-146"><a id="__codelineno-17-146" name="__codelineno-17-146" href="#__codelineno-17-146"></a>        elements: str
</span><span id="__span-17-147"><a id="__codelineno-17-147" name="__codelineno-17-147" href="#__codelineno-17-147"></a>        type: list
</span><span id="__span-17-148"><a id="__codelineno-17-148" name="__codelineno-17-148" href="#__codelineno-17-148"></a>
</span><span id="__span-17-149"><a id="__codelineno-17-149" name="__codelineno-17-149" href="#__codelineno-17-149"></a>- state
</span><span id="__span-17-150"><a id="__codelineno-17-150" name="__codelineno-17-150" href="#__codelineno-17-150"></a>        Use `present&#39; or `absent&#39; for adding or removing.
</span><span id="__span-17-151"><a id="__codelineno-17-151" name="__codelineno-17-151" href="#__codelineno-17-151"></a>        (Choices: absent, present)[Default: present]
</span><span id="__span-17-152"><a id="__codelineno-17-152" name="__codelineno-17-152" href="#__codelineno-17-152"></a>        type: str
</span><span id="__span-17-153"><a id="__codelineno-17-153" name="__codelineno-17-153" href="#__codelineno-17-153"></a>
</span><span id="__span-17-154"><a id="__codelineno-17-154" name="__codelineno-17-154" href="#__codelineno-17-154"></a>- validate_certs
</span><span id="__span-17-155"><a id="__codelineno-17-155" name="__codelineno-17-155" href="#__codelineno-17-155"></a>        If `no&#39;, SSL certificates will not be validated. This should
</span><span id="__span-17-156"><a id="__codelineno-17-156" name="__codelineno-17-156" href="#__codelineno-17-156"></a>        only be used on personally controlled sites using self-signed
</span><span id="__span-17-157"><a id="__codelineno-17-157" name="__codelineno-17-157" href="#__codelineno-17-157"></a>        certificates.
</span><span id="__span-17-158"><a id="__codelineno-17-158" name="__codelineno-17-158" href="#__codelineno-17-158"></a>        [Default: True]
</span><span id="__span-17-159"><a id="__codelineno-17-159" name="__codelineno-17-159" href="#__codelineno-17-159"></a>        type: raw
</span><span id="__span-17-160"><a id="__codelineno-17-160" name="__codelineno-17-160" href="#__codelineno-17-160"></a>
</span><span id="__span-17-161"><a id="__codelineno-17-161" name="__codelineno-17-161" href="#__codelineno-17-161"></a>
</span><span id="__span-17-162"><a id="__codelineno-17-162" name="__codelineno-17-162" href="#__codelineno-17-162"></a>NOTES:
</span><span id="__span-17-163"><a id="__codelineno-17-163" name="__codelineno-17-163" href="#__codelineno-17-163"></a>      * Tags should be defined as a YAML list
</span><span id="__span-17-164"><a id="__codelineno-17-164" name="__codelineno-17-164" href="#__codelineno-17-164"></a>      * This should be ran with connection `local&#39; and hosts
</span><span id="__span-17-165"><a id="__codelineno-17-165" name="__codelineno-17-165" href="#__codelineno-17-165"></a>        `localhost&#39;
</span><span id="__span-17-166"><a id="__codelineno-17-166" name="__codelineno-17-166" href="#__codelineno-17-166"></a>
</span><span id="__span-17-167"><a id="__codelineno-17-167" name="__codelineno-17-167" href="#__codelineno-17-167"></a>
</span><span id="__span-17-168"><a id="__codelineno-17-168" name="__codelineno-17-168" href="#__codelineno-17-168"></a>REQUIREMENTS:  pynetbox
</span><span id="__span-17-169"><a id="__codelineno-17-169" name="__codelineno-17-169" href="#__codelineno-17-169"></a>
</span><span id="__span-17-170"><a id="__codelineno-17-170" name="__codelineno-17-170" href="#__codelineno-17-170"></a>AUTHOR: Mikhail Yohman (@FragmentedPacket), David Gomez (@amb1s1)
</span><span id="__span-17-171"><a id="__codelineno-17-171" name="__codelineno-17-171" href="#__codelineno-17-171"></a>
</span><span id="__span-17-172"><a id="__codelineno-17-172" name="__codelineno-17-172" href="#__codelineno-17-172"></a>METADATA:
</span><span id="__span-17-173"><a id="__codelineno-17-173" name="__codelineno-17-173" href="#__codelineno-17-173"></a>  metadata_version: &#39;1.1&#39;
</span><span id="__span-17-174"><a id="__codelineno-17-174" name="__codelineno-17-174" href="#__codelineno-17-174"></a>  status:
</span><span id="__span-17-175"><a id="__codelineno-17-175" name="__codelineno-17-175" href="#__codelineno-17-175"></a>  - preview
</span><span id="__span-17-176"><a id="__codelineno-17-176" name="__codelineno-17-176" href="#__codelineno-17-176"></a>  supported_by: community
</span><span id="__span-17-177"><a id="__codelineno-17-177" name="__codelineno-17-177" href="#__codelineno-17-177"></a>
</span><span id="__span-17-178"><a id="__codelineno-17-178" name="__codelineno-17-178" href="#__codelineno-17-178"></a>
</span><span id="__span-17-179"><a id="__codelineno-17-179" name="__codelineno-17-179" href="#__codelineno-17-179"></a>VERSION_ADDED_COLLECTION: netbox.netbox
</span><span id="__span-17-180"><a id="__codelineno-17-180" name="__codelineno-17-180" href="#__codelineno-17-180"></a>
</span><span id="__span-17-181"><a id="__codelineno-17-181" name="__codelineno-17-181" href="#__codelineno-17-181"></a>EXAMPLES:
</span><span id="__span-17-182"><a id="__codelineno-17-182" name="__codelineno-17-182" href="#__codelineno-17-182"></a>
</span><span id="__span-17-183"><a id="__codelineno-17-183" name="__codelineno-17-183" href="#__codelineno-17-183"></a>- name: &quot;Test Netbox modules&quot;
</span><span id="__span-17-184"><a id="__codelineno-17-184" name="__codelineno-17-184" href="#__codelineno-17-184"></a>  connection: local
</span><span id="__span-17-185"><a id="__codelineno-17-185" name="__codelineno-17-185" href="#__codelineno-17-185"></a>  hosts: localhost
</span><span id="__span-17-186"><a id="__codelineno-17-186" name="__codelineno-17-186" href="#__codelineno-17-186"></a>  gather_facts: False
</span><span id="__span-17-187"><a id="__codelineno-17-187" name="__codelineno-17-187" href="#__codelineno-17-187"></a>
</span><span id="__span-17-188"><a id="__codelineno-17-188" name="__codelineno-17-188" href="#__codelineno-17-188"></a>  tasks:
</span><span id="__span-17-189"><a id="__codelineno-17-189" name="__codelineno-17-189" href="#__codelineno-17-189"></a>    - name: Create device within Netbox with only required information
</span><span id="__span-17-190"><a id="__codelineno-17-190" name="__codelineno-17-190" href="#__codelineno-17-190"></a>      netbox_device:
</span><span id="__span-17-191"><a id="__codelineno-17-191" name="__codelineno-17-191" href="#__codelineno-17-191"></a>        netbox_url: http://netbox.local
</span><span id="__span-17-192"><a id="__codelineno-17-192" name="__codelineno-17-192" href="#__codelineno-17-192"></a>        netbox_token: thisIsMyToken
</span><span id="__span-17-193"><a id="__codelineno-17-193" name="__codelineno-17-193" href="#__codelineno-17-193"></a>        data:
</span><span id="__span-17-194"><a id="__codelineno-17-194" name="__codelineno-17-194" href="#__codelineno-17-194"></a>          name: Test Device
</span><span id="__span-17-195"><a id="__codelineno-17-195" name="__codelineno-17-195" href="#__codelineno-17-195"></a>          device_type: C9410R
</span><span id="__span-17-196"><a id="__codelineno-17-196" name="__codelineno-17-196" href="#__codelineno-17-196"></a>          device_role: Core Switch
</span><span id="__span-17-197"><a id="__codelineno-17-197" name="__codelineno-17-197" href="#__codelineno-17-197"></a>          site: Main
</span><span id="__span-17-198"><a id="__codelineno-17-198" name="__codelineno-17-198" href="#__codelineno-17-198"></a>        state: present
</span><span id="__span-17-199"><a id="__codelineno-17-199" name="__codelineno-17-199" href="#__codelineno-17-199"></a>
</span><span id="__span-17-200"><a id="__codelineno-17-200" name="__codelineno-17-200" href="#__codelineno-17-200"></a>    - name: Create device within Netbox with empty string name to generate UUID
</span><span id="__span-17-201"><a id="__codelineno-17-201" name="__codelineno-17-201" href="#__codelineno-17-201"></a>      netbox_device:
</span><span id="__span-17-202"><a id="__codelineno-17-202" name="__codelineno-17-202" href="#__codelineno-17-202"></a>        netbox_url: http://netbox.local
</span><span id="__span-17-203"><a id="__codelineno-17-203" name="__codelineno-17-203" href="#__codelineno-17-203"></a>        netbox_token: thisIsMyToken
</span><span id="__span-17-204"><a id="__codelineno-17-204" name="__codelineno-17-204" href="#__codelineno-17-204"></a>        data:
</span><span id="__span-17-205"><a id="__codelineno-17-205" name="__codelineno-17-205" href="#__codelineno-17-205"></a>          name: &quot;&quot;
</span><span id="__span-17-206"><a id="__codelineno-17-206" name="__codelineno-17-206" href="#__codelineno-17-206"></a>          device_type: C9410R
</span><span id="__span-17-207"><a id="__codelineno-17-207" name="__codelineno-17-207" href="#__codelineno-17-207"></a>          device_role: Core Switch
</span><span id="__span-17-208"><a id="__codelineno-17-208" name="__codelineno-17-208" href="#__codelineno-17-208"></a>          site: Main
</span><span id="__span-17-209"><a id="__codelineno-17-209" name="__codelineno-17-209" href="#__codelineno-17-209"></a>        state: present
</span><span id="__span-17-210"><a id="__codelineno-17-210" name="__codelineno-17-210" href="#__codelineno-17-210"></a>
</span><span id="__span-17-211"><a id="__codelineno-17-211" name="__codelineno-17-211" href="#__codelineno-17-211"></a>    - name: Delete device within netbox
</span><span id="__span-17-212"><a id="__codelineno-17-212" name="__codelineno-17-212" href="#__codelineno-17-212"></a>      netbox_device:
</span><span id="__span-17-213"><a id="__codelineno-17-213" name="__codelineno-17-213" href="#__codelineno-17-213"></a>        netbox_url: http://netbox.local
</span><span id="__span-17-214"><a id="__codelineno-17-214" name="__codelineno-17-214" href="#__codelineno-17-214"></a>        netbox_token: thisIsMyToken
</span><span id="__span-17-215"><a id="__codelineno-17-215" name="__codelineno-17-215" href="#__codelineno-17-215"></a>        data:
</span><span id="__span-17-216"><a id="__codelineno-17-216" name="__codelineno-17-216" href="#__codelineno-17-216"></a>          name: Test Device
</span><span id="__span-17-217"><a id="__codelineno-17-217" name="__codelineno-17-217" href="#__codelineno-17-217"></a>        state: absent
</span><span id="__span-17-218"><a id="__codelineno-17-218" name="__codelineno-17-218" href="#__codelineno-17-218"></a>
</span><span id="__span-17-219"><a id="__codelineno-17-219" name="__codelineno-17-219" href="#__codelineno-17-219"></a>    - name: Create device with tags
</span><span id="__span-17-220"><a id="__codelineno-17-220" name="__codelineno-17-220" href="#__codelineno-17-220"></a>      netbox_device:
</span><span id="__span-17-221"><a id="__codelineno-17-221" name="__codelineno-17-221" href="#__codelineno-17-221"></a>        netbox_url: http://netbox.local
</span><span id="__span-17-222"><a id="__codelineno-17-222" name="__codelineno-17-222" href="#__codelineno-17-222"></a>        netbox_token: thisIsMyToken
</span><span id="__span-17-223"><a id="__codelineno-17-223" name="__codelineno-17-223" href="#__codelineno-17-223"></a>        data:
</span><span id="__span-17-224"><a id="__codelineno-17-224" name="__codelineno-17-224" href="#__codelineno-17-224"></a>          name: Another Test Device
</span><span id="__span-17-225"><a id="__codelineno-17-225" name="__codelineno-17-225" href="#__codelineno-17-225"></a>          device_type: C9410R
</span><span id="__span-17-226"><a id="__codelineno-17-226" name="__codelineno-17-226" href="#__codelineno-17-226"></a>          device_role: Core Switch
</span><span id="__span-17-227"><a id="__codelineno-17-227" name="__codelineno-17-227" href="#__codelineno-17-227"></a>          site: Main
</span><span id="__span-17-228"><a id="__codelineno-17-228" name="__codelineno-17-228" href="#__codelineno-17-228"></a>          local_context_data:
</span><span id="__span-17-229"><a id="__codelineno-17-229" name="__codelineno-17-229" href="#__codelineno-17-229"></a>            bgp: &quot;65000&quot;
</span><span id="__span-17-230"><a id="__codelineno-17-230" name="__codelineno-17-230" href="#__codelineno-17-230"></a>          tags:
</span><span id="__span-17-231"><a id="__codelineno-17-231" name="__codelineno-17-231" href="#__codelineno-17-231"></a>            - Schnozzberry
</span><span id="__span-17-232"><a id="__codelineno-17-232" name="__codelineno-17-232" href="#__codelineno-17-232"></a>        state: present
</span><span id="__span-17-233"><a id="__codelineno-17-233" name="__codelineno-17-233" href="#__codelineno-17-233"></a>
</span><span id="__span-17-234"><a id="__codelineno-17-234" name="__codelineno-17-234" href="#__codelineno-17-234"></a>    - name: Update the rack and position of an existing device
</span><span id="__span-17-235"><a id="__codelineno-17-235" name="__codelineno-17-235" href="#__codelineno-17-235"></a>      netbox_device:
</span><span id="__span-17-236"><a id="__codelineno-17-236" name="__codelineno-17-236" href="#__codelineno-17-236"></a>        netbox_url: http://netbox.local
</span><span id="__span-17-237"><a id="__codelineno-17-237" name="__codelineno-17-237" href="#__codelineno-17-237"></a>        netbox_token: thisIsMyToken
</span><span id="__span-17-238"><a id="__codelineno-17-238" name="__codelineno-17-238" href="#__codelineno-17-238"></a>        data:
</span><span id="__span-17-239"><a id="__codelineno-17-239" name="__codelineno-17-239" href="#__codelineno-17-239"></a>          name: Test Device
</span><span id="__span-17-240"><a id="__codelineno-17-240" name="__codelineno-17-240" href="#__codelineno-17-240"></a>          rack: Test Rack
</span><span id="__span-17-241"><a id="__codelineno-17-241" name="__codelineno-17-241" href="#__codelineno-17-241"></a>          position: 10
</span><span id="__span-17-242"><a id="__codelineno-17-242" name="__codelineno-17-242" href="#__codelineno-17-242"></a>          face: Front
</span><span id="__span-17-243"><a id="__codelineno-17-243" name="__codelineno-17-243" href="#__codelineno-17-243"></a>        state: present
</span><span id="__span-17-244"><a id="__codelineno-17-244" name="__codelineno-17-244" href="#__codelineno-17-244"></a>
</span><span id="__span-17-245"><a id="__codelineno-17-245" name="__codelineno-17-245" href="#__codelineno-17-245"></a>
</span><span id="__span-17-246"><a id="__codelineno-17-246" name="__codelineno-17-246" href="#__codelineno-17-246"></a>RETURN VALUES:
</span><span id="__span-17-247"><a id="__codelineno-17-247" name="__codelineno-17-247" href="#__codelineno-17-247"></a>- device
</span><span id="__span-17-248"><a id="__codelineno-17-248" name="__codelineno-17-248" href="#__codelineno-17-248"></a>        Serialized object as created or already existent within Netbox
</span><span id="__span-17-249"><a id="__codelineno-17-249" name="__codelineno-17-249" href="#__codelineno-17-249"></a>
</span><span id="__span-17-250"><a id="__codelineno-17-250" name="__codelineno-17-250" href="#__codelineno-17-250"></a>        returned: success (when `state=present&#39;)
</span><span id="__span-17-251"><a id="__codelineno-17-251" name="__codelineno-17-251" href="#__codelineno-17-251"></a>        type: dict
</span><span id="__span-17-252"><a id="__codelineno-17-252" name="__codelineno-17-252" href="#__codelineno-17-252"></a>
</span><span id="__span-17-253"><a id="__codelineno-17-253" name="__codelineno-17-253" href="#__codelineno-17-253"></a>- msg
</span><span id="__span-17-254"><a id="__codelineno-17-254" name="__codelineno-17-254" href="#__codelineno-17-254"></a>        Message indicating failure or info about what has been
</span><span id="__span-17-255"><a id="__codelineno-17-255" name="__codelineno-17-255" href="#__codelineno-17-255"></a>        achieved
</span><span id="__span-17-256"><a id="__codelineno-17-256" name="__codelineno-17-256" href="#__codelineno-17-256"></a>
</span><span id="__span-17-257"><a id="__codelineno-17-257" name="__codelineno-17-257" href="#__codelineno-17-257"></a>        returned: always
</span><span id="__span-17-258"><a id="__codelineno-17-258" name="__codelineno-17-258" href="#__codelineno-17-258"></a>        type: str
</span></code></pre></div>
<h3 id="summary"><a class="toclink" href="../../../../collection_install/#summary">Summary</a></h3>
<p>Overall the process for getting going with this collection is two steps, of installing the Python dependency and installing the collection via Ansible Galaxy. With these done, you are on your way to using the NetBox Ansible Collection in your environment.</p>
<h3 id="up-next"><a class="toclink" href="../../../../collection_install/#up-next">Up Next</a></h3>
<ul>
<li><a href="https://www.josh-v.com/netbox_ansible_collection/netbox-ansible-inventory_plugin/">Ansible Inventory</a></li>
</ul>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/22228848" alt="Josh VanDeraa">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-11-22 00:00:00">November 22, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">ansible</a>, 
              <a href="../../../cisco/" class="md-meta__link">cisco</a>, 
              <a href="../../../netbox/" class="md-meta__link">netbox</a></li>
        
        
          
          <li class="md-meta__item">
            
              7 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="ansible-netbox-getting-next-prefix-ip"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/">Ansible + NetBox: Getting Next Prefix / IP</a></h2>
<p>This originates from a conversation had on Twitter about how to get the IP Prefix information from an IPAM tool, specifically   NetBox using Ansible. There are a couple of methodologies to go through, and I had originally started down the path of using the URI module. Which could be done. The more elegant solution is to use the NetBox Ansible Collections to handle the logic for you! Let‚Äôs take a look.</p>
<p>Thank you to @ttl255 for the inspiration to the journey with the Collection!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This post was created when NetBox was an open source project used often in my automation framework. I have moved on to using <a href="https://www.nautobot.com">Nautobot</a> due to the project vision and providing a methodology that will drive network automation forward further. You may want to take a look at it yourself.</p>
</div>
<blockquote>
<p>The final playbook will be posted at the very bottom.</p>
</blockquote>
<h3 id="setup"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/#setup">Setup</a></h3>
<p>The NetBox environment for this is NetBox 2.9.9. I have not tested with previous versions, but believe that this will work with 2.8.x as well. The Ansible execution environment is Ansible 2.9.15. This is making use of the Ansible NetBox Collections using the FQCN for the NetBox modules and <strong>NOT</strong> the core modules.  </p>
<p>The first thing to note with this is that there are two variables in the environment to help this. They are the URL and TOKEN. This is good practice to help pass this through without much changes. The primary prefix at the top of the code should likely also move into the environment so that it can be changed.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>NETBOX_URL
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>NETBOX_TOKEN
</span></code></pre></div>
<p>The lab device that will be having the configuration updated is the edge router of my GNS3 lab. This had one more interface available on it for me to change and rather than change things up significantly, I just used this device.</p>
<h3 id="scenario"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/#scenario">Scenario</a></h3>
<p>To get the next available Prefix from NetBox, and assign the IP address to the interface on the router. Success criteria for this scenario include:  </p>
<ol>
<li>Allocate a /24 network prefix within NetBox for use</li>
<li>Allocate the first usable (192.0.2.0/24 would be 192.0.2.1) as allocated within NetBox</li>
<li>Add the IP address configuration to the router interface GigabitEthernet0/3</li>
<li>Add the network to area 0 of the OSPF configuration</li>
</ol>
<p>The device has already been created in NetBox with all of the necessary interfaces. A separate post will be created around adding devices to NetBox. To get started on this I suggest taking a look at a YouTube video that I did for the Ansible Minneapolis Meetup - <a href="https://www.youtube.com/watch?v=GyQf5F0gr3w">https://www.youtube.com/watch?v=GyQf5F0gr3w</a> and the corresponding [GitHub repo]</p>
<h3 id="netbox-prefix-allocation"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/#netbox-prefix-allocation">NetBox Prefix Allocation</a></h3>
<p>Here are the start the NetBox prefix allocation only has a single prefix defined at the start. Only 10.21.0.0/16, which is going to be the parent prefix.</p>
<p><img alt="Empty NetBox Prefix Overview" src="/images/2020/11/netbox_prefix_overview_empty.png" /></p>
<p>We can see that there are no children prefixes and the current allocation is 0.</p>
<p><img alt="Empty NetBox Prefix" src="/images/2020/11/netbox_prefix_empty.png" /></p>
<h3 id="creating-a-prefix-within-netbox"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/#creating-a-prefix-within-netbox">Creating a Prefix within NetBox</a></h3>
<p>The first step is to assign another prefix within NetBox. To do this the following task is used:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">‚Äú10 - GET NEW PREFIX FROM NETBOX {{ primary_prefix }}‚Äù</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="nt">netbox.netbox.netbox_prefix</span><span class="p">:</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="nt">netbox_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">‚Äú{{ lookup(‚Äòenv‚Äô, ‚ÄòNETBOX_URL‚Äô) }}‚Äù</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="nt">netbox_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">‚Äú{{ lookup(‚Äòenv‚Äô, ‚ÄòNETBOX_TOKEN‚Äô) }}‚Äù</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">data</span><span class="p p-Indicator">:</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">        </span><span class="nt">parent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">‚Äú{{ primary_prefix }}‚Äù</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">        </span><span class="nt">prefix_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">    </span><span class="w w-Error">  </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">      </span><span class="nt">first_available</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prefix_info</span>
</span></code></pre></div>
<p>This task is going to take from the parent prefix and allocate a prefix of length 24. This states to take the first available prefix. Executing the playbook we are building with the <code>-vv</code> option and the <code>stdout_callback=yaml</code> in the ansible.cfg file you can see the output:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nt">changed</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">rtr-edge</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; changed=true</span><span class="w"> </span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prefix 10.21.5.0/24 created</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">prefix</span><span class="p p-Indicator">:</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="nt">created</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-11-22&#39;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">    </span><span class="nt">custom_fields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="nt">family</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="nt">is_pool</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="nt">last_updated</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-11-22T15:57:13.641224Z&#39;</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.21.5.0/24</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">    </span><span class="nt">site</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">    </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox.josh-v.com/api/ipam/prefixes/25/</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">    </span><span class="nt">vlan</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">    </span><span class="nt">vrf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span></code></pre></div>
<p>This response when registered will provide with the Prefix ID, prefix itself, and any additional items that may have been set for your NetBox environment. After running this a few times and this demo being the sixth execution this is now what the NetBox environment looks like for prefixes:</p>
<p><img alt="NetBox with 6 prefixes" src="/images/2020/11/netbox_with_prefixes.png" /></p>
<h3 id="ip-address-allocation"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/#ip-address-allocation">IP Address Allocation</a></h3>
<p>After getting the first task to allocate the prefix, next up is to assign the IP address from the prefix. This task allocates an IP address from the prefix that was just previously allocated.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span>
<span class="normal"><a href="#__codelineno-21-6">6</a></span>
<span class="normal"><a href="#__codelineno-21-7">7</a></span>
<span class="normal"><a href="#__codelineno-21-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">ALLOCATE</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">ADDRESS</span><span class="nv"> </span><span class="s">FOR</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">ROUTER</span><span class="nv"> </span><span class="s">INTERFACE&quot;</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">  </span><span class="nt">netbox.netbox.netbox_ip_address</span><span class="p">:</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="nt">netbox_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_URL&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="nt">netbox_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">    </span><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">prefix_info[&#39;prefix&#39;][&#39;prefix&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">new</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ip_address_info</span>
</span></code></pre></div></td></tr></table></div>
<p>On line 6 you see that the prefix gathered is mentioned via the variable. This is taken from the output that was seen from the NetBox Prefix allocation.</p>
<p>This then looks like this for the output:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nt">changed</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">rtr-edge</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; changed=true</span><span class="w"> </span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ip_address</span><span class="p p-Indicator">:</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.21.5.1/24</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="nt">assigned_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="nt">assigned_object_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">    </span><span class="nt">assigned_object_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">    </span><span class="nt">created</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-11-22&#39;</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">    </span><span class="nt">custom_fields</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span><span class="nt">dns_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">    </span><span class="nt">family</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">23</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">    </span><span class="nt">last_updated</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2020-11-22T15:57:14.833379Z&#39;</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">    </span><span class="nt">nat_inside</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">    </span><span class="nt">nat_outside</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">    </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">    </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://netbox.josh-v.com/api/ipam/ip-addresses/23/</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="w">    </span><span class="nt">vrf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="w w-Error">  </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ip_address 10.21.5.1/24 created</span>
</span></code></pre></div>
<p>Taking a look at the NetBox Prefix View for the 10.21.5.0/24 network this is what you see:</p>
<p><img alt="NetBox 10.21.5.0/24 prefix" src="/images/2020/11/netbox_prefix_view.png" /></p>
<p>You can see that there is a single IP address allocated.</p>
<h3 id="variable-shortening"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/#variable-shortening">Variable Shortening</a></h3>
<p>The next task in the Playbook is to shorten some of the variables. This is purely for visualization purposes. In order to not have long lines in the coming tasks, the following was done to create shorter line lengths:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">SET</span><span class="nv"> </span><span class="s">FACTS</span><span class="nv"> </span><span class="s">TO</span><span class="nv"> </span><span class="s">ASSIGN</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">ADDRESS</span><span class="nv"> </span><span class="s">TO</span><span class="nv"> </span><span class="s">CISCO</span><span class="nv"> </span><span class="s">IOS</span><span class="nv"> </span><span class="s">ROUTER&quot;</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">  </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="nt">ip_address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ip_address_info[&#39;ip_address&#39;][&#39;address&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ipaddr(&#39;ip&#39;)</span><span class="nv">  </span><span class="s">}}&quot;</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="nt">netmask</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ip_address_info[&#39;ip_address&#39;][&#39;address&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ipaddr(&#39;netmask&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="apply-the-cisco-configuration"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/#apply-the-cisco-configuration">Apply the Cisco Configuration</a></h3>
<p>Now that there is an IP address and prefix available, and assigned within NetBox, the next step is to add the configuration to the device. Since this is primarily a focus on the NetBox side of things this will be short.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="w">    </span><span class="c1"># DEPLOY THE INFORMATION TO THE ROUTER</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;100</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">ADD</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">ADDRESS</span><span class="nv"> </span><span class="s">INFORMATION</span><span class="nv"> </span><span class="s">TO</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">ROUTER&quot;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">      </span><span class="nt">ios_config</span><span class="p">:</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">        </span><span class="nt">parents</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;interface</span><span class="nv"> </span><span class="s">GigabitEthernet0/3&quot;</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">        </span><span class="nt">lines</span><span class="p">:</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ip</span><span class="nv"> </span><span class="s">address</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ip_address</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">netmask</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">        </span><span class="nt">save_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">changed</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;110</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">ADD</span><span class="nv"> </span><span class="s">ROUTING</span><span class="nv"> </span><span class="s">CONFIGURATION&quot;</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">      </span><span class="nt">ios_config</span><span class="p">:</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">        </span><span class="nt">parents</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;router</span><span class="nv"> </span><span class="s">ospf</span><span class="nv"> </span><span class="s">1&quot;</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">        </span><span class="nt">lines</span><span class="p">:</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;network</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ip_address_info[&#39;ip_address&#39;][&#39;address&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ipaddr(&#39;network&#39;)</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">netmask</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">area</span><span class="nv"> </span><span class="s">0&quot;</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w">        </span><span class="nt">save_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">changed</span>
</span></code></pre></div></td></tr></table></div>
<p>Lines 2-7 are the applying of the configuration to the interface to be used. Lines 9-14 are used to add the network statement to OSPF for the prefix. With this done the interface is now configured and routing is setup.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="l l-Scalar l-Scalar-Plain">TASK [100 - ADD IP ADDRESS INFORMATION TO THE ROUTER] ****************************************************************************************************************</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="l l-Scalar l-Scalar-Plain">changed</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">rtr-edge</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; changed=true</span><span class="w"> </span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts</span><span class="p p-Indicator">:</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="nt">discovered_interpreter_python</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/python</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w w-Error">  </span><span class="nt">banners</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">  </span><span class="nt">commands</span><span class="p">:</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">interface GigabitEthernet0/3</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ip address 10.21.5.1 255.255.255.0</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">  </span><span class="nt">updates</span><span class="p">:</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">interface GigabitEthernet0/3</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ip address 10.21.5.1 255.255.255.0</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="l l-Scalar l-Scalar-Plain">TASK [110 - ADD ROUTING CONFIGURATION] *******************************************************************************************************************************</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="nt">changed</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">rtr-edge</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; changed=true</span><span class="w"> </span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">banners</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">  </span><span class="nt">commands</span><span class="p">:</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">router ospf 1</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network 10.21.5.0 255.255.255.0 area 0</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">  </span><span class="nt">updates</span><span class="p">:</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">router ospf 1</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network 10.21.5.0 255.255.255.0 area 0</span>
</span></code></pre></div>
<h3 id="production-ready"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/#production-ready">Production Ready</a></h3>
<p>This is a quick demo and has some hand holding that needs to be done for it. There does need to be some Atomic handling added yet to make this a rock solid playbook. In a future post I will also cover how to simplify the save_when feature to help speed things up as well. This right now will save the configuration on each change. This should get simplified down to a single save execution.</p>
<h3 id="final-playbook"><a class="toclink" href="../../../../netbox_ansible_allocate_prefix_ipaddress/#final-playbook">Final Playbook</a></h3>
<p>Here is what the final playbook looks like at the moment, again not completely production ready, but is a good starting point.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span>
<span class="normal"><a href="#__codelineno-26-23">23</a></span>
<span class="normal"><a href="#__codelineno-26-24">24</a></span>
<span class="normal"><a href="#__codelineno-26-25">25</a></span>
<span class="normal"><a href="#__codelineno-26-26">26</a></span>
<span class="normal"><a href="#__codelineno-26-27">27</a></span>
<span class="normal"><a href="#__codelineno-26-28">28</a></span>
<span class="normal"><a href="#__codelineno-26-29">29</a></span>
<span class="normal"><a href="#__codelineno-26-30">30</a></span>
<span class="normal"><a href="#__codelineno-26-31">31</a></span>
<span class="normal"><a href="#__codelineno-26-32">32</a></span>
<span class="normal"><a href="#__codelineno-26-33">33</a></span>
<span class="normal"><a href="#__codelineno-26-34">34</a></span>
<span class="normal"><a href="#__codelineno-26-35">35</a></span>
<span class="normal"><a href="#__codelineno-26-36">36</a></span>
<span class="normal"><a href="#__codelineno-26-37">37</a></span>
<span class="normal"><a href="#__codelineno-26-38">38</a></span>
<span class="normal"><a href="#__codelineno-26-39">39</a></span>
<span class="normal"><a href="#__codelineno-26-40">40</a></span>
<span class="normal"><a href="#__codelineno-26-41">41</a></span>
<span class="normal"><a href="#__codelineno-26-42">42</a></span>
<span class="normal"><a href="#__codelineno-26-43">43</a></span>
<span class="normal"><a href="#__codelineno-26-44">44</a></span>
<span class="normal"><a href="#__codelineno-26-45">45</a></span>
<span class="normal"><a href="#__codelineno-26-46">46</a></span>
<span class="normal"><a href="#__codelineno-26-47">47</a></span>
<span class="normal"><a href="#__codelineno-26-48">48</a></span>
<span class="normal"><a href="#__codelineno-26-49">49</a></span>
<span class="normal"><a href="#__codelineno-26-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="nn">---</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PLAY</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">ASSIGN</span><span class="nv"> </span><span class="s">PREFIXES</span><span class="nv"> </span><span class="s">FOR</span><span class="nv"> </span><span class="s">HOST&quot;</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network_cli</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rtr-edge</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">    </span><span class="nt">primary_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.21.0.0/16&quot;</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;LOCALHOST</span><span class="nv"> </span><span class="s">BLOCK&quot;</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">      </span><span class="nt">block</span><span class="p">:</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">GET</span><span class="nv"> </span><span class="s">NEW</span><span class="nv"> </span><span class="s">PREFIX</span><span class="nv"> </span><span class="s">FROM</span><span class="nv"> </span><span class="s">NETBOX</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">primary_prefix</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">          </span><span class="nt">netbox.netbox.netbox_prefix</span><span class="p">:</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">            </span><span class="nt">netbox_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_URL&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="w">            </span><span class="nt">netbox_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="w">            </span><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">              </span><span class="nt">parent</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">primary_prefix</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="w">              </span><span class="nt">prefix_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="w">            </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20"></a><span class="w">            </span><span class="nt">first_available</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="w">          </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prefix_info</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22"></a>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">ALLOCATE</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">ADDRESS</span><span class="nv"> </span><span class="s">FOR</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">ROUTER</span><span class="nv"> </span><span class="s">INTERFACE&quot;</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24"></a><span class="w">          </span><span class="nt">netbox.netbox.netbox_ip_address</span><span class="p">:</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25"></a><span class="w">            </span><span class="nt">netbox_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_URL&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26"></a><span class="w">            </span><span class="nt">netbox_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NETBOX_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27"></a><span class="w">            </span><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28"></a><span class="w">              </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">prefix_info[&#39;prefix&#39;][&#39;prefix&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29"></a><span class="w">            </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">new</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30"></a><span class="w">          </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ip_address_info</span>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31"></a>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">SET</span><span class="nv"> </span><span class="s">FACTS</span><span class="nv"> </span><span class="s">TO</span><span class="nv"> </span><span class="s">ASSIGN</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">ADDRESS</span><span class="nv"> </span><span class="s">TO</span><span class="nv"> </span><span class="s">CISCO</span><span class="nv"> </span><span class="s">IOS</span><span class="nv"> </span><span class="s">ROUTER&quot;</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33"></a><span class="w">          </span><span class="nt">set_fact</span><span class="p">:</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34"></a><span class="w">            </span><span class="nt">ip_address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ip_address_info[&#39;ip_address&#39;][&#39;address&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ipaddr(&#39;ip&#39;)</span><span class="nv">  </span><span class="s">}}&quot;</span>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35"></a><span class="w">            </span><span class="nt">netmask</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ip_address_info[&#39;ip_address&#39;][&#39;address&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ipaddr(&#39;netmask&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36"></a>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37"></a><span class="w">    </span><span class="c1"># DEPLOY THE INFORMATION TO THE ROUTER</span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;100</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">ADD</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">ADDRESS</span><span class="nv"> </span><span class="s">INFORMATION</span><span class="nv"> </span><span class="s">TO</span><span class="nv"> </span><span class="s">THE</span><span class="nv"> </span><span class="s">ROUTER&quot;</span>
</span><span id="__span-26-39"><a id="__codelineno-26-39" name="__codelineno-26-39"></a><span class="w">      </span><span class="nt">ios_config</span><span class="p">:</span>
</span><span id="__span-26-40"><a id="__codelineno-26-40" name="__codelineno-26-40"></a><span class="w">        </span><span class="nt">parents</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;interface</span><span class="nv"> </span><span class="s">GigabitEthernet0/3&quot;</span>
</span><span id="__span-26-41"><a id="__codelineno-26-41" name="__codelineno-26-41"></a><span class="w">        </span><span class="nt">lines</span><span class="p">:</span>
</span><span id="__span-26-42"><a id="__codelineno-26-42" name="__codelineno-26-42"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ip</span><span class="nv"> </span><span class="s">address</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ip_address</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">netmask</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-26-43"><a id="__codelineno-26-43" name="__codelineno-26-43"></a><span class="w">        </span><span class="nt">save_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">changed</span>
</span><span id="__span-26-44"><a id="__codelineno-26-44" name="__codelineno-26-44"></a>
</span><span id="__span-26-45"><a id="__codelineno-26-45" name="__codelineno-26-45"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;110</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">ADD</span><span class="nv"> </span><span class="s">ROUTING</span><span class="nv"> </span><span class="s">CONFIGURATION&quot;</span>
</span><span id="__span-26-46"><a id="__codelineno-26-46" name="__codelineno-26-46"></a><span class="w">      </span><span class="nt">ios_config</span><span class="p">:</span>
</span><span id="__span-26-47"><a id="__codelineno-26-47" name="__codelineno-26-47"></a><span class="w">        </span><span class="nt">parents</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;router</span><span class="nv"> </span><span class="s">ospf</span><span class="nv"> </span><span class="s">1&quot;</span>
</span><span id="__span-26-48"><a id="__codelineno-26-48" name="__codelineno-26-48"></a><span class="w">        </span><span class="nt">lines</span><span class="p">:</span>
</span><span id="__span-26-49"><a id="__codelineno-26-49" name="__codelineno-26-49"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;network</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ip_address_info[&#39;ip_address&#39;][&#39;address&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ipaddr(&#39;network&#39;)</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">netmask</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">area</span><span class="nv"> </span><span class="s">0&quot;</span>
</span><span id="__span-26-50"><a id="__codelineno-26-50" name="__codelineno-26-50"></a><span class="w">        </span><span class="nt">save_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">changed</span>
</span></code></pre></div></td></tr></table></div>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/22228848" alt="Josh VanDeraa">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-04 00:00:00">August 4, 2019</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../eveng/" class="md-meta__link">eveng</a>, 
              <a href="../../" class="md-meta__link">ansible</a>, 
              <a href="../../../network-simulation/" class="md-meta__link">network simulation</a>, 
              <a href="../../../netdevops/" class="md-meta__link">netdevops</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="eve-ng-for-automation-practice-and-testing"><a class="toclink" href="../../../../eveng-for-autoamtion-practice-and-testing/">EVE-NG for Automation Practice and Testing</a></h2>
<p>As I restarted looking at how I'm continuing my education on the Network
Automation and certification realm I asked the question "How are you simulating
your network environment?" At the same time there has been thought on the idea
of leveraging cloud resources to gain experience there.  </p>
<p>First requirement for me is that whatever tool/simulation set that I use it has
to work. That being said, I need to be able to generate configurations, connect
devices to each other, and have packets flow through the simulated network, just
like any other network.</p>
<p>Second requirement is that I desire the solution to be economical. As a
<strong>budget</strong> for this there wasn't a lot of money left to be throwing around.  </p>
<p>Asking around, the third softer requirement is the solution should have a GUI of
some sorts to make things work quickly so you aren't fussing around with
creating your own middleware solution.  </p>
<p>My answer then to this at this point in time (2019-08-04) is EVE-NG. There is a
strong possibility of this changing in the near future based on what I saw at
2019 Cisco Live to Cisco's VIRL, but at the moment, EVE-NG and GNS3 both meet
the requirements.</p>
<p>If you are looking for the part about how I get at devices in the EVE-NG network
jump down to "EVE-NG for Automation Practice".  </p>
<p>This is not going to be a post on getting started on using the solutions.
This post assumes that you are up and running with EVE locally on your network
already. There are links further down that do help though for getting
connectivity.</p>
<h3 id="requirements-for-automation"><a class="toclink" href="../../../../eveng-for-autoamtion-practice-and-testing/#requirements-for-automation">Requirements for automation</a></h3>
<ul>
<li>Must be able to simulate larger networks</li>
<li>Must be able to SSH to the devices directly for automation (Not just click on
and get a console window)</li>
</ul>
<h3 id="evaluation-in-my-mind-no-formal-written-down"><a class="toclink" href="../../../../eveng-for-autoamtion-practice-and-testing/#evaluation-in-my-mind-no-formal-written-down">Evaluation (In my mind, no formal written down)</a></h3>
<p>First when looking at the cloud side of things for running EVE-NG, I had built
out an instance of EVE-NG in Google Cloud with the help of
<a href="https://twitter.com/showipintbri">@showipintbri</a>'s article on
<a href="https://showipintbri.blogspot.com/2018/08/eve-ng-in-cloud.html">EVE-NG in the Cloud</a>.
As I looked at what I had already done with a bare metal host it appeared that
I would need to create a VPN to be able to get at the network behind the cloud
of an EVE-NG. Looking at the pricing on a VPN tunnel per minute/hour with Google
Cloud, I made the evaluation that doing this in the cloud would not be
economical.  </p>
<p>GNS3 has been a solid main stay for some time in the Network simulation world.
There is nothing wrong with it. I have been successful in reaching into the
GNS3 simulated world from a real network. There are some instructions on the web
about how to do so. I had basically followed this instruction set (that has been removed, using the
way back machine to get the old post) - 
<a href="https://web.archive.org/web/20190521002219/https://docs.gns3.com/1vFs-KENh2uUFfb47Q2oeSersmEK4WahzWX-HrMIMd00/index.html">Connect GNS3 to the Internet</a>.  </p>
<p>For me to get started quickly, I had recently installed an EVE-NG bare metal
installation. That is the route that I have chosen at the moment to get started
quickly. For instructions on doing a bare metal installation of EVE-NG I
followed the online docs located on the EVE-NG main page - 
<a href="https://www.eve-ng.net/documentation/installation/bare-install">EVE-NG Bare Metal Install</a>.</p>
<h3 id="eve-ng-for-automation-practice-and-testing_1"><a class="toclink" href="../../../../eveng-for-autoamtion-practice-and-testing/#eve-ng-for-automation-practice-and-testing_1">EVE-NG for Automation Practice and Testing</a></h3>
<p>So now how do we get access to the network? First within EVE-NG I <strong>Add a New
Network</strong> to the project. I make sure that it is set to:</p>
<ul>
<li>Number of Networks to build: 1</li>
<li>Name/Prefix: Internet (Be creative if you wish)</li>
<li>Type: <strong>bridge</strong></li>
</ul>
<p><img alt="EVE-NG Bridge Net" src="/images/2019/07/eveng_add_bridge_net.png" /><br />
The type of <strong>bridge</strong> is what we are looking for to enable the connectivity.  </p>
<h4 id="connecting-your-router"><a class="toclink" href="../../../../eveng-for-autoamtion-practice-and-testing/#connecting-your-router">Connecting your router</a></h4>
<p>First thing you need to do within EVE-NG is to add a router and connect it to
your <em>Outside</em> network. I've done so as shown here:</p>
<p><img alt="EVE-NG Router Host" src="/images/2019/07/eveng_add_bridge_host.png" />  </p>
<p>Then the configuration on this Cisco edge device I have configured the following
on the interface that has been connected to the outside.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>interface<span class="w"> </span>GigabitEthernet0/0
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w"> </span>ip<span class="w"> </span>address<span class="w"> </span>dhcp
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w"> </span>duplex<span class="w"> </span>full
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w"> </span>speed<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w"> </span>media-type<span class="w"> </span>rj45
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>end
</span></code></pre></div>
<p>This allows the device to come online and get a network address. If you wanted
to prescribe what address it is in a static fashion, that is something you can
do too. I like to use DHCP to verify that the device is in fact connected to the
home network.  </p>
<h4 id="routing"><a class="toclink" href="../../../../eveng-for-autoamtion-practice-and-testing/#routing">Routing</a></h4>
<p>For connectivity this is where I like to start with OSPF to peer with my home
firewall. Why? First, because the firewall at home supports OSPF and why not use
routing! Secondly it is more practice with OSPF. Much of the time in my career
has been spent at places where EIGRP is the predominant IGP. It always helps to
continue to gain experience. This is where you could use a static route for your
device to send the routes back into your EVE-NG environment. You'll want to make
sure that you have routes for the networks that are in the network and that they
do not overlap with your existing home network.  </p>
<h4 id="test-connections"><a class="toclink" href="../../../../eveng-for-autoamtion-practice-and-testing/#test-connections">Test Connections</a></h4>
<p>Once connected, I make sure that I make sure that I'm able to connect
successfully with SSH before starting the Ansible work. You could create and get
started with a playbook and test, but I found it is easier to verify that you
have SSH connectivity natively to your devices just like you would with a
non-virtualized network.  </p>
<h3 id="automation-testing"><a class="toclink" href="../../../../eveng-for-autoamtion-practice-and-testing/#automation-testing">Automation Testing</a></h3>
<p>Now that there is connectivity to the devices on the box that you can SSH to
each device from your home network, you are able to do testing of various
playbooks. Start with some simple show commands using the <strong>ios_command</strong> or the
newer <strong>cli_command</strong> module. And then debug it. Head on over to the post my
earlier post
<a href="https://josh-v.com/blog/2019/01/05/ansible-output-work.html">Ansible - working with command output</a>
for some samples on getting started with Cisco devices.  </p>
<p>Hope this is something that is helpful for you at home already running EVE
locally!</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/22228848" alt="Josh VanDeraa">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-06-23 00:00:00">June 23, 2019</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../cisco/" class="md-meta__link">cisco</a>, 
              <a href="../../" class="md-meta__link">ansible</a>, 
              <a href="../../../asa/" class="md-meta__link">asa</a>, 
              <a href="../../../asa_og/" class="md-meta__link">asa_og</a></li>
        
        
          
          <li class="md-meta__item">
            
              16 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="ansible-asa-og-module"><a class="toclink" href="../../../../ansible-asa-og/">Ansible ASA OG Module</a></h2>
<p>Today we are taking a look at the newest module out for Cisco ASA Ansible
module - <a href="https://docs.ansible.com/ansible/latest/modules/asa_og_module.html">asa_og</a>.
This one is particularly exciting for the configurations that are being managed
heavily with Object Groups on firewalls. I'm particularly excited to review the
<strong>asa_og</strong> module, time to dig in.  </p>
<p><strong>New</strong> in this post is the finished playbooks being added to Github. I'm hoping
that this may be helpful and I am uploading the contents to Github for more to
be able to see and get access to if necessary. This will improve as I continue.  </p>
<p><a href="https://github.com/jvanderaa/ansible-asa_work">https://github.com/jvanderaa/ansible-asa_work</a></p>
<p><strong>Note</strong></p>
<blockquote>
<p>When working with this module there is not an option to save the configuration
available with it. Please remember this in your playbook logic. If needing
to save the configuration there are options. Take a look for samples on my
previous post <a href="https://josh-v.com/blog/2019/03/30/ansible-saving-cisco-configs-ios.html">Saving Configurations</a>
which does not include an example with ASAs yet. I will have to write a follow
up post on this at which point I will update hte link and content.</p>
</blockquote>
<h3 id="parameters"><a class="toclink" href="../../../../ansible-asa-og/#parameters">Parameters</a></h3>
<p>First we are going to take a look at the particular parameters to get started,
and what our options are for them. The items in bold are the ones that are
required by the module.</p>
<ul>
<li>description: Description for the object group, good for documenting the
purpose</li>
<li>group_object: This is a list for items within the group</li>
<li><strong>group_type</strong>: network-object, service-object, or port-object</li>
<li>host_ip: List of host addresses within the object group</li>
<li>ip_mask: List of IPs and masks for use in object groups</li>
<li><strong>name</strong>: Name of the object group</li>
<li>port_eq: Single port for port-object</li>
<li>port_range: Range for a port-object</li>
<li>protocol: UDP/TCP/TCP-UDP</li>
<li>service_cfg: Service object configuration protocol, direction, range or port</li>
<li>state: <strong>present</strong>/absent/replace to manage the state of the object</li>
</ul>
<p>For the straight forward parameters this seems like it is something that will be
very handy to use.  </p>
<h3 id="starting-lab-setup"><a class="toclink" href="../../../../ansible-asa-og/#starting-lab-setup">Starting Lab Setup</a></h3>
<p>For this module we are starting with an effectively blank configuration on the
firewalls. In future posts I will come back to this and show complete firewall
policy management using Ansible.</p>
<p>So the lab looks very much the same at the moment as some of the other posts,
which is below:  </p>
<p><img alt="LabDesign" src="/images/2019/01/lab_design.png" />  </p>
<p>Sample goals:<br />
- Create an object group for internal addresses (RFC1918)
- Create an object group for external DNS services (Google DNS, Cloudflare,
Quad9)
- Create a service group for DNS and NTP services
- Verify than a service group for just NTP_ONLY does not exist</p>
<h3 id="leveraging-ansible-og-for-creating-the-modules"><a class="toclink" href="../../../../ansible-asa-og/#leveraging-ansible-og-for-creating-the-modules">Leveraging Ansible OG for creating the modules</a></h3>
<h4 id="creating-rfc1918-group"><a class="toclink" href="../../../../ansible-asa-og/#creating-rfc1918-group">Creating RFC1918 Group</a></h4>
<p>Let's tackle the first item. First to show the configuration on the ASA
firewall for the object group:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span>
<span class="normal"><a href="#__codelineno-76-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="l l-Scalar l-Scalar-Plain">fw01# show object-group</span><span class="w"> </span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="l l-Scalar l-Scalar-Plain">fw01# show run | i RFC 1918</span>
</span></code></pre></div></td></tr></table></div>
<p>We see that there is not the object group that is desired to be there.  </p>
<p>We are going to modify the <em>Playbook</em> created in the last blog post for
<a href="https://josh-v.com/blog/2019/06/20/ansible-asa-command.html">asa_command</a> and
change it to managing our object groups. Starting out it will look like this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="nn">---</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="c1"># yamllint disable rule:truthy</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="c1"># yamllint disable rule:line-length</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ASA OG Working</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network_cli</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">asa_firewalls</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">  </span><span class="nt">become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">RFC1918</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918_Networks</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object</span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-77-18"><a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-77-19"><a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a><span class="w">        </span><span class="nt">ip_mask</span><span class="p">:</span>
</span><span id="__span-77-20"><a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0 255.0.0.0</span>
</span><span id="__span-77-21"><a id="__codelineno-77-21" name="__codelineno-77-21" href="#__codelineno-77-21"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.0.0 255.240.0.0</span>
</span><span id="__span-77-22"><a id="__codelineno-77-22" name="__codelineno-77-22" href="#__codelineno-77-22"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0 255.255.0.0</span>
</span><span id="__span-77-23"><a id="__codelineno-77-23" name="__codelineno-77-23" href="#__codelineno-77-23"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
</span><span id="__span-77-24"><a id="__codelineno-77-24" name="__codelineno-77-24" href="#__codelineno-77-24"></a>
</span><span id="__span-77-25"><a id="__codelineno-77-25" name="__codelineno-77-25" href="#__codelineno-77-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">show</span><span class="nv"> </span><span class="s">interfaces&quot;</span>
</span><span id="__span-77-26"><a id="__codelineno-77-26" name="__codelineno-77-26" href="#__codelineno-77-26"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-77-27"><a id="__codelineno-77-27" name="__codelineno-77-27" href="#__codelineno-77-27"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>Now to run the playbook, the expect that the object group will be on the
firewall.  </p>
<h5 id="playbook-execution"><a class="toclink" href="../../../../ansible-asa-og/#playbook-execution">Playbook Execution</a></h5>
<p>The output from the playbook execution gives us exactly what we were looking
for. </p>
<ul>
<li>Task 1: Connects to the ASA and runs the commands, there is a change as the
ASA did not have the object group previously</li>
<li>Task 2: Output from the previous task shows the commands that were run and the
fact that the device was changed.</li>
</ul>
<h6 id="first-run"><a class="toclink" href="../../../../ansible-asa-og/#first-run">First Run</a></h6>
<iframe width="853" height="480" src="https://www.youtube.com/embed/PKTEWZG85G0?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<div class="language-bash highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>PLAY<span class="w"> </span><span class="o">[</span>ASA<span class="w"> </span>OG<span class="w"> </span>Working<span class="o">]</span><span class="w"> </span>**********************************************************
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Set<span class="w"> </span>RFC1918<span class="w"> </span>Object<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>****************************************
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>changed:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>RFC1918<span class="w"> </span>Object<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>****************************
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="w">        </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>true,
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">        </span><span class="s2">&quot;commands&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w">            </span><span class="s2">&quot;object-group network RFC1918_Networks&quot;</span>,
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="w">            </span><span class="s2">&quot;description RFC1918 Local Networks&quot;</span>,
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="w">            </span><span class="s2">&quot;network-object 10.0.0.0 255.0.0.0&quot;</span>,
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a><span class="w">            </span><span class="s2">&quot;network-object 172.16.0.0 255.240.0.0&quot;</span>,
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a><span class="w">            </span><span class="s2">&quot;network-object 192.168.0.0 255.255.0.0&quot;</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a><span class="w">        </span><span class="o">]</span>,
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a><span class="w">        </span><span class="s2">&quot;failed&quot;</span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-78-18"><a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-78-19"><a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a><span class="o">}</span>
</span><span id="__span-78-20"><a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a>
</span><span id="__span-78-21"><a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a>PLAY<span class="w"> </span>RECAP<span class="w"> </span>*********************************************************************
</span><span id="__span-78-22"><a id="__codelineno-78-22" name="__codelineno-78-22" href="#__codelineno-78-22"></a>asa1<span class="w">                       </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">2</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span>s
</span><span id="__span-78-23"><a id="__codelineno-78-23" name="__codelineno-78-23" href="#__codelineno-78-23"></a><span class="nv">kipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</span></code></pre></div>
<p>Re-running the playbook again, we see that the module is idempotent. Being that
we can safely run this continuously and not have any changes unless they are
necessary.</p>
<h6 id="second-run"><a class="toclink" href="../../../../ansible-asa-og/#second-run">Second Run</a></h6>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-79-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-79-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-79-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-79-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-79-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-79-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-79-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-79-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-79-10">10</a></span>
<span class="normal"><a href="#__codelineno-79-11">11</a></span>
<span class="normal"><a href="#__codelineno-79-12">12</a></span>
<span class="normal"><a href="#__codelineno-79-13">13</a></span>
<span class="normal"><a href="#__codelineno-79-14">14</a></span>
<span class="normal"><a href="#__codelineno-79-15">15</a></span>
<span class="normal"><a href="#__codelineno-79-16">16</a></span>
<span class="normal"><a href="#__codelineno-79-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="l l-Scalar l-Scalar-Plain">PLAY [ASA OG Working] **********************************************************</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2"></a>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 1</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set RFC1918 Object Group] ****************************************</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5"></a>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 2</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print output of RFC1918 Object Group] ****************************</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; {</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9"></a><span class="w">        </span><span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10"></a><span class="w">        </span><span class="s">&quot;commands&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[],</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11"></a><span class="w">        </span><span class="s">&quot;failed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13"></a><span class="err">}</span>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14"></a>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15"></a><span class="l l-Scalar l-Scalar-Plain">PLAY RECAP *********************************************************************</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16"></a><span class="nt">asa1                       </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ok=2    changed=0    unreachable=0    failed=0    s</span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17"></a><span class="l l-Scalar l-Scalar-Plain">kipped=0    rescued=0    ignored=0</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="adding-onto-the-previous-playbook-to-add-the-second-group"><a class="toclink" href="../../../../ansible-asa-og/#adding-onto-the-previous-playbook-to-add-the-second-group">Adding onto the previous playbook to add the second group</a></h4>
<p>Continuing within this playbook we will create the second object group that will
be used, the external DNS providers will be added as host objects to a new group
for <code>EXTERNAL_DNS_NTP</code>. </p>
<p>Let's get straight to the play update. We will create a new task for this
second operation and then output the debug summary.</p>
<h5 id="playbook-setup-adding-host-ip-group"><a class="toclink" href="../../../../ansible-asa-og/#playbook-setup-adding-host-ip-group">Playbook Setup - Adding Host IP group</a></h5>
<p>We have added the second task to the playbook here, with another debug so we can
see when the changes are being made.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="nn">---</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="c1"># yamllint disable rule:truthy</span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="c1"># yamllint disable rule:line-length</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ASA OG Working</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network_cli</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">asa_firewalls</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="w">  </span><span class="nt">become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">RFC1918</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918_Networks</span>
</span><span id="__span-80-16"><a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object</span>
</span><span id="__span-80-17"><a id="__codelineno-80-17" name="__codelineno-80-17" href="#__codelineno-80-17"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-80-18"><a id="__codelineno-80-18" name="__codelineno-80-18" href="#__codelineno-80-18"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-80-19"><a id="__codelineno-80-19" name="__codelineno-80-19" href="#__codelineno-80-19"></a><span class="w">        </span><span class="nt">ip_mask</span><span class="p">:</span>
</span><span id="__span-80-20"><a id="__codelineno-80-20" name="__codelineno-80-20" href="#__codelineno-80-20"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0 255.0.0.0</span>
</span><span id="__span-80-21"><a id="__codelineno-80-21" name="__codelineno-80-21" href="#__codelineno-80-21"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.0.0 255.240.0.0</span>
</span><span id="__span-80-22"><a id="__codelineno-80-22" name="__codelineno-80-22" href="#__codelineno-80-22"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0 255.255.0.0</span>
</span><span id="__span-80-23"><a id="__codelineno-80-23" name="__codelineno-80-23" href="#__codelineno-80-23"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
</span><span id="__span-80-24"><a id="__codelineno-80-24" name="__codelineno-80-24" href="#__codelineno-80-24"></a>
</span><span id="__span-80-25"><a id="__codelineno-80-25" name="__codelineno-80-25" href="#__codelineno-80-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">External</span><span class="nv"> </span><span class="s">DNS/NTP</span><span class="nv"> </span><span class="s">Providers</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-80-26"><a id="__codelineno-80-26" name="__codelineno-80-26" href="#__codelineno-80-26"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-80-27"><a id="__codelineno-80-27" name="__codelineno-80-27" href="#__codelineno-80-27"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EXTERNAL_DNS_NTP</span>
</span><span id="__span-80-28"><a id="__codelineno-80-28" name="__codelineno-80-28" href="#__codelineno-80-28"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object</span>
</span><span id="__span-80-29"><a id="__codelineno-80-29" name="__codelineno-80-29" href="#__codelineno-80-29"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-80-30"><a id="__codelineno-80-30" name="__codelineno-80-30" href="#__codelineno-80-30"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">External DNS Providers (CloudFlare, Google, Quad9, Umbrella)</span>
</span><span id="__span-80-31"><a id="__codelineno-80-31" name="__codelineno-80-31" href="#__codelineno-80-31"></a><span class="w">        </span><span class="nt">host_ip</span><span class="p">:</span>
</span><span id="__span-80-32"><a id="__codelineno-80-32" name="__codelineno-80-32" href="#__codelineno-80-32"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1.1.1</span>
</span><span id="__span-80-33"><a id="__codelineno-80-33" name="__codelineno-80-33" href="#__codelineno-80-33"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.8.8.8</span>
</span><span id="__span-80-34"><a id="__codelineno-80-34" name="__codelineno-80-34" href="#__codelineno-80-34"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9.9.9.9</span>
</span><span id="__span-80-35"><a id="__codelineno-80-35" name="__codelineno-80-35" href="#__codelineno-80-35"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208.67.222.222</span>
</span><span id="__span-80-36"><a id="__codelineno-80-36" name="__codelineno-80-36" href="#__codelineno-80-36"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208.67.220.220</span>
</span><span id="__span-80-37"><a id="__codelineno-80-37" name="__codelineno-80-37" href="#__codelineno-80-37"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output2</span><span class="w">     </span>
</span><span id="__span-80-38"><a id="__codelineno-80-38" name="__codelineno-80-38" href="#__codelineno-80-38"></a>
</span><span id="__span-80-39"><a id="__codelineno-80-39" name="__codelineno-80-39" href="#__codelineno-80-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">RFC1918</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-80-40"><a id="__codelineno-80-40" name="__codelineno-80-40" href="#__codelineno-80-40"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-80-41"><a id="__codelineno-80-41" name="__codelineno-80-41" href="#__codelineno-80-41"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-80-42"><a id="__codelineno-80-42" name="__codelineno-80-42" href="#__codelineno-80-42"></a>
</span><span id="__span-80-43"><a id="__codelineno-80-43" name="__codelineno-80-43" href="#__codelineno-80-43"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">External</span><span class="nv"> </span><span class="s">DNS</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-80-44"><a id="__codelineno-80-44" name="__codelineno-80-44" href="#__codelineno-80-44"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-80-45"><a id="__codelineno-80-45" name="__codelineno-80-45" href="#__codelineno-80-45"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output2</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<h6 id="playbook-execution_1"><a class="toclink" href="../../../../ansible-asa-og/#playbook-execution_1">Playbook Execution</a></h6>
<ul>
<li>Task 1: Comes back OK, the object group is as defined and does not need to get
updated</li>
<li>Task 2: Adds the second object group that we were anticipating adding to the
firewall</li>
<li>Debug 1: Shows that there was no change by the <code>changed</code> output being set to
false</li>
<li>Debug 2: Once again shows the <code>changed</code> flag is set to <code>True</code> and the commands
executed on the device</li>
</ul>
<iframe width="853" height="480" src="https://www.youtube.com/embed/mOiixwviHFk?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<div class="language-bash highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>PLAY<span class="w"> </span><span class="o">[</span>ASA<span class="w"> </span>OG<span class="w"> </span>Working<span class="o">]</span><span class="w"> </span>**********************************************************
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Set<span class="w"> </span>RFC1918<span class="w"> </span>Object<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>****************************************
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Set<span class="w"> </span>External<span class="w"> </span>DNS/NTP<span class="w"> </span>Providers<span class="w"> </span>Object<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>*********************
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>changed:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a>TASK<span class="w"> </span><span class="o">[</span>DEBUG<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>RFC1918<span class="w"> </span>Object<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>***************************
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="w">        </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="w">        </span><span class="s2">&quot;commands&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a><span class="w">        </span><span class="s2">&quot;failed&quot;</span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a><span class="o">}</span>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a>
</span><span id="__span-81-18"><a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a>TASK<span class="w"> </span><span class="o">[</span>DEBUG<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>External<span class="w"> </span>DNS<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>*****************************
</span><span id="__span-81-19"><a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-20"><a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-21"><a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a><span class="w">        </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>true,
</span><span id="__span-81-22"><a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a><span class="w">        </span><span class="s2">&quot;commands&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-81-23"><a id="__codelineno-81-23" name="__codelineno-81-23" href="#__codelineno-81-23"></a><span class="w">            </span><span class="s2">&quot;object-group network EXTERNAL_DNS_NTP&quot;</span>,
</span><span id="__span-81-24"><a id="__codelineno-81-24" name="__codelineno-81-24" href="#__codelineno-81-24"></a><span class="w">            </span><span class="s2">&quot;network-object host 1.1.1.1&quot;</span>,
</span><span id="__span-81-25"><a id="__codelineno-81-25" name="__codelineno-81-25" href="#__codelineno-81-25"></a><span class="w">            </span><span class="s2">&quot;network-object host 8.8.8.8&quot;</span>,
</span><span id="__span-81-26"><a id="__codelineno-81-26" name="__codelineno-81-26" href="#__codelineno-81-26"></a><span class="w">            </span><span class="s2">&quot;network-object host 9.9.9.9&quot;</span>,
</span><span id="__span-81-27"><a id="__codelineno-81-27" name="__codelineno-81-27" href="#__codelineno-81-27"></a><span class="w">            </span><span class="s2">&quot;network-object host 208.67.222.222&quot;</span>,
</span><span id="__span-81-28"><a id="__codelineno-81-28" name="__codelineno-81-28" href="#__codelineno-81-28"></a><span class="w">            </span><span class="s2">&quot;network-object host 208.67.220.220&quot;</span>,
</span><span id="__span-81-29"><a id="__codelineno-81-29" name="__codelineno-81-29" href="#__codelineno-81-29"></a><span class="w">            </span><span class="s2">&quot;description External DNS Providers (CloudFlare, Google, Quad9, Umbr</span>
</span><span id="__span-81-30"><a id="__codelineno-81-30" name="__codelineno-81-30" href="#__codelineno-81-30"></a><span class="s2">            ella)&quot;</span>
</span><span id="__span-81-31"><a id="__codelineno-81-31" name="__codelineno-81-31" href="#__codelineno-81-31"></a><span class="w">        </span><span class="o">]</span>,
</span><span id="__span-81-32"><a id="__codelineno-81-32" name="__codelineno-81-32" href="#__codelineno-81-32"></a><span class="w">        </span><span class="s2">&quot;failed&quot;</span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-81-33"><a id="__codelineno-81-33" name="__codelineno-81-33" href="#__codelineno-81-33"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-81-34"><a id="__codelineno-81-34" name="__codelineno-81-34" href="#__codelineno-81-34"></a><span class="o">}</span>
</span><span id="__span-81-35"><a id="__codelineno-81-35" name="__codelineno-81-35" href="#__codelineno-81-35"></a>
</span><span id="__span-81-36"><a id="__codelineno-81-36" name="__codelineno-81-36" href="#__codelineno-81-36"></a>PLAY<span class="w"> </span>RECAP<span class="w"> </span>**************************************************************************
</span><span id="__span-81-37"><a id="__codelineno-81-37" name="__codelineno-81-37" href="#__codelineno-81-37"></a>asa1<span class="w">                       </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">4</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</span></code></pre></div>
<h6 id="playbook-results-on-asa"><a class="toclink" href="../../../../ansible-asa-og/#playbook-results-on-asa">Playbook Results on ASA</a></h6>
<p>As expected, we get the new items added to the configuration. When we look at
the before and after on the configuration of the ASA we now see that we have
the second object group, exactly as we expected.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-82-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-82-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-82-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-82-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-82-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-82-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-82-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-82-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-82-10">10</a></span>
<span class="normal"><a href="#__codelineno-82-11">11</a></span>
<span class="normal"><a href="#__codelineno-82-12">12</a></span>
<span class="normal"><a href="#__codelineno-82-13">13</a></span>
<span class="normal"><a href="#__codelineno-82-14">14</a></span>
<span class="normal"><a href="#__codelineno-82-15">15</a></span>
<span class="normal"><a href="#__codelineno-82-16">16</a></span>
<span class="normal"><a href="#__codelineno-82-17">17</a></span>
<span class="normal"><a href="#__codelineno-82-18">18</a></span>
<span class="normal"><a href="#__codelineno-82-19">19</a></span>
<span class="normal"><a href="#__codelineno-82-20">20</a></span>
<span class="normal"><a href="#__codelineno-82-21">21</a></span>
<span class="normal"><a href="#__codelineno-82-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="l l-Scalar l-Scalar-Plain">fw01# show object-group</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="l l-Scalar l-Scalar-Plain">object-group network RFC1918_Networks</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 10.0.0.0 255.0.0.0</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 172.16.0.0 255.240.0.0</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 192.168.0.0 255.255.0.0</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7"></a><span class="l l-Scalar l-Scalar-Plain">fw01#</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8"></a><span class="l l-Scalar l-Scalar-Plain">fw01#</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9"></a><span class="l l-Scalar l-Scalar-Plain">fw01#</span><span class="w"> </span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10"></a><span class="l l-Scalar l-Scalar-Plain">fw01# show object-group</span>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11"></a><span class="l l-Scalar l-Scalar-Plain">object-group network RFC1918_Networks</span>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 10.0.0.0 255.0.0.0</span>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 172.16.0.0 255.240.0.0</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 192.168.0.0 255.255.0.0</span>
</span><span id="__span-82-16"><a id="__codelineno-82-16" name="__codelineno-82-16"></a><span class="l l-Scalar l-Scalar-Plain">object-group network EXTERNAL_DNS_NTP</span>
</span><span id="__span-82-17"><a id="__codelineno-82-17" name="__codelineno-82-17"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">External DNS Providers (CloudFlare, Google, Quad9, Umbrella)</span>
</span><span id="__span-82-18"><a id="__codelineno-82-18" name="__codelineno-82-18"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 1.1.1.1</span>
</span><span id="__span-82-19"><a id="__codelineno-82-19" name="__codelineno-82-19"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 8.8.8.8</span>
</span><span id="__span-82-20"><a id="__codelineno-82-20" name="__codelineno-82-20"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 9.9.9.9</span>
</span><span id="__span-82-21"><a id="__codelineno-82-21" name="__codelineno-82-21"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.222.222</span>
</span><span id="__span-82-22"><a id="__codelineno-82-22" name="__codelineno-82-22"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.220.220</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="adding-on-the-port-group"><a class="toclink" href="../../../../ansible-asa-og/#adding-on-the-port-group">Adding on the Port Group</a></h4>
<p>Now we need to complete the setup by adding a port group to the playbook so
when a policy is built that the hosts can communicate on the specific ports. To
start off the policy will use only UDP ports 53 (DNS) and 123 (NTP).</p>
<blockquote>
<p>Yes DNS is also on TCP/53, but for this we will stick to only the UDP side for
non large requests.</p>
<p>Issue: When working on this I came across an issue with the asa_og module and
my particular setup (Python3.7.2) with respects to Ansible 2.8. The
concatenation engine would error out combining strings (the actual commands)
and integers. The work around on this that you see in the playbook is that
the ports are surrounded by quotes. This makes them strings instead of
integers and the module works. I have opened an issue on github for this.
<a href="https://github.com/ansible/ansible/issues/58258">https://github.com/ansible/ansible/issues/58258</a>
if you wish to check on the status.</p>
</blockquote>
<h5 id="playbook-adding-in-port-object-group-creation"><a class="toclink" href="../../../../ansible-asa-og/#playbook-adding-in-port-object-group-creation">Playbook - Adding in port-object group creation</a></h5>
<p>As expected there is a third task now that will be for creating the port object.
From the module parameters we are now using parameters of <code>protocol</code> and
<code>port_eq</code>. These are expected parameters for creating a port group.</p>
<h6 id="playbook-task-design-port-group"><a class="toclink" href="../../../../ansible-asa-og/#playbook-task-design-port-group">Playbook Task Design - Port Group</a></h6>
<p>Here is the task that is added with the group-type set to <code>port-object</code>:  </p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">3:</span><span class="nv"> </span><span class="s">Add</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SVC_OBJ_DNS_NTP</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="w">        </span><span class="nt">port_eq</span><span class="p">:</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">123</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output3</span>
</span></code></pre></div>
<p>This brings the full playbook to looking like this:  </p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="nn">---</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="c1"># yamllint disable rule:truthy</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="c1"># yamllint disable rule:line-length</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ASA OG Working</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network_cli</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">asa_firewalls</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="w">  </span><span class="nt">become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">RFC1918</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918_Networks</span>
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object</span>
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-84-19"><a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a><span class="w">        </span><span class="nt">ip_mask</span><span class="p">:</span>
</span><span id="__span-84-20"><a id="__codelineno-84-20" name="__codelineno-84-20" href="#__codelineno-84-20"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0 255.0.0.0</span>
</span><span id="__span-84-21"><a id="__codelineno-84-21" name="__codelineno-84-21" href="#__codelineno-84-21"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.0.0 255.240.0.0</span>
</span><span id="__span-84-22"><a id="__codelineno-84-22" name="__codelineno-84-22" href="#__codelineno-84-22"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0 255.255.0.0</span>
</span><span id="__span-84-23"><a id="__codelineno-84-23" name="__codelineno-84-23" href="#__codelineno-84-23"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
</span><span id="__span-84-24"><a id="__codelineno-84-24" name="__codelineno-84-24" href="#__codelineno-84-24"></a>
</span><span id="__span-84-25"><a id="__codelineno-84-25" name="__codelineno-84-25" href="#__codelineno-84-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">External</span><span class="nv"> </span><span class="s">DNS/NTP</span><span class="nv"> </span><span class="s">Providers</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-84-26"><a id="__codelineno-84-26" name="__codelineno-84-26" href="#__codelineno-84-26"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-84-27"><a id="__codelineno-84-27" name="__codelineno-84-27" href="#__codelineno-84-27"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EXTERNAL_DNS_NTP</span>
</span><span id="__span-84-28"><a id="__codelineno-84-28" name="__codelineno-84-28" href="#__codelineno-84-28"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object</span>
</span><span id="__span-84-29"><a id="__codelineno-84-29" name="__codelineno-84-29" href="#__codelineno-84-29"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-84-30"><a id="__codelineno-84-30" name="__codelineno-84-30" href="#__codelineno-84-30"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">External DNS Providers (CloudFlare, Google, Quad9, Umbrella)</span>
</span><span id="__span-84-31"><a id="__codelineno-84-31" name="__codelineno-84-31" href="#__codelineno-84-31"></a><span class="w">        </span><span class="nt">host_ip</span><span class="p">:</span>
</span><span id="__span-84-32"><a id="__codelineno-84-32" name="__codelineno-84-32" href="#__codelineno-84-32"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1.1.1</span>
</span><span id="__span-84-33"><a id="__codelineno-84-33" name="__codelineno-84-33" href="#__codelineno-84-33"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.8.8.8</span>
</span><span id="__span-84-34"><a id="__codelineno-84-34" name="__codelineno-84-34" href="#__codelineno-84-34"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9.9.9.9</span>
</span><span id="__span-84-35"><a id="__codelineno-84-35" name="__codelineno-84-35" href="#__codelineno-84-35"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208.67.222.222</span>
</span><span id="__span-84-36"><a id="__codelineno-84-36" name="__codelineno-84-36" href="#__codelineno-84-36"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208.67.220.220</span>
</span><span id="__span-84-37"><a id="__codelineno-84-37" name="__codelineno-84-37" href="#__codelineno-84-37"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output2</span>
</span><span id="__span-84-38"><a id="__codelineno-84-38" name="__codelineno-84-38" href="#__codelineno-84-38"></a>
</span><span id="__span-84-39"><a id="__codelineno-84-39" name="__codelineno-84-39" href="#__codelineno-84-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">3:</span><span class="nv"> </span><span class="s">Add</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-84-40"><a id="__codelineno-84-40" name="__codelineno-84-40" href="#__codelineno-84-40"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-84-41"><a id="__codelineno-84-41" name="__codelineno-84-41" href="#__codelineno-84-41"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SVC_OBJ_DNS_NTP</span>
</span><span id="__span-84-42"><a id="__codelineno-84-42" name="__codelineno-84-42" href="#__codelineno-84-42"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object</span>
</span><span id="__span-84-43"><a id="__codelineno-84-43" name="__codelineno-84-43" href="#__codelineno-84-43"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-84-44"><a id="__codelineno-84-44" name="__codelineno-84-44" href="#__codelineno-84-44"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-84-45"><a id="__codelineno-84-45" name="__codelineno-84-45" href="#__codelineno-84-45"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span>
</span><span id="__span-84-46"><a id="__codelineno-84-46" name="__codelineno-84-46" href="#__codelineno-84-46"></a><span class="w">        </span><span class="nt">port_eq</span><span class="p">:</span>
</span><span id="__span-84-47"><a id="__codelineno-84-47" name="__codelineno-84-47" href="#__codelineno-84-47"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
</span><span id="__span-84-48"><a id="__codelineno-84-48" name="__codelineno-84-48" href="#__codelineno-84-48"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">123</span>
</span><span id="__span-84-49"><a id="__codelineno-84-49" name="__codelineno-84-49" href="#__codelineno-84-49"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output3</span>
</span><span id="__span-84-50"><a id="__codelineno-84-50" name="__codelineno-84-50" href="#__codelineno-84-50"></a>
</span><span id="__span-84-51"><a id="__codelineno-84-51" name="__codelineno-84-51" href="#__codelineno-84-51"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">RFC1918</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-84-52"><a id="__codelineno-84-52" name="__codelineno-84-52" href="#__codelineno-84-52"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-84-53"><a id="__codelineno-84-53" name="__codelineno-84-53" href="#__codelineno-84-53"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-84-54"><a id="__codelineno-84-54" name="__codelineno-84-54" href="#__codelineno-84-54"></a>
</span><span id="__span-84-55"><a id="__codelineno-84-55" name="__codelineno-84-55" href="#__codelineno-84-55"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">External</span><span class="nv"> </span><span class="s">DNS</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-84-56"><a id="__codelineno-84-56" name="__codelineno-84-56" href="#__codelineno-84-56"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-84-57"><a id="__codelineno-84-57" name="__codelineno-84-57" href="#__codelineno-84-57"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output2</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-84-58"><a id="__codelineno-84-58" name="__codelineno-84-58" href="#__codelineno-84-58"></a>
</span><span id="__span-84-59"><a id="__codelineno-84-59" name="__codelineno-84-59" href="#__codelineno-84-59"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">3:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">adding</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-84-60"><a id="__codelineno-84-60" name="__codelineno-84-60" href="#__codelineno-84-60"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-84-61"><a id="__codelineno-84-61" name="__codelineno-84-61" href="#__codelineno-84-61"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output3</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-84-62"><a id="__codelineno-84-62" name="__codelineno-84-62" href="#__codelineno-84-62"></a>
</span><span id="__span-84-63"><a id="__codelineno-84-63" name="__codelineno-84-63" href="#__codelineno-84-63"></a><span class="nn">...</span>
</span></code></pre></div>
<h6 id="playbook-execution_2"><a class="toclink" href="../../../../ansible-asa-og/#playbook-execution_2">Playbook Execution</a></h6>
<p>Task 1: Reports OK, as there are no changes here - as expected
Task 2: Also reports OK, as there should be no changes - as expected
Task 3: Creates the port-object to be used
Debug 1: Shows no changes
Debug 2: Shows no changes
Debug 3: Shows that the changed flag is set to <code>True</code> and that the changes sent
to the device creates the port object</p>
<iframe width="853" height="480" src="https://www.youtube.com/embed/X7mH-x9ui28?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-85-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-85-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-85-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-85-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-85-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-85-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-85-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-85-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-85-10">10</a></span>
<span class="normal"><a href="#__codelineno-85-11">11</a></span>
<span class="normal"><a href="#__codelineno-85-12">12</a></span>
<span class="normal"><a href="#__codelineno-85-13">13</a></span>
<span class="normal"><a href="#__codelineno-85-14">14</a></span>
<span class="normal"><a href="#__codelineno-85-15">15</a></span>
<span class="normal"><a href="#__codelineno-85-16">16</a></span>
<span class="normal"><a href="#__codelineno-85-17">17</a></span>
<span class="normal"><a href="#__codelineno-85-18">18</a></span>
<span class="normal"><a href="#__codelineno-85-19">19</a></span>
<span class="normal"><a href="#__codelineno-85-20">20</a></span>
<span class="normal"><a href="#__codelineno-85-21">21</a></span>
<span class="normal"><a href="#__codelineno-85-22">22</a></span>
<span class="normal"><a href="#__codelineno-85-23">23</a></span>
<span class="normal"><a href="#__codelineno-85-24">24</a></span>
<span class="normal"><a href="#__codelineno-85-25">25</a></span>
<span class="normal"><a href="#__codelineno-85-26">26</a></span>
<span class="normal"><a href="#__codelineno-85-27">27</a></span>
<span class="normal"><a href="#__codelineno-85-28">28</a></span>
<span class="normal"><a href="#__codelineno-85-29">29</a></span>
<span class="normal"><a href="#__codelineno-85-30">30</a></span>
<span class="normal"><a href="#__codelineno-85-31">31</a></span>
<span class="normal"><a href="#__codelineno-85-32">32</a></span>
<span class="normal"><a href="#__codelineno-85-33">33</a></span>
<span class="normal"><a href="#__codelineno-85-34">34</a></span>
<span class="normal"><a href="#__codelineno-85-35">35</a></span>
<span class="normal"><a href="#__codelineno-85-36">36</a></span>
<span class="normal"><a href="#__codelineno-85-37">37</a></span>
<span class="normal"><a href="#__codelineno-85-38">38</a></span>
<span class="normal"><a href="#__codelineno-85-39">39</a></span>
<span class="normal"><a href="#__codelineno-85-40">40</a></span>
<span class="normal"><a href="#__codelineno-85-41">41</a></span>
<span class="normal"><a href="#__codelineno-85-42">42</a></span>
<span class="normal"><a href="#__codelineno-85-43">43</a></span>
<span class="normal"><a href="#__codelineno-85-44">44</a></span>
<span class="normal"><a href="#__codelineno-85-45">45</a></span>
<span class="normal"><a href="#__codelineno-85-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="l l-Scalar l-Scalar-Plain">PLAY [ASA OG Working] **********************************************************</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2"></a>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 1</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set RFC1918 Object Group] ****************************************</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5"></a>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 2</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set External DNS/NTP Providers Object Group] *********************</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8"></a>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 3</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Add Port Group] **************************************************</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10"></a><span class="nt">changed</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11"></a>
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12"></a><span class="l l-Scalar l-Scalar-Plain">TASK [DEBUG 1</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print output of RFC1918 Object Group] ***************************</span>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; {</span>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
</span><span id="__span-85-15"><a id="__codelineno-85-15" name="__codelineno-85-15"></a><span class="w">        </span><span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
</span><span id="__span-85-16"><a id="__codelineno-85-16" name="__codelineno-85-16"></a><span class="w">        </span><span class="s">&quot;commands&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[],</span>
</span><span id="__span-85-17"><a id="__codelineno-85-17" name="__codelineno-85-17"></a><span class="w">        </span><span class="s">&quot;failed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span>
</span><span id="__span-85-18"><a id="__codelineno-85-18" name="__codelineno-85-18"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-85-19"><a id="__codelineno-85-19" name="__codelineno-85-19"></a><span class="err">}</span>
</span><span id="__span-85-20"><a id="__codelineno-85-20" name="__codelineno-85-20"></a>
</span><span id="__span-85-21"><a id="__codelineno-85-21" name="__codelineno-85-21"></a><span class="l l-Scalar l-Scalar-Plain">TASK [DEBUG 2</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print output of External DNS Group] *****************************</span>
</span><span id="__span-85-22"><a id="__codelineno-85-22" name="__codelineno-85-22"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; {</span>
</span><span id="__span-85-23"><a id="__codelineno-85-23" name="__codelineno-85-23"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
</span><span id="__span-85-24"><a id="__codelineno-85-24" name="__codelineno-85-24"></a><span class="w">        </span><span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
</span><span id="__span-85-25"><a id="__codelineno-85-25" name="__codelineno-85-25"></a><span class="w">        </span><span class="s">&quot;commands&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[],</span>
</span><span id="__span-85-26"><a id="__codelineno-85-26" name="__codelineno-85-26"></a><span class="w">        </span><span class="s">&quot;failed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span>
</span><span id="__span-85-27"><a id="__codelineno-85-27" name="__codelineno-85-27"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-85-28"><a id="__codelineno-85-28" name="__codelineno-85-28"></a><span class="err">}</span>
</span><span id="__span-85-29"><a id="__codelineno-85-29" name="__codelineno-85-29"></a>
</span><span id="__span-85-30"><a id="__codelineno-85-30" name="__codelineno-85-30"></a><span class="l l-Scalar l-Scalar-Plain">TASK [DEBUG 3</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print output of adding Port Group] ******************************</span>
</span><span id="__span-85-31"><a id="__codelineno-85-31" name="__codelineno-85-31"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; {</span>
</span><span id="__span-85-32"><a id="__codelineno-85-32" name="__codelineno-85-32"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
</span><span id="__span-85-33"><a id="__codelineno-85-33" name="__codelineno-85-33"></a><span class="w">        </span><span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span>
</span><span id="__span-85-34"><a id="__codelineno-85-34" name="__codelineno-85-34"></a><span class="w">        </span><span class="s">&quot;commands&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
</span><span id="__span-85-35"><a id="__codelineno-85-35" name="__codelineno-85-35"></a><span class="w">            </span><span class="s">&quot;object-group</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">SVC_OBJ_DNS_NTP</span><span class="nv"> </span><span class="s">udp&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-85-36"><a id="__codelineno-85-36" name="__codelineno-85-36"></a><span class="w">            </span><span class="s">&quot;port-object</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">53&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-85-37"><a id="__codelineno-85-37" name="__codelineno-85-37"></a><span class="w">            </span><span class="s">&quot;port-object</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">123&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-85-38"><a id="__codelineno-85-38" name="__codelineno-85-38"></a><span class="w">            </span><span class="s">&quot;description</span><span class="nv"> </span><span class="s">DNS</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">NTP</span><span class="nv"> </span><span class="s">ports&quot;</span>
</span><span id="__span-85-39"><a id="__codelineno-85-39" name="__codelineno-85-39"></a><span class="w">        </span><span class="p p-Indicator">],</span>
</span><span id="__span-85-40"><a id="__codelineno-85-40" name="__codelineno-85-40"></a><span class="w">        </span><span class="s">&quot;failed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span>
</span><span id="__span-85-41"><a id="__codelineno-85-41" name="__codelineno-85-41"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-85-42"><a id="__codelineno-85-42" name="__codelineno-85-42"></a><span class="err">}</span>
</span><span id="__span-85-43"><a id="__codelineno-85-43" name="__codelineno-85-43"></a>
</span><span id="__span-85-44"><a id="__codelineno-85-44" name="__codelineno-85-44"></a><span class="l l-Scalar l-Scalar-Plain">PLAY RECAP *********************************************************************</span>
</span><span id="__span-85-45"><a id="__codelineno-85-45" name="__codelineno-85-45"></a><span class="nt">asa1                       </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ok=6    changed=1    unreachable=0    failed=0    s</span>
</span><span id="__span-85-46"><a id="__codelineno-85-46" name="__codelineno-85-46"></a><span class="l l-Scalar l-Scalar-Plain">kipped=0    rescued=0    ignored=0</span>
</span></code></pre></div></td></tr></table></div>
<h6 id="changes-on-the-asa"><a class="toclink" href="../../../../ansible-asa-og/#changes-on-the-asa">Changes on the ASA</a></h6>
<p>And as we are use to seeing, we see the update on the ASA itself:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-86-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-86-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-86-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-86-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-86-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-86-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-86-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-86-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-86-10">10</a></span>
<span class="normal"><a href="#__codelineno-86-11">11</a></span>
<span class="normal"><a href="#__codelineno-86-12">12</a></span>
<span class="normal"><a href="#__codelineno-86-13">13</a></span>
<span class="normal"><a href="#__codelineno-86-14">14</a></span>
<span class="normal"><a href="#__codelineno-86-15">15</a></span>
<span class="normal"><a href="#__codelineno-86-16">16</a></span>
<span class="normal"><a href="#__codelineno-86-17">17</a></span>
<span class="normal"><a href="#__codelineno-86-18">18</a></span>
<span class="normal"><a href="#__codelineno-86-19">19</a></span>
<span class="normal"><a href="#__codelineno-86-20">20</a></span>
<span class="normal"><a href="#__codelineno-86-21">21</a></span>
<span class="normal"><a href="#__codelineno-86-22">22</a></span>
<span class="normal"><a href="#__codelineno-86-23">23</a></span>
<span class="normal"><a href="#__codelineno-86-24">24</a></span>
<span class="normal"><a href="#__codelineno-86-25">25</a></span>
<span class="normal"><a href="#__codelineno-86-26">26</a></span>
<span class="normal"><a href="#__codelineno-86-27">27</a></span>
<span class="normal"><a href="#__codelineno-86-28">28</a></span>
<span class="normal"><a href="#__codelineno-86-29">29</a></span>
<span class="normal"><a href="#__codelineno-86-30">30</a></span>
<span class="normal"><a href="#__codelineno-86-31">31</a></span>
<span class="normal"><a href="#__codelineno-86-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="l l-Scalar l-Scalar-Plain">fw01# show object-group</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="l l-Scalar l-Scalar-Plain">object-group network RFC1918_Networks</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 10.0.0.0 255.0.0.0</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 172.16.0.0 255.240.0.0</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 192.168.0.0 255.255.0.0</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7"></a><span class="l l-Scalar l-Scalar-Plain">object-group network EXTERNAL_DNS_NTP</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">External DNS Providers (CloudFlare, Google, Quad9, Umbrella)</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 1.1.1.1</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 8.8.8.8</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 9.9.9.9</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.222.222</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.220.220</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14"></a><span class="l l-Scalar l-Scalar-Plain">fw01#</span>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15"></a><span class="l l-Scalar l-Scalar-Plain">fw01#</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16"></a><span class="l l-Scalar l-Scalar-Plain">fw01# show object-group</span>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17"></a><span class="l l-Scalar l-Scalar-Plain">object-group network RFC1918_Networks</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 10.0.0.0 255.0.0.0</span>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 172.16.0.0 255.240.0.0</span>
</span><span id="__span-86-21"><a id="__codelineno-86-21" name="__codelineno-86-21"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 192.168.0.0 255.255.0.0</span>
</span><span id="__span-86-22"><a id="__codelineno-86-22" name="__codelineno-86-22"></a><span class="l l-Scalar l-Scalar-Plain">object-group network EXTERNAL_DNS_NTP</span>
</span><span id="__span-86-23"><a id="__codelineno-86-23" name="__codelineno-86-23"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">External DNS Providers (CloudFlare, Google, Quad9, Umbrella)</span>
</span><span id="__span-86-24"><a id="__codelineno-86-24" name="__codelineno-86-24"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 1.1.1.1</span>
</span><span id="__span-86-25"><a id="__codelineno-86-25" name="__codelineno-86-25"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 8.8.8.8</span>
</span><span id="__span-86-26"><a id="__codelineno-86-26" name="__codelineno-86-26"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 9.9.9.9</span>
</span><span id="__span-86-27"><a id="__codelineno-86-27" name="__codelineno-86-27"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.222.222</span>
</span><span id="__span-86-28"><a id="__codelineno-86-28" name="__codelineno-86-28"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.220.220</span>
</span><span id="__span-86-29"><a id="__codelineno-86-29" name="__codelineno-86-29"></a><span class="l l-Scalar l-Scalar-Plain">object-group service SVC_OBJ_DNS_NTP udp</span>
</span><span id="__span-86-30"><a id="__codelineno-86-30" name="__codelineno-86-30"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-86-31"><a id="__codelineno-86-31" name="__codelineno-86-31"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq domain</span>
</span><span id="__span-86-32"><a id="__codelineno-86-32" name="__codelineno-86-32"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq ntp</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="removing-groups"><a class="toclink" href="../../../../ansible-asa-og/#removing-groups">Removing groups</a></h4>
<p>The last thing to demo is the <code>state: absent</code> of the module. What I have seen in
testing at the moment is that the module does not delete the group all together,
but removes the object members. Let's take a look at this in action.</p>
<h5 id="setup-deletion"><a class="toclink" href="../../../../ansible-asa-og/#setup-deletion">Setup - Deletion</a></h5>
<p>First I went ahead and created a new group (using Ansible of course). This is
the old group for DNS that is no longer being used. So we should clean that up
of course. <strong>This module only deletes items from within the object-group, it
will NOT remove an entire object-group</strong>.  </p>
<p>The firewall configuration has the following for object groups:  </p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-87-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-87-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-87-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-87-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-87-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-87-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-87-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-87-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-87-10">10</a></span>
<span class="normal"><a href="#__codelineno-87-11">11</a></span>
<span class="normal"><a href="#__codelineno-87-12">12</a></span>
<span class="normal"><a href="#__codelineno-87-13">13</a></span>
<span class="normal"><a href="#__codelineno-87-14">14</a></span>
<span class="normal"><a href="#__codelineno-87-15">15</a></span>
<span class="normal"><a href="#__codelineno-87-16">16</a></span>
<span class="normal"><a href="#__codelineno-87-17">17</a></span>
<span class="normal"><a href="#__codelineno-87-18">18</a></span>
<span class="normal"><a href="#__codelineno-87-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="l l-Scalar l-Scalar-Plain">object-group network RFC1918_Networks</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 10.0.0.0 255.0.0.0</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 172.16.0.0 255.240.0.0</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 192.168.0.0 255.255.0.0</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6"></a><span class="l l-Scalar l-Scalar-Plain">object-group network EXTERNAL_DNS_NTP</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">External DNS Providers (CloudFlare, Google, Quad9, Umbrella)</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 1.1.1.1</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 8.8.8.8</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 9.9.9.9</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.222.222</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.220.220</span>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13"></a><span class="l l-Scalar l-Scalar-Plain">object-group service SVC_OBJ_DNS_NTP udp</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq domain</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq ntp</span>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17"></a><span class="l l-Scalar l-Scalar-Plain">object-group service DNS_ONLY udp</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS ports</span>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq domain</span>
</span></code></pre></div></td></tr></table></div>
<h5 id="task-created-absent-state"><a class="toclink" href="../../../../ansible-asa-og/#task-created-absent-state">Task Created - Absent state</a></h5>
<p>Here is the task with the state changed from <code>present</code> to <code>absent</code>:  </p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">4:</span><span class="nv"> </span><span class="s">Remove</span><span class="nv"> </span><span class="s">Extra</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS_ONLY</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w">        </span><span class="nt">port_eq</span><span class="p">:</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">domain</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output4</span>
</span></code></pre></div>
<h5 id="playbook-execution-absent-state-for-an-object-group"><a class="toclink" href="../../../../ansible-asa-og/#playbook-execution-absent-state-for-an-object-group">Playbook Execution - Absent state for an object group</a></h5>
<p>Task 1 - 3: These are the idempotent adds. There is not any changes being made,
so these remain OK.
Task 4: Removes the particular item from within a group. So you will need to
call out all of the objects that you want to have missing from here. The next
task will take a look at another helpful state of <strong>replace</strong>.  </p>
<iframe width="853" height="480" src="https://www.youtube.com/embed/ucKFWlirHjE?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-89-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-89-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-89-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-89-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-89-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-89-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-89-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-89-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-89-10">10</a></span>
<span class="normal"><a href="#__codelineno-89-11">11</a></span>
<span class="normal"><a href="#__codelineno-89-12">12</a></span>
<span class="normal"><a href="#__codelineno-89-13">13</a></span>
<span class="normal"><a href="#__codelineno-89-14">14</a></span>
<span class="normal"><a href="#__codelineno-89-15">15</a></span>
<span class="normal"><a href="#__codelineno-89-16">16</a></span>
<span class="normal"><a href="#__codelineno-89-17">17</a></span>
<span class="normal"><a href="#__codelineno-89-18">18</a></span>
<span class="normal"><a href="#__codelineno-89-19">19</a></span>
<span class="normal"><a href="#__codelineno-89-20">20</a></span>
<span class="normal"><a href="#__codelineno-89-21">21</a></span>
<span class="normal"><a href="#__codelineno-89-22">22</a></span>
<span class="normal"><a href="#__codelineno-89-23">23</a></span>
<span class="normal"><a href="#__codelineno-89-24">24</a></span>
<span class="normal"><a href="#__codelineno-89-25">25</a></span>
<span class="normal"><a href="#__codelineno-89-26">26</a></span>
<span class="normal"><a href="#__codelineno-89-27">27</a></span>
<span class="normal"><a href="#__codelineno-89-28">28</a></span>
<span class="normal"><a href="#__codelineno-89-29">29</a></span>
<span class="normal"><a href="#__codelineno-89-30">30</a></span>
<span class="normal"><a href="#__codelineno-89-31">31</a></span>
<span class="normal"><a href="#__codelineno-89-32">32</a></span>
<span class="normal"><a href="#__codelineno-89-33">33</a></span>
<span class="normal"><a href="#__codelineno-89-34">34</a></span>
<span class="normal"><a href="#__codelineno-89-35">35</a></span>
<span class="normal"><a href="#__codelineno-89-36">36</a></span>
<span class="normal"><a href="#__codelineno-89-37">37</a></span>
<span class="normal"><a href="#__codelineno-89-38">38</a></span>
<span class="normal"><a href="#__codelineno-89-39">39</a></span>
<span class="normal"><a href="#__codelineno-89-40">40</a></span>
<span class="normal"><a href="#__codelineno-89-41">41</a></span>
<span class="normal"><a href="#__codelineno-89-42">42</a></span>
<span class="normal"><a href="#__codelineno-89-43">43</a></span>
<span class="normal"><a href="#__codelineno-89-44">44</a></span>
<span class="normal"><a href="#__codelineno-89-45">45</a></span>
<span class="normal"><a href="#__codelineno-89-46">46</a></span>
<span class="normal"><a href="#__codelineno-89-47">47</a></span>
<span class="normal"><a href="#__codelineno-89-48">48</a></span>
<span class="normal"><a href="#__codelineno-89-49">49</a></span>
<span class="normal"><a href="#__codelineno-89-50">50</a></span>
<span class="normal"><a href="#__codelineno-89-51">51</a></span>
<span class="normal"><a href="#__codelineno-89-52">52</a></span>
<span class="normal"><a href="#__codelineno-89-53">53</a></span>
<span class="normal"><a href="#__codelineno-89-54">54</a></span>
<span class="normal"><a href="#__codelineno-89-55">55</a></span>
<span class="normal"><a href="#__codelineno-89-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="l l-Scalar l-Scalar-Plain">PLAY [ASA OG Working] **********************************************************</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2"></a>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 1</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set RFC1918 Object Group] ****************************************</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5"></a>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 2</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set External DNS/NTP Providers Object Group] *********************</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8"></a>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 3</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Add Port Group] **************************************************</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11"></a>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12"></a><span class="l l-Scalar l-Scalar-Plain">TASK [TASK 4</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Remove Extra Group] **********************************************</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13"></a><span class="nt">changed</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14"></a>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15"></a><span class="l l-Scalar l-Scalar-Plain">TASK [DEBUG 1</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print output of RFC1918 Object Group] ***************************</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; {</span>
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18"></a><span class="w">        </span><span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
</span><span id="__span-89-19"><a id="__codelineno-89-19" name="__codelineno-89-19"></a><span class="w">        </span><span class="s">&quot;commands&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[],</span>
</span><span id="__span-89-20"><a id="__codelineno-89-20" name="__codelineno-89-20"></a><span class="w">        </span><span class="s">&quot;failed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span>
</span><span id="__span-89-21"><a id="__codelineno-89-21" name="__codelineno-89-21"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-89-22"><a id="__codelineno-89-22" name="__codelineno-89-22"></a><span class="err">}</span>
</span><span id="__span-89-23"><a id="__codelineno-89-23" name="__codelineno-89-23"></a>
</span><span id="__span-89-24"><a id="__codelineno-89-24" name="__codelineno-89-24"></a><span class="l l-Scalar l-Scalar-Plain">TASK [DEBUG 2</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print output of External DNS Group] *****************************</span>
</span><span id="__span-89-25"><a id="__codelineno-89-25" name="__codelineno-89-25"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; {</span>
</span><span id="__span-89-26"><a id="__codelineno-89-26" name="__codelineno-89-26"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
</span><span id="__span-89-27"><a id="__codelineno-89-27" name="__codelineno-89-27"></a><span class="w">        </span><span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
</span><span id="__span-89-28"><a id="__codelineno-89-28" name="__codelineno-89-28"></a><span class="w">        </span><span class="s">&quot;commands&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[],</span>
</span><span id="__span-89-29"><a id="__codelineno-89-29" name="__codelineno-89-29"></a><span class="w">        </span><span class="s">&quot;failed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span>
</span><span id="__span-89-30"><a id="__codelineno-89-30" name="__codelineno-89-30"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-89-31"><a id="__codelineno-89-31" name="__codelineno-89-31"></a><span class="err">}</span>
</span><span id="__span-89-32"><a id="__codelineno-89-32" name="__codelineno-89-32"></a>
</span><span id="__span-89-33"><a id="__codelineno-89-33" name="__codelineno-89-33"></a><span class="l l-Scalar l-Scalar-Plain">TASK [DEBUG 3</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print output of adding Port Group] ******************************</span>
</span><span id="__span-89-34"><a id="__codelineno-89-34" name="__codelineno-89-34"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; {</span>
</span><span id="__span-89-35"><a id="__codelineno-89-35" name="__codelineno-89-35"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
</span><span id="__span-89-36"><a id="__codelineno-89-36" name="__codelineno-89-36"></a><span class="w">        </span><span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
</span><span id="__span-89-37"><a id="__codelineno-89-37" name="__codelineno-89-37"></a><span class="w">        </span><span class="s">&quot;commands&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[],</span>
</span><span id="__span-89-38"><a id="__codelineno-89-38" name="__codelineno-89-38"></a><span class="w">        </span><span class="s">&quot;failed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span>
</span><span id="__span-89-39"><a id="__codelineno-89-39" name="__codelineno-89-39"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-89-40"><a id="__codelineno-89-40" name="__codelineno-89-40"></a><span class="err">}</span>
</span><span id="__span-89-41"><a id="__codelineno-89-41" name="__codelineno-89-41"></a>
</span><span id="__span-89-42"><a id="__codelineno-89-42" name="__codelineno-89-42"></a><span class="l l-Scalar l-Scalar-Plain">TASK [DEBUG 4</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print output of removing extra Port Group] **********************</span>
</span><span id="__span-89-43"><a id="__codelineno-89-43" name="__codelineno-89-43"></a><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">asa1</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">=&gt; {</span>
</span><span id="__span-89-44"><a id="__codelineno-89-44" name="__codelineno-89-44"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">&quot;msg&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
</span><span id="__span-89-45"><a id="__codelineno-89-45" name="__codelineno-89-45"></a><span class="w">        </span><span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span>
</span><span id="__span-89-46"><a id="__codelineno-89-46" name="__codelineno-89-46"></a><span class="w">        </span><span class="s">&quot;commands&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
</span><span id="__span-89-47"><a id="__codelineno-89-47" name="__codelineno-89-47"></a><span class="w">            </span><span class="s">&quot;object-group</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">DNS_ONLY</span><span class="nv"> </span><span class="s">udp&quot;</span><span class="p p-Indicator">,</span>
</span><span id="__span-89-48"><a id="__codelineno-89-48" name="__codelineno-89-48"></a><span class="w">            </span><span class="s">&quot;no</span><span class="nv"> </span><span class="s">port-object</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">domain&quot;</span>
</span><span id="__span-89-49"><a id="__codelineno-89-49" name="__codelineno-89-49"></a><span class="w">        </span><span class="p p-Indicator">],</span>
</span><span id="__span-89-50"><a id="__codelineno-89-50" name="__codelineno-89-50"></a><span class="w">        </span><span class="s">&quot;failed&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">false</span>
</span><span id="__span-89-51"><a id="__codelineno-89-51" name="__codelineno-89-51"></a><span class="w">    </span><span class="p p-Indicator">}</span>
</span><span id="__span-89-52"><a id="__codelineno-89-52" name="__codelineno-89-52"></a><span class="err">}</span>
</span><span id="__span-89-53"><a id="__codelineno-89-53" name="__codelineno-89-53"></a>
</span><span id="__span-89-54"><a id="__codelineno-89-54" name="__codelineno-89-54"></a><span class="l l-Scalar l-Scalar-Plain">PLAY RECAP *********************************************************************</span>
</span><span id="__span-89-55"><a id="__codelineno-89-55" name="__codelineno-89-55"></a><span class="nt">asa1                       </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ok=8    changed=1    unreachable=0    failed=0    s</span>
</span><span id="__span-89-56"><a id="__codelineno-89-56" name="__codelineno-89-56"></a><span class="l l-Scalar l-Scalar-Plain">kipped=0    rescued=0    ignored=0</span>
</span></code></pre></div></td></tr></table></div>
<h6 id="firewall-after"><a class="toclink" href="../../../../ansible-asa-og/#firewall-after">Firewall After</a></h6>
<p>Here we see that the port object that we asked to remove is gone. If there were
other object items in the object-group they would still remain.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-90-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-90-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-90-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-90-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-90-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-90-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-90-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-90-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-90-10">10</a></span>
<span class="normal"><a href="#__codelineno-90-11">11</a></span>
<span class="normal"><a href="#__codelineno-90-12">12</a></span>
<span class="normal"><a href="#__codelineno-90-13">13</a></span>
<span class="normal"><a href="#__codelineno-90-14">14</a></span>
<span class="normal"><a href="#__codelineno-90-15">15</a></span>
<span class="normal"><a href="#__codelineno-90-16">16</a></span>
<span class="normal"><a href="#__codelineno-90-17">17</a></span>
<span class="normal"><a href="#__codelineno-90-18">18</a></span>
<span class="normal"><a href="#__codelineno-90-19">19</a></span>
<span class="normal"><a href="#__codelineno-90-20">20</a></span>
<span class="normal"><a href="#__codelineno-90-21">21</a></span>
<span class="normal"><a href="#__codelineno-90-22">22</a></span>
<span class="normal"><a href="#__codelineno-90-23">23</a></span>
<span class="normal"><a href="#__codelineno-90-24">24</a></span>
<span class="normal"><a href="#__codelineno-90-25">25</a></span>
<span class="normal"><a href="#__codelineno-90-26">26</a></span>
<span class="normal"><a href="#__codelineno-90-27">27</a></span>
<span class="normal"><a href="#__codelineno-90-28">28</a></span>
<span class="normal"><a href="#__codelineno-90-29">29</a></span>
<span class="normal"><a href="#__codelineno-90-30">30</a></span>
<span class="normal"><a href="#__codelineno-90-31">31</a></span>
<span class="normal"><a href="#__codelineno-90-32">32</a></span>
<span class="normal"><a href="#__codelineno-90-33">33</a></span>
<span class="normal"><a href="#__codelineno-90-34">34</a></span>
<span class="normal"><a href="#__codelineno-90-35">35</a></span>
<span class="normal"><a href="#__codelineno-90-36">36</a></span>
<span class="normal"><a href="#__codelineno-90-37">37</a></span>
<span class="normal"><a href="#__codelineno-90-38">38</a></span>
<span class="normal"><a href="#__codelineno-90-39">39</a></span>
<span class="normal"><a href="#__codelineno-90-40">40</a></span>
<span class="normal"><a href="#__codelineno-90-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="l l-Scalar l-Scalar-Plain">fw01# show object-group</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="l l-Scalar l-Scalar-Plain">object-group network RFC1918_Networks</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 10.0.0.0 255.0.0.0</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 172.16.0.0 255.240.0.0</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 192.168.0.0 255.255.0.0</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7"></a><span class="l l-Scalar l-Scalar-Plain">object-group network EXTERNAL_DNS_NTP</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">External DNS Providers (CloudFlare, Google, Quad9, Umbrella)</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 1.1.1.1</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 8.8.8.8</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 9.9.9.9</span>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.222.222</span>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.220.220</span>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14"></a><span class="l l-Scalar l-Scalar-Plain">object-group service SVC_OBJ_DNS_NTP udp</span>
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-90-16"><a id="__codelineno-90-16" name="__codelineno-90-16"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq domain</span>
</span><span id="__span-90-17"><a id="__codelineno-90-17" name="__codelineno-90-17"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq ntp</span>
</span><span id="__span-90-18"><a id="__codelineno-90-18" name="__codelineno-90-18"></a><span class="l l-Scalar l-Scalar-Plain">object-group service DNS_ONLY udp</span>
</span><span id="__span-90-19"><a id="__codelineno-90-19" name="__codelineno-90-19"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS ports</span>
</span><span id="__span-90-20"><a id="__codelineno-90-20" name="__codelineno-90-20"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq domain</span>
</span><span id="__span-90-21"><a id="__codelineno-90-21" name="__codelineno-90-21"></a><span class="l l-Scalar l-Scalar-Plain">fw01#</span>
</span><span id="__span-90-22"><a id="__codelineno-90-22" name="__codelineno-90-22"></a><span class="l l-Scalar l-Scalar-Plain">fw01# ! AFTER THE CHANGE</span>
</span><span id="__span-90-23"><a id="__codelineno-90-23" name="__codelineno-90-23"></a><span class="l l-Scalar l-Scalar-Plain">fw01# show object-group</span>
</span><span id="__span-90-24"><a id="__codelineno-90-24" name="__codelineno-90-24"></a><span class="l l-Scalar l-Scalar-Plain">object-group network RFC1918_Networks</span>
</span><span id="__span-90-25"><a id="__codelineno-90-25" name="__codelineno-90-25"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-90-26"><a id="__codelineno-90-26" name="__codelineno-90-26"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 10.0.0.0 255.0.0.0</span>
</span><span id="__span-90-27"><a id="__codelineno-90-27" name="__codelineno-90-27"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 172.16.0.0 255.240.0.0</span>
</span><span id="__span-90-28"><a id="__codelineno-90-28" name="__codelineno-90-28"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object 192.168.0.0 255.255.0.0</span>
</span><span id="__span-90-29"><a id="__codelineno-90-29" name="__codelineno-90-29"></a><span class="l l-Scalar l-Scalar-Plain">object-group network EXTERNAL_DNS_NTP</span>
</span><span id="__span-90-30"><a id="__codelineno-90-30" name="__codelineno-90-30"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">External DNS Providers (CloudFlare, Google, Quad9, Umbrella)</span>
</span><span id="__span-90-31"><a id="__codelineno-90-31" name="__codelineno-90-31"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 1.1.1.1</span>
</span><span id="__span-90-32"><a id="__codelineno-90-32" name="__codelineno-90-32"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 8.8.8.8</span>
</span><span id="__span-90-33"><a id="__codelineno-90-33" name="__codelineno-90-33"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 9.9.9.9</span>
</span><span id="__span-90-34"><a id="__codelineno-90-34" name="__codelineno-90-34"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.222.222</span>
</span><span id="__span-90-35"><a id="__codelineno-90-35" name="__codelineno-90-35"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object host 208.67.220.220</span>
</span><span id="__span-90-36"><a id="__codelineno-90-36" name="__codelineno-90-36"></a><span class="l l-Scalar l-Scalar-Plain">object-group service SVC_OBJ_DNS_NTP udp</span>
</span><span id="__span-90-37"><a id="__codelineno-90-37" name="__codelineno-90-37"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-90-38"><a id="__codelineno-90-38" name="__codelineno-90-38"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq domain</span>
</span><span id="__span-90-39"><a id="__codelineno-90-39" name="__codelineno-90-39"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object eq ntp</span>
</span><span id="__span-90-40"><a id="__codelineno-90-40" name="__codelineno-90-40"></a><span class="l l-Scalar l-Scalar-Plain">object-group service DNS_ONLY udp</span>
</span><span id="__span-90-41"><a id="__codelineno-90-41" name="__codelineno-90-41"></a><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS ports</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="state-replace"><a class="toclink" href="../../../../ansible-asa-og/#state-replace">State: Replace</a></h4>
<p>Originally this was not on the radar to include in this post, but I have found
it very helpful. What <code>replace</code> will do for you is allow you to set this as the
"standard". So if there are extraneous items in the object group <code>replace</code> will
remove anything extra. If there are any items missing from the object group it
will add them in.  </p>
<h5 id="tasks-replace"><a class="toclink" href="../../../../ansible-asa-og/#tasks-replace">Tasks - Replace</a></h5>
<p>I'm going to modify <em>Task 3</em> from earlier to add some extra ports to the
port-group and change <em>domain</em> to <em>dns</em> even though <em>domain</em> is the proper ASA
shorthand for port 53.  The two tasks are now this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">3:</span><span class="nv"> </span><span class="s">Add</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SVC_OBJ_DNS_NTP</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">        </span><span class="nt">port_eq</span><span class="p">:</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ntp&quot;</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;dns&quot;</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5353&quot;</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;553&quot;</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;353&quot;</span>
</span><span id="__span-91-14"><a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output3</span>
</span><span id="__span-91-15"><a id="__codelineno-91-15" name="__codelineno-91-15" href="#__codelineno-91-15"></a>
</span><span id="__span-91-16"><a id="__codelineno-91-16" name="__codelineno-91-16" href="#__codelineno-91-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">5:</span><span class="nv"> </span><span class="s">Fix</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">DNS</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-91-17"><a id="__codelineno-91-17" name="__codelineno-91-17" href="#__codelineno-91-17"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-91-18"><a id="__codelineno-91-18" name="__codelineno-91-18" href="#__codelineno-91-18"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SVC_OBJ_DNS_NTP</span>
</span><span id="__span-91-19"><a id="__codelineno-91-19" name="__codelineno-91-19" href="#__codelineno-91-19"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object</span>
</span><span id="__span-91-20"><a id="__codelineno-91-20" name="__codelineno-91-20" href="#__codelineno-91-20"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
</span><span id="__span-91-21"><a id="__codelineno-91-21" name="__codelineno-91-21" href="#__codelineno-91-21"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-91-22"><a id="__codelineno-91-22" name="__codelineno-91-22" href="#__codelineno-91-22"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span>
</span><span id="__span-91-23"><a id="__codelineno-91-23" name="__codelineno-91-23" href="#__codelineno-91-23"></a><span class="w">        </span><span class="nt">port_eq</span><span class="p">:</span>
</span><span id="__span-91-24"><a id="__codelineno-91-24" name="__codelineno-91-24" href="#__codelineno-91-24"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;domain&quot;</span>
</span><span id="__span-91-25"><a id="__codelineno-91-25" name="__codelineno-91-25" href="#__codelineno-91-25"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ntp&quot;</span>
</span><span id="__span-91-26"><a id="__codelineno-91-26" name="__codelineno-91-26" href="#__codelineno-91-26"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output5</span>
</span></code></pre></div>
<h5 id="replace-task-execution"><a class="toclink" href="../../../../ansible-asa-og/#replace-task-execution">Replace Task Execution</a></h5>
<p>Let's get right to looking at the execution based on the summary above.  </p>
<h6 id="firewall-before"><a class="toclink" href="../../../../ansible-asa-og/#firewall-before">Firewall Before</a></h6>
<p>Here we see that the object group <strong>SVC_OBJ_DNS_NTP</strong> has a lot more entries
than one should expect.  </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>fw01#<span class="w"> </span>show<span class="w"> </span>object-group
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>object-group<span class="w"> </span>network<span class="w"> </span>RFC1918_Networks
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="w"> </span>description:<span class="w"> </span>RFC1918<span class="w"> </span>Local<span class="w"> </span>Networks
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="w"> </span>network-object<span class="w"> </span><span class="m">10</span>.0.0.0<span class="w"> </span><span class="m">255</span>.0.0.0
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="w"> </span>network-object<span class="w"> </span><span class="m">172</span>.16.0.0<span class="w"> </span><span class="m">255</span>.240.0.0
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="w"> </span>network-object<span class="w"> </span><span class="m">192</span>.168.0.0<span class="w"> </span><span class="m">255</span>.255.0.0
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a>object-group<span class="w"> </span>network<span class="w"> </span>EXTERNAL_DNS_NTP
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="w"> </span>description:<span class="w"> </span>External<span class="w"> </span>DNS<span class="w"> </span>Providers<span class="w"> </span><span class="o">(</span>CloudFlare,<span class="w"> </span>Google,<span class="w"> </span>Quad9,<span class="w"> </span>Umbrella<span class="o">)</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="w"> </span>network-object<span class="w"> </span>host<span class="w"> </span><span class="m">1</span>.1.1.1
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="w"> </span>network-object<span class="w"> </span>host<span class="w"> </span><span class="m">8</span>.8.8.8
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="w"> </span>network-object<span class="w"> </span>host<span class="w"> </span><span class="m">9</span>.9.9.9
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a><span class="w"> </span>network-object<span class="w"> </span>host<span class="w"> </span><span class="m">208</span>.67.222.222
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a><span class="w"> </span>network-object<span class="w"> </span>host<span class="w"> </span><span class="m">208</span>.67.220.220
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a>object-group<span class="w"> </span>service<span class="w"> </span>SVC_OBJ_DNS_NTP<span class="w"> </span>udp
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a><span class="w"> </span>description:<span class="w"> </span>DNS<span class="w"> </span>and<span class="w"> </span>NTP<span class="w"> </span>ports
</span><span id="__span-92-16"><a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a><span class="w"> </span>port-object<span class="w"> </span>eq<span class="w"> </span>domain
</span><span id="__span-92-17"><a id="__codelineno-92-17" name="__codelineno-92-17" href="#__codelineno-92-17"></a><span class="w"> </span>port-object<span class="w"> </span>eq<span class="w"> </span>ntp
</span><span id="__span-92-18"><a id="__codelineno-92-18" name="__codelineno-92-18" href="#__codelineno-92-18"></a><span class="w"> </span>port-object<span class="w"> </span>eq<span class="w"> </span>dnsix
</span><span id="__span-92-19"><a id="__codelineno-92-19" name="__codelineno-92-19" href="#__codelineno-92-19"></a><span class="w"> </span>port-object<span class="w"> </span>eq<span class="w"> </span><span class="m">5353</span>
</span><span id="__span-92-20"><a id="__codelineno-92-20" name="__codelineno-92-20" href="#__codelineno-92-20"></a><span class="w"> </span>port-object<span class="w"> </span>eq<span class="w"> </span><span class="m">553</span>
</span><span id="__span-92-21"><a id="__codelineno-92-21" name="__codelineno-92-21" href="#__codelineno-92-21"></a><span class="w"> </span>port-object<span class="w"> </span>eq<span class="w"> </span><span class="m">353</span>
</span></code></pre></div>
<h6 id="replace-full-playbook"><a class="toclink" href="../../../../ansible-asa-og/#replace-full-playbook">Replace - Full Playbook</a></h6>
<p>The full playbook with all of the debugs and the tasks.  </p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="nn">---</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="c1"># yamllint disable rule:truthy</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="c1"># yamllint disable rule:line-length</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ASA OG Working</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network_cli</span>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">asa_firewalls</span>
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="w">  </span><span class="nt">become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a>
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a>
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">RFC1918</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918_Networks</span>
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object</span>
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-93-18"><a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFC1918 Local Networks</span>
</span><span id="__span-93-19"><a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a><span class="w">        </span><span class="nt">ip_mask</span><span class="p">:</span>
</span><span id="__span-93-20"><a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0 255.0.0.0</span>
</span><span id="__span-93-21"><a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.0.0 255.240.0.0</span>
</span><span id="__span-93-22"><a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0 255.255.0.0</span>
</span><span id="__span-93-23"><a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
</span><span id="__span-93-24"><a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a>
</span><span id="__span-93-25"><a id="__codelineno-93-25" name="__codelineno-93-25" href="#__codelineno-93-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">External</span><span class="nv"> </span><span class="s">DNS/NTP</span><span class="nv"> </span><span class="s">Providers</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-93-26"><a id="__codelineno-93-26" name="__codelineno-93-26" href="#__codelineno-93-26"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-93-27"><a id="__codelineno-93-27" name="__codelineno-93-27" href="#__codelineno-93-27"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EXTERNAL_DNS_NTP</span>
</span><span id="__span-93-28"><a id="__codelineno-93-28" name="__codelineno-93-28" href="#__codelineno-93-28"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network-object</span>
</span><span id="__span-93-29"><a id="__codelineno-93-29" name="__codelineno-93-29" href="#__codelineno-93-29"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-93-30"><a id="__codelineno-93-30" name="__codelineno-93-30" href="#__codelineno-93-30"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">External DNS Providers (CloudFlare, Google, Quad9, Umbrella)</span>
</span><span id="__span-93-31"><a id="__codelineno-93-31" name="__codelineno-93-31" href="#__codelineno-93-31"></a><span class="w">        </span><span class="nt">host_ip</span><span class="p">:</span>
</span><span id="__span-93-32"><a id="__codelineno-93-32" name="__codelineno-93-32" href="#__codelineno-93-32"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1.1.1</span>
</span><span id="__span-93-33"><a id="__codelineno-93-33" name="__codelineno-93-33" href="#__codelineno-93-33"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.8.8.8</span>
</span><span id="__span-93-34"><a id="__codelineno-93-34" name="__codelineno-93-34" href="#__codelineno-93-34"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9.9.9.9</span>
</span><span id="__span-93-35"><a id="__codelineno-93-35" name="__codelineno-93-35" href="#__codelineno-93-35"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208.67.222.222</span>
</span><span id="__span-93-36"><a id="__codelineno-93-36" name="__codelineno-93-36" href="#__codelineno-93-36"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208.67.220.220</span>
</span><span id="__span-93-37"><a id="__codelineno-93-37" name="__codelineno-93-37" href="#__codelineno-93-37"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output2</span>
</span><span id="__span-93-38"><a id="__codelineno-93-38" name="__codelineno-93-38" href="#__codelineno-93-38"></a>
</span><span id="__span-93-39"><a id="__codelineno-93-39" name="__codelineno-93-39" href="#__codelineno-93-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">3:</span><span class="nv"> </span><span class="s">Add</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-93-40"><a id="__codelineno-93-40" name="__codelineno-93-40" href="#__codelineno-93-40"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-93-41"><a id="__codelineno-93-41" name="__codelineno-93-41" href="#__codelineno-93-41"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SVC_OBJ_DNS_NTP</span>
</span><span id="__span-93-42"><a id="__codelineno-93-42" name="__codelineno-93-42" href="#__codelineno-93-42"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object</span>
</span><span id="__span-93-43"><a id="__codelineno-93-43" name="__codelineno-93-43" href="#__codelineno-93-43"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-93-44"><a id="__codelineno-93-44" name="__codelineno-93-44" href="#__codelineno-93-44"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-93-45"><a id="__codelineno-93-45" name="__codelineno-93-45" href="#__codelineno-93-45"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span>
</span><span id="__span-93-46"><a id="__codelineno-93-46" name="__codelineno-93-46" href="#__codelineno-93-46"></a><span class="w">        </span><span class="nt">port_eq</span><span class="p">:</span>
</span><span id="__span-93-47"><a id="__codelineno-93-47" name="__codelineno-93-47" href="#__codelineno-93-47"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ntp&quot;</span>
</span><span id="__span-93-48"><a id="__codelineno-93-48" name="__codelineno-93-48" href="#__codelineno-93-48"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;dnsix&quot;</span>
</span><span id="__span-93-49"><a id="__codelineno-93-49" name="__codelineno-93-49" href="#__codelineno-93-49"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5353&quot;</span>
</span><span id="__span-93-50"><a id="__codelineno-93-50" name="__codelineno-93-50" href="#__codelineno-93-50"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;553&quot;</span>
</span><span id="__span-93-51"><a id="__codelineno-93-51" name="__codelineno-93-51" href="#__codelineno-93-51"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;353&quot;</span>
</span><span id="__span-93-52"><a id="__codelineno-93-52" name="__codelineno-93-52" href="#__codelineno-93-52"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output3</span>
</span><span id="__span-93-53"><a id="__codelineno-93-53" name="__codelineno-93-53" href="#__codelineno-93-53"></a>
</span><span id="__span-93-54"><a id="__codelineno-93-54" name="__codelineno-93-54" href="#__codelineno-93-54"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">4:</span><span class="nv"> </span><span class="s">Remove</span><span class="nv"> </span><span class="s">Extra</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-93-55"><a id="__codelineno-93-55" name="__codelineno-93-55" href="#__codelineno-93-55"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-93-56"><a id="__codelineno-93-56" name="__codelineno-93-56" href="#__codelineno-93-56"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS_ONLY</span>
</span><span id="__span-93-57"><a id="__codelineno-93-57" name="__codelineno-93-57" href="#__codelineno-93-57"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object</span>
</span><span id="__span-93-58"><a id="__codelineno-93-58" name="__codelineno-93-58" href="#__codelineno-93-58"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</span><span id="__span-93-59"><a id="__codelineno-93-59" name="__codelineno-93-59" href="#__codelineno-93-59"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span>
</span><span id="__span-93-60"><a id="__codelineno-93-60" name="__codelineno-93-60" href="#__codelineno-93-60"></a><span class="w">        </span><span class="nt">port_eq</span><span class="p">:</span>
</span><span id="__span-93-61"><a id="__codelineno-93-61" name="__codelineno-93-61" href="#__codelineno-93-61"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">domain</span>
</span><span id="__span-93-62"><a id="__codelineno-93-62" name="__codelineno-93-62" href="#__codelineno-93-62"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output4</span>
</span><span id="__span-93-63"><a id="__codelineno-93-63" name="__codelineno-93-63" href="#__codelineno-93-63"></a>
</span><span id="__span-93-64"><a id="__codelineno-93-64" name="__codelineno-93-64" href="#__codelineno-93-64"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">5:</span><span class="nv"> </span><span class="s">Fix</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">DNS</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-93-65"><a id="__codelineno-93-65" name="__codelineno-93-65" href="#__codelineno-93-65"></a><span class="w">      </span><span class="nt">asa_og</span><span class="p">:</span>
</span><span id="__span-93-66"><a id="__codelineno-93-66" name="__codelineno-93-66" href="#__codelineno-93-66"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SVC_OBJ_DNS_NTP</span>
</span><span id="__span-93-67"><a id="__codelineno-93-67" name="__codelineno-93-67" href="#__codelineno-93-67"></a><span class="w">        </span><span class="nt">group_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port-object</span>
</span><span id="__span-93-68"><a id="__codelineno-93-68" name="__codelineno-93-68" href="#__codelineno-93-68"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
</span><span id="__span-93-69"><a id="__codelineno-93-69" name="__codelineno-93-69" href="#__codelineno-93-69"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DNS and NTP ports</span>
</span><span id="__span-93-70"><a id="__codelineno-93-70" name="__codelineno-93-70" href="#__codelineno-93-70"></a><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">udp</span>
</span><span id="__span-93-71"><a id="__codelineno-93-71" name="__codelineno-93-71" href="#__codelineno-93-71"></a><span class="w">        </span><span class="nt">port_eq</span><span class="p">:</span>
</span><span id="__span-93-72"><a id="__codelineno-93-72" name="__codelineno-93-72" href="#__codelineno-93-72"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;domain&quot;</span>
</span><span id="__span-93-73"><a id="__codelineno-93-73" name="__codelineno-93-73" href="#__codelineno-93-73"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;ntp&quot;</span>
</span><span id="__span-93-74"><a id="__codelineno-93-74" name="__codelineno-93-74" href="#__codelineno-93-74"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output5</span>
</span><span id="__span-93-75"><a id="__codelineno-93-75" name="__codelineno-93-75" href="#__codelineno-93-75"></a>
</span><span id="__span-93-76"><a id="__codelineno-93-76" name="__codelineno-93-76" href="#__codelineno-93-76"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">RFC1918</span><span class="nv"> </span><span class="s">Object</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-93-77"><a id="__codelineno-93-77" name="__codelineno-93-77" href="#__codelineno-93-77"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-93-78"><a id="__codelineno-93-78" name="__codelineno-93-78" href="#__codelineno-93-78"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-93-79"><a id="__codelineno-93-79" name="__codelineno-93-79" href="#__codelineno-93-79"></a>
</span><span id="__span-93-80"><a id="__codelineno-93-80" name="__codelineno-93-80" href="#__codelineno-93-80"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">External</span><span class="nv"> </span><span class="s">DNS</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-93-81"><a id="__codelineno-93-81" name="__codelineno-93-81" href="#__codelineno-93-81"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-93-82"><a id="__codelineno-93-82" name="__codelineno-93-82" href="#__codelineno-93-82"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output2</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-93-83"><a id="__codelineno-93-83" name="__codelineno-93-83" href="#__codelineno-93-83"></a>
</span><span id="__span-93-84"><a id="__codelineno-93-84" name="__codelineno-93-84" href="#__codelineno-93-84"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">3:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">adding</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-93-85"><a id="__codelineno-93-85" name="__codelineno-93-85" href="#__codelineno-93-85"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-93-86"><a id="__codelineno-93-86" name="__codelineno-93-86" href="#__codelineno-93-86"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output3</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-93-87"><a id="__codelineno-93-87" name="__codelineno-93-87" href="#__codelineno-93-87"></a>
</span><span id="__span-93-88"><a id="__codelineno-93-88" name="__codelineno-93-88" href="#__codelineno-93-88"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">4:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">removing</span><span class="nv"> </span><span class="s">extra</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group&quot;</span>
</span><span id="__span-93-89"><a id="__codelineno-93-89" name="__codelineno-93-89" href="#__codelineno-93-89"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-93-90"><a id="__codelineno-93-90" name="__codelineno-93-90" href="#__codelineno-93-90"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output4</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-93-91"><a id="__codelineno-93-91" name="__codelineno-93-91" href="#__codelineno-93-91"></a>
</span><span id="__span-93-92"><a id="__codelineno-93-92" name="__codelineno-93-92" href="#__codelineno-93-92"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG</span><span class="nv"> </span><span class="s">5:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">Port</span><span class="nv"> </span><span class="s">Group</span><span class="nv"> </span><span class="s">Replace&quot;</span>
</span><span id="__span-93-93"><a id="__codelineno-93-93" name="__codelineno-93-93" href="#__codelineno-93-93"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-93-94"><a id="__codelineno-93-94" name="__codelineno-93-94" href="#__codelineno-93-94"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output5</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-93-95"><a id="__codelineno-93-95" name="__codelineno-93-95" href="#__codelineno-93-95"></a><span class="nn">...</span>
</span></code></pre></div>
<h6 id="execution"><a class="toclink" href="../../../../ansible-asa-og/#execution">Execution</a></h6>
<p>Task 1-4: All check out OK, there are no changes being made<br />
Task 5: This is that additional task to fix the item properly<br />
Debug 1-4: All show no changes<br />
Debug 5: Shows that the changes were made, including add <code>domain</code> and removing a
bunch of extra items  </p>
<iframe width="853" height="480" src="https://www.youtube.com/embed/HARqtDKc0MM?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<div class="language-bash highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>PLAY<span class="w"> </span><span class="o">[</span>ASA<span class="w"> </span>OG<span class="w"> </span>Working<span class="o">]</span><span class="w"> </span>**********************************************************
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Set<span class="w"> </span>RFC1918<span class="w"> </span>Object<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>****************************************
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Set<span class="w"> </span>External<span class="w"> </span>DNS/NTP<span class="w"> </span>Providers<span class="w"> </span>Object<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>*********************
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>Add<span class="w"> </span>Port<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>**************************************************
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span>
</span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a>
</span><span id="__span-94-12"><a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">4</span>:<span class="w"> </span>Remove<span class="w"> </span>Extra<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>**********************************************
</span><span id="__span-94-13"><a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span>
</span><span id="__span-94-14"><a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a>
</span><span id="__span-94-15"><a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">5</span>:<span class="w"> </span>Fix<span class="w"> </span>the<span class="w"> </span>DNS<span class="w"> </span>Port<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>******************************************
</span><span id="__span-94-16"><a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a>changed:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span>
</span><span id="__span-94-17"><a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a>
</span><span id="__span-94-18"><a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a>TASK<span class="w"> </span><span class="o">[</span>DEBUG<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>RFC1918<span class="w"> </span>Object<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>***************************
</span><span id="__span-94-19"><a id="__codelineno-94-19" name="__codelineno-94-19" href="#__codelineno-94-19"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-20"><a id="__codelineno-94-20" name="__codelineno-94-20" href="#__codelineno-94-20"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-21"><a id="__codelineno-94-21" name="__codelineno-94-21" href="#__codelineno-94-21"></a><span class="w">        </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-94-22"><a id="__codelineno-94-22" name="__codelineno-94-22" href="#__codelineno-94-22"></a><span class="w">        </span><span class="s2">&quot;commands&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
</span><span id="__span-94-23"><a id="__codelineno-94-23" name="__codelineno-94-23" href="#__codelineno-94-23"></a><span class="w">        </span><span class="s2">&quot;failed&quot;</span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-94-24"><a id="__codelineno-94-24" name="__codelineno-94-24" href="#__codelineno-94-24"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-94-25"><a id="__codelineno-94-25" name="__codelineno-94-25" href="#__codelineno-94-25"></a><span class="o">}</span>
</span><span id="__span-94-26"><a id="__codelineno-94-26" name="__codelineno-94-26" href="#__codelineno-94-26"></a>
</span><span id="__span-94-27"><a id="__codelineno-94-27" name="__codelineno-94-27" href="#__codelineno-94-27"></a>TASK<span class="w"> </span><span class="o">[</span>DEBUG<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>External<span class="w"> </span>DNS<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>*****************************
</span><span id="__span-94-28"><a id="__codelineno-94-28" name="__codelineno-94-28" href="#__codelineno-94-28"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-29"><a id="__codelineno-94-29" name="__codelineno-94-29" href="#__codelineno-94-29"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-30"><a id="__codelineno-94-30" name="__codelineno-94-30" href="#__codelineno-94-30"></a><span class="w">        </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-94-31"><a id="__codelineno-94-31" name="__codelineno-94-31" href="#__codelineno-94-31"></a><span class="w">        </span><span class="s2">&quot;commands&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
</span><span id="__span-94-32"><a id="__codelineno-94-32" name="__codelineno-94-32" href="#__codelineno-94-32"></a><span class="w">        </span><span class="s2">&quot;failed&quot;</span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-94-33"><a id="__codelineno-94-33" name="__codelineno-94-33" href="#__codelineno-94-33"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-94-34"><a id="__codelineno-94-34" name="__codelineno-94-34" href="#__codelineno-94-34"></a><span class="o">}</span>
</span><span id="__span-94-35"><a id="__codelineno-94-35" name="__codelineno-94-35" href="#__codelineno-94-35"></a>
</span><span id="__span-94-36"><a id="__codelineno-94-36" name="__codelineno-94-36" href="#__codelineno-94-36"></a>TASK<span class="w"> </span><span class="o">[</span>DEBUG<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>adding<span class="w"> </span>Port<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>******************************
</span><span id="__span-94-37"><a id="__codelineno-94-37" name="__codelineno-94-37" href="#__codelineno-94-37"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-38"><a id="__codelineno-94-38" name="__codelineno-94-38" href="#__codelineno-94-38"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-39"><a id="__codelineno-94-39" name="__codelineno-94-39" href="#__codelineno-94-39"></a><span class="w">        </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-94-40"><a id="__codelineno-94-40" name="__codelineno-94-40" href="#__codelineno-94-40"></a><span class="w">        </span><span class="s2">&quot;commands&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
</span><span id="__span-94-41"><a id="__codelineno-94-41" name="__codelineno-94-41" href="#__codelineno-94-41"></a><span class="w">        </span><span class="s2">&quot;failed&quot;</span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-94-42"><a id="__codelineno-94-42" name="__codelineno-94-42" href="#__codelineno-94-42"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-94-43"><a id="__codelineno-94-43" name="__codelineno-94-43" href="#__codelineno-94-43"></a><span class="o">}</span>
</span><span id="__span-94-44"><a id="__codelineno-94-44" name="__codelineno-94-44" href="#__codelineno-94-44"></a>
</span><span id="__span-94-45"><a id="__codelineno-94-45" name="__codelineno-94-45" href="#__codelineno-94-45"></a>TASK<span class="w"> </span><span class="o">[</span>DEBUG<span class="w"> </span><span class="m">4</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>removing<span class="w"> </span>extra<span class="w"> </span>Port<span class="w"> </span>Group<span class="o">]</span><span class="w"> </span>**********************
</span><span id="__span-94-46"><a id="__codelineno-94-46" name="__codelineno-94-46" href="#__codelineno-94-46"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-47"><a id="__codelineno-94-47" name="__codelineno-94-47" href="#__codelineno-94-47"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-48"><a id="__codelineno-94-48" name="__codelineno-94-48" href="#__codelineno-94-48"></a><span class="w">        </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-94-49"><a id="__codelineno-94-49" name="__codelineno-94-49" href="#__codelineno-94-49"></a><span class="w">        </span><span class="s2">&quot;commands&quot;</span>:<span class="w"> </span><span class="o">[]</span>,
</span><span id="__span-94-50"><a id="__codelineno-94-50" name="__codelineno-94-50" href="#__codelineno-94-50"></a><span class="w">        </span><span class="s2">&quot;failed&quot;</span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-94-51"><a id="__codelineno-94-51" name="__codelineno-94-51" href="#__codelineno-94-51"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-94-52"><a id="__codelineno-94-52" name="__codelineno-94-52" href="#__codelineno-94-52"></a><span class="o">}</span>
</span><span id="__span-94-53"><a id="__codelineno-94-53" name="__codelineno-94-53" href="#__codelineno-94-53"></a>
</span><span id="__span-94-54"><a id="__codelineno-94-54" name="__codelineno-94-54" href="#__codelineno-94-54"></a>TASK<span class="w"> </span><span class="o">[</span>DEBUG<span class="w"> </span><span class="m">5</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>Port<span class="w"> </span>Group<span class="w"> </span>Replace<span class="o">]</span><span class="w"> </span>*****************************
</span><span id="__span-94-55"><a id="__codelineno-94-55" name="__codelineno-94-55" href="#__codelineno-94-55"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-56"><a id="__codelineno-94-56" name="__codelineno-94-56" href="#__codelineno-94-56"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-94-57"><a id="__codelineno-94-57" name="__codelineno-94-57" href="#__codelineno-94-57"></a><span class="w">        </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>true,
</span><span id="__span-94-58"><a id="__codelineno-94-58" name="__codelineno-94-58" href="#__codelineno-94-58"></a><span class="w">        </span><span class="s2">&quot;commands&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-94-59"><a id="__codelineno-94-59" name="__codelineno-94-59" href="#__codelineno-94-59"></a><span class="w">            </span><span class="s2">&quot;object-group service SVC_OBJ_DNS_NTP udp&quot;</span>,
</span><span id="__span-94-60"><a id="__codelineno-94-60" name="__codelineno-94-60" href="#__codelineno-94-60"></a><span class="w">            </span><span class="s2">&quot;port-object eq domain&quot;</span>,
</span><span id="__span-94-61"><a id="__codelineno-94-61" name="__codelineno-94-61" href="#__codelineno-94-61"></a><span class="w">            </span><span class="s2">&quot;no port-object eq 553&quot;</span>,
</span><span id="__span-94-62"><a id="__codelineno-94-62" name="__codelineno-94-62" href="#__codelineno-94-62"></a><span class="w">            </span><span class="s2">&quot;no port-object eq 353&quot;</span>,
</span><span id="__span-94-63"><a id="__codelineno-94-63" name="__codelineno-94-63" href="#__codelineno-94-63"></a><span class="w">            </span><span class="s2">&quot;no port-object eq 5353&quot;</span>,
</span><span id="__span-94-64"><a id="__codelineno-94-64" name="__codelineno-94-64" href="#__codelineno-94-64"></a><span class="w">            </span><span class="s2">&quot;no port-object eq dnsix&quot;</span>
</span><span id="__span-94-65"><a id="__codelineno-94-65" name="__codelineno-94-65" href="#__codelineno-94-65"></a><span class="w">        </span><span class="o">]</span>,
</span><span id="__span-94-66"><a id="__codelineno-94-66" name="__codelineno-94-66" href="#__codelineno-94-66"></a><span class="w">        </span><span class="s2">&quot;failed&quot;</span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-94-67"><a id="__codelineno-94-67" name="__codelineno-94-67" href="#__codelineno-94-67"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-94-68"><a id="__codelineno-94-68" name="__codelineno-94-68" href="#__codelineno-94-68"></a><span class="o">}</span>
</span><span id="__span-94-69"><a id="__codelineno-94-69" name="__codelineno-94-69" href="#__codelineno-94-69"></a>
</span><span id="__span-94-70"><a id="__codelineno-94-70" name="__codelineno-94-70" href="#__codelineno-94-70"></a>PLAY<span class="w"> </span>RECAP<span class="w"> </span>*********************************************************************
</span><span id="__span-94-71"><a id="__codelineno-94-71" name="__codelineno-94-71" href="#__codelineno-94-71"></a>asa1<span class="w">                       </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">10</span><span class="w">   </span><span class="nv">changed</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span>s
</span><span id="__span-94-72"><a id="__codelineno-94-72" name="__codelineno-94-72" href="#__codelineno-94-72"></a><span class="nv">kipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</span></code></pre></div>
<h3 id="summary"><a class="toclink" href="../../../../ansible-asa-og/#summary">Summary</a></h3>
<p>This module is a terrific module if you are asked to manage ASA policy. This is
very complete and should be part of your toolset for managing ASA devices. I do
foresee a significant amount of use out of the <code>state: replace</code> setup in getting
object groups to a declared state.  </p>
<p>Again, very important as well, <strong>do not forget</strong> to save your configurations at
the end if making changes.  </p>
<p>I hope that this has been informative!  </p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/22228848" alt="Josh VanDeraa">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-06-20 00:00:00">June 20, 2019</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../" class="md-meta__link">ansible</a>, 
              <a href="../../../cisco/" class="md-meta__link">cisco</a>, 
              <a href="../../../asa/" class="md-meta__link">asa</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="ansible-asa-command-module"><a class="toclink" href="../../../../ansible-asa-command/">Ansible ASA Command Module</a></h2>
<p>Today will be a touch shorter post, but it is good to be back at it. In this
post I will be taking a quick look around at the asa_command module, as we start
down the path with looking at the ASA modules in Ansible. This is spurned on a
little bit by Ansible 2.8 coming out with an Object Group specific module. I
will be looking into that further in a future post.</p>
<p>For the set of posts regarding the ASA, we will be starting with a pretty bare
configuration on the device. We will have just a management IP address and the
ability to SSH to the device.</p>
<h3 id="module-documentation"><a class="toclink" href="../../../../ansible-asa-command/#module-documentation">Module Documentation</a></h3>
<p>Module documentation page can be found
<a href="https://docs.ansible.com/ansible/latest/modules/asa_command_module.html">here</a>.</p>
<h3 id="lab-configuration"><a class="toclink" href="../../../../ansible-asa-command/#lab-configuration">Lab Configuration</a></h3>
<p>The device has bare basic configuration on it. Here we see that it has just a
management IP address on it.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>fw01# show int ip brie
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Interface                  IP-Address      OK? Method Status                Protocol
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>GigabitEthernet0/0         unassigned      YES unset  administratively down up  
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>GigabitEthernet0/1         unassigned      YES unset  administratively down up  
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>GigabitEthernet0/2         unassigned      YES unset  administratively down up  
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>Management0/0              172.16.0.254    YES CONFIG up                    up 
</span></code></pre></div>
<h3 id="using-the-playbook"><a class="toclink" href="../../../../ansible-asa-command/#using-the-playbook">Using the playbook</a></h3>
<h4 id="parameters"><a class="toclink" href="../../../../ansible-asa-command/#parameters">Parameters</a></h4>
<p>There are a couple of key parameters on this module for getting started are:</p>
<ul>
<li>commands: A list of commands to send to the device; this can be one, or 
several commands within a list</li>
<li>context: used for firewalls in multi-context mode, which context do you want
to run the command(s) in</li>
</ul>
<h4 id="simple-first-playbook"><a class="toclink" href="../../../../ansible-asa-command/#simple-first-playbook">Simple first Playbook</a></h4>
<p>This is a simple playbook that will issue two commands. We will access both of
them in different tasks within the play. Taking a look at the play we are
executing the task with two commands, a <code>show int ip brie</code> and a ping to Google
DNS. </p>
<h5 id="playbook"><a class="toclink" href="../../../../ansible-asa-command/#playbook">Playbook</a></h5>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nn">---</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c1"># yamllint disable rule:truthy</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1"># yamllint disable rule:line-length</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ASA Command Output</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network_cli</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">asa_firewalls</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">  </span><span class="nt">become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">1:</span><span class="nv"> </span><span class="s">Read</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">ASA&quot;</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">      </span><span class="nt">asa_command</span><span class="p">:</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">        </span><span class="nt">commands</span><span class="p">:</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">show int ip brief</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ping 8.8.8.8</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">2:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">show</span><span class="nv"> </span><span class="s">interfaces&quot;</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output.stdout_lines.0</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TASK</span><span class="nv"> </span><span class="s">3:</span><span class="nv"> </span><span class="s">Print</span><span class="nv"> </span><span class="s">output</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">pinging</span><span class="nv"> </span><span class="s">Google</span><span class="nv"> </span><span class="s">DNS&quot;</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output.stdout_lines.1</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<h5 id="tasks-high-level"><a class="toclink" href="../../../../ansible-asa-command/#tasks-high-level">Tasks High Level</a></h5>
<p>TASK 1 is when Ansible logs into the device and issues the two commands.<br />
TASK 2 we get the expected output of the <code>show int ip brie</code> and the commands
TASK 3 we see that the device is able to successfully ping Google DNS</p>
<p>These are the tasks that are to be run via the playbook broken out:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>cat<span class="w"> </span>asa_command_demo.yml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>TASK
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span>-<span class="w"> </span>name:<span class="w"> </span><span class="s2">&quot;TASK 1: Read output from ASA&quot;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span>-<span class="w"> </span>name:<span class="w"> </span><span class="s2">&quot;TASK 2: Print output of show interfaces&quot;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span>-<span class="w"> </span>name:<span class="w"> </span><span class="s2">&quot;TASK 3: Print output of pinging Google DNS&quot;</span>
</span></code></pre></div>
<h5 id="playbook-run"><a class="toclink" href="../../../../ansible-asa-command/#playbook-run">Playbook Run</a></h5>
<p>Execution of the playbook:</p>
<p>To see a video of this on Youtube - <a href="https://youtu.be/Wk-3Zg08oSw">https://youtu.be/Wk-3Zg08oSw</a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>PLAY<span class="w"> </span><span class="o">[</span>ASA<span class="w"> </span>Command<span class="w"> </span>Output<span class="o">]</span><span class="w"> </span>*********************************************************************
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Read<span class="w"> </span>output<span class="w"> </span>from<span class="w"> </span>ASA<span class="o">]</span><span class="w"> </span>***********************************************************
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>show<span class="w"> </span>interfaces<span class="o">]</span><span class="w"> </span>************************************************
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">        </span><span class="s2">&quot;Interface                  IP-Address      OK? Method Status                Protocol&quot;</span>,
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">        </span><span class="s2">&quot;GigabitEthernet0/0         unassigned      YES unset  administratively down up  &quot;</span>,
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">        </span><span class="s2">&quot;GigabitEthernet0/1         unassigned      YES unset  administratively down up  &quot;</span>,
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">        </span><span class="s2">&quot;GigabitEthernet0/2         unassigned      YES unset  administratively down up  &quot;</span>,
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">        </span><span class="s2">&quot;Management0/0              172.16.0.254    YES CONFIG up                    up&quot;</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">    </span><span class="o">]</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="o">}</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>TASK<span class="w"> </span><span class="o">[</span>TASK<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>Print<span class="w"> </span>output<span class="w"> </span>of<span class="w"> </span>pinging<span class="w"> </span>Google<span class="w"> </span>DNS<span class="o">]</span><span class="w"> </span>*********************************************
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>ok:<span class="w"> </span><span class="o">[</span>asa1<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">        </span><span class="s2">&quot;Type escape sequence to abort.&quot;</span>,
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">        </span><span class="s2">&quot;Sending 5, 100-byte ICMP Echos to 8.8.8.8, timeout is 2 seconds:&quot;</span>,
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">        </span><span class="s2">&quot;!!!!!&quot;</span>,
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">        </span><span class="s2">&quot;Success rate is 100 percent (5/5), round-trip min/avg/max = 20/104/190 ms&quot;</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">    </span><span class="o">]</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="o">}</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>PLAY<span class="w"> </span>RECAP<span class="w"> </span>************************************************************************************
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>asa1<span class="w">                       </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">3</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</span></code></pre></div>
<h5 id="access-multiple-commands"><a class="toclink" href="../../../../ansible-asa-command/#access-multiple-commands">Access Multiple Commands</a></h5>
<p>This is another example of how to issue multiple commands against a device
within a single task. For a deeper dive on that you can see an earlier post
<a href="https://josh-v.com/blog/2019/01/05/ansible-output-work.html">here</a>.</p>
<h3 id="summary"><a class="toclink" href="../../../../ansible-asa-command/#summary">Summary</a></h3>
<p>This is a solid starting out module for working with ASA firewalls. It does
come in very handy with dealing and gathering information from the ASA
firewall platform. I have used this for several things within a production
environment, primarily for data gathering. Hopefully coming up I will be able
to expand on this further in building out an ASA firewall.</p>
<p>Hope this was helpful! </p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <a class="md-pagination__link" href="../2/">2</a> <span class="md-pagination__current">3</span> <a class="md-pagination__link" href="../4/">4</a>
</nav>
        
      
    </div>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../../../links/" class="md-footer__link md-footer__link--prev" aria-label="Previous: üîó Links">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                üîó Links
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../arista/" class="md-footer__link md-footer__link--next" aria-label="Next: arista">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                arista
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2018 - 2024 Josh VanDeraa ‚Äì <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/jvanderaa" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/josh-vanderaa/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/vanderaaj" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
    
    
    
      
      
    
    <a href="https://fosstodon.org/@jvanderaa" target="_blank" rel="noopener me" title="fosstodon.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.sections", "content.code.copy", "content.action.view", "content.tabs.link", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.081f42fc.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>